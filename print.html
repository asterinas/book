<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Asterinas Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-2f27efde.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-26a7b232.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Asterinas Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="the-asterinas-book"><a class="header" href="#the-asterinas-book">The Asterinas Book</a></h1>
<p align="center">
    <img src="images/logo_en.svg" alt="asterinas-logo" width="620"><br>
</p>

<p>Welcome to the documentation for Asterinas,
an open-source project and community
focused on developing cutting-edge Rust OS kernels.</p>
<h2 id="book-structure"><a class="header" href="#book-structure">Book Structure</a></h2>
<p>This book is divided into six distinct parts:</p>
<h4 id="part-1-asterinas-nixos"><a class="header" href="#part-1-asterinas-nixos"><a href="distro">Part 1: Asterinas NixOS</a></a></h4>
<p>Asterinas NixOS is the first distribution built on top of the Asterinas kernel.
It is based on NixOS,
leveraging its powerful configuration model
and rich package ecosystem,
while swapping out the Linux kernel for Asterinas.</p>
<h4 id="part-2-asterinas-kernel"><a class="header" href="#part-2-asterinas-kernel"><a href="kernel">Part 2: Asterinas Kernel</a></a></h4>
<p>Explore the modern OS kernel at the heart of Asterinas.
Designed to realize the full potential of Rust,
Asterinas Kernel implements the Linux ABI in a safe and efficient way.
This means it can seamlessly replace Linux,
offering enhanced safety and security.</p>
<h4 id="part-3-asterinas-ostd"><a class="header" href="#part-3-asterinas-ostd"><a href="ostd">Part 3: Asterinas OSTD</a></a></h4>
<p>The Asterinas OSTD lays down a minimalistic, powerful, and solid foundation
for OS development.
It‚Äôs akin to Rust‚Äôs <code>std</code> crate
but crafted for the demands of <em>safe</em> Rust OS development.
The Asterinas Kernel is built on this very OSTD.</p>
<h4 id="part-4-asterinas-osdk"><a class="header" href="#part-4-asterinas-osdk"><a href="osdk/guide">Part 4: Asterinas OSDK</a></a></h4>
<p>The OSDK is a command-line tool
that streamlines the workflow to
create, build, test, and run Rust OS projects
that are built upon Asterinas OSTD.
Developed specifically for OS developers,
it extends Rust‚Äôs Cargo tool to better suite their specific needs.
OSDK is instrumental in the development of Asterinas Kernel.</p>
<h4 id="part-5-contributing-to-asterinas"><a class="header" href="#part-5-contributing-to-asterinas"><a href="to-contribute">Part 5: Contributing to Asterinas</a></a></h4>
<p>Asterinas is in its early stage
and welcomes your contributions!
This part provides guidance
on how you can become an integral part of the Asterinas project.</p>
<h4 id="part-6-requests-for-comments-rfcs"><a class="header" href="#part-6-requests-for-comments-rfcs"><a href="rfcs">Part 6: Requests for Comments (RFCs)</a></a></h4>
<p>Significant decisions in Asterinas are made through a transparent RFC process.
This part describes the RFC process
and archives all approvaed RFCs.</p>
<h2 id="licensing"><a class="header" href="#licensing">Licensing</a></h2>
<p>Asterinas‚Äôs source code and documentation primarily use the
<a href="https://github.com/asterinas/asterinas/blob/main/LICENSE-MPL">Mozilla Public License (MPL), Version 2.0</a>.
Select components are under more permissive licenses,
detailed <a href="https://github.com/asterinas/asterinas/blob/main/.licenserc.yaml">here</a>.</p>
<p>Our choice of the <a href="https://www.tldrlegal.com/license/mozilla-public-license-2-0-mpl-2">weak-copyleft</a> MPL license reflects a strategic balance:</p>
<ol>
<li>
<p><strong>Commitment to open-source freedom</strong>:
We believe that OS kernels are a communal asset that should benefit humanity.
The MPL ensures that any alterations to MPL-covered files remain open source,
aligning with our vision.
Additionally, we do not require contributors
to sign a Contributor License Agreement (CLA),
<a href="https://drewdevault.com/2018/10/05/Dont-sign-a-CLA.html">preserving their rights and preventing the possibility of their contributions being made closed source</a>.</p>
</li>
<li>
<p><strong>Accommodating proprietary modules</strong>:
Recognizing the evolving landscape
where large corporations also contribute significantly to open-source,
we accommodate the business need for proprietary kernel modules.
Unlike GPL,
the MPL permits the linking of MPL-covered files with proprietary code.</p>
</li>
</ol>
<p>In conclusion, we believe that
MPL is the best choice
to foster a vibrant, robust, and inclusive open-source community around Asterinas.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-nixos"><a class="header" href="#asterinas-nixos">Asterinas NixOS</a></h1>
<p>Asterinas NixOS is the first distribution for Asterinas.
We choose <a href="https://nixos.org/">NixOS</a> as the base OS
for its unparalleled customizability and rich package ecosystem.
Asterinas NixOS is intended to look and feel like vanilla NixOS,
except that it replaces Linux with Asterinas as its kernel.
For more rationale about choosing NixOS,
see <a href="https://asterinas.github.io/book/rfcs/0002-asterinas-nixos.html">the RFC</a>.</p>
<p><strong>Disclaimer: Asterinas is an independent, community-led project.
Asterinas NixOS is <em>not</em> an official NixOS project and has <em>no</em> affiliation with the NixOS Foundation. <em>No</em> sponsorship or endorsement is implied.</strong></p>
<p>Asterinas NixOS is not ready for production use.
We provide Asterinas NixOS to make the Asterinas kernel more accessible,
allowing early adopters and enthusiasts to try it out and provide feedback.
In addition, Asterinas developers use this distro
as a key development vehicle
to facilitate enabling and testing more real-world applications
on the Asterinas kernel.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<h3 id="end-users"><a class="header" href="#end-users">End Users</a></h3>
<p>The following instructions describe how to install Asterinas NixOS in a VM
using the Asterinas NixOS installer ISO.</p>
<ol>
<li>
<p>Launch an x86-64 Ubuntu container:</p>
<pre><code class="language-bash">docker run -it --privileged --network=host ubuntu:latest bash
</code></pre>
</li>
<li>
<p>Inside the container, install QEMU:</p>
<pre><code class="language-bash">apt update
apt install -y qemu-system-x86 qemu-utils
</code></pre>
</li>
<li>
<p>Download the latest Asterinas NixOS installer ISO from <a href="https://github.com/asterinas/asterinas/releases">GitHub Releases</a>.</p>
</li>
<li>
<p>Create a file that will be used as the target disk to install Asterinas NixOS:</p>
<pre><code class="language-bash"># The capacity of the disk is 10GB; adjust it as you see fit
dd if=/dev/zero of=aster_nixos_disk.img bs=1G count=10
</code></pre>
</li>
<li>
<p>Start an x86-64 VM with two drives:
one is the installer CD-ROM and the other is the target disk:</p>
<pre><code class="language-bash">export INSTALLER_ISO=/path/to/your/downloaded/installer.iso
qemu-system-x86_64 \
-cpu host -m 8G -enable-kvm \
-drive file="$INSTALLER_ISO",media=cdrom -boot d \
-drive if=virtio,format=raw,file=aster_nixos_disk.img \
-chardev stdio,id=mux,mux=on,logfile=qemu.log \
-device virtio-serial-pci -device virtconsole,chardev=mux \
-serial chardev:mux -monitor chardev:mux \
-nographic
</code></pre>
<p>After the VM boots, you now have access to the installation environment.</p>
</li>
<li>
<p>Edit the <code>configuration.nix</code> file in the home directory
to customize the NixOS system to be installed:</p>
<pre><code class="language-bash">vim configuration.nix
</code></pre>
<p>The complete syntax and guidance for the <code>configuration.nix</code> file
can be found in <a href="https://nixos.org/manual/nixos/stable/#ch-configuration">the NixOS manual</a>.
If you are not familiar with NixOS,
you can simply skip this step.</p>
<p>Not all combinations of settings in <code>configuration.nix</code> are supported by Asterinas NixOS yet.
The ones that have been tested are documented in the subsequent chapters.</p>
</li>
<li>
<p>Start installation:</p>
<pre><code class="language-bash">install_aster_nixos.sh --config configuration.nix --disk /dev/vda --force-format-disk
</code></pre>
<p>The installation process involves downloading packages
and may take around 30 minutes to complete,
depending on your network speed.</p>
</li>
<li>
<p>After the installation is complete, you can shut down the VM:</p>
<pre><code class="language-bash">poweroff
</code></pre>
<p>Now Asterinas NixOS is installed in <code>aster_nixos_disk.img</code>.</p>
</li>
<li>
<p>Start a VM to boot the newly installed Asterinas NixOS:</p>
<pre><code class="language-bash">qemu-system-x86_64 \
-cpu host -m 8G -enable-kvm \
-bios /usr/share/qemu/OVMF.fd \
-drive if=none,format=raw,id=x0,file=aster_nixos_disk.img \
-device virtio-blk-pci,drive=x0,disable-legacy=on,disable-modern=off \
-chardev stdio,id=mux,mux=on,logfile=qemu.log \
-device virtio-serial-pci -device virtconsole,chardev=mux \
-serial chardev:mux -monitor chardev:mux \
-device virtio-net-pci,netdev=net0,disable-legacy=on,disable-modern=off \
-netdev user,id=net0 \
-device isa-debug-exit,iobase=0xf4,iosize=0x04 \
-nographic -display vnc=127.0.0.1:21
</code></pre>
<p>If a desktop environment is enabled in the <code>configuration.nix</code> file,
you can view the graphical interface using a VNC client.</p>
</li>
</ol>
<h3 id="kernel-developers"><a class="header" href="#kernel-developers">Kernel Developers</a></h3>
<ol>
<li>
<p>Follow Steps 1 and 2 in the <a href="#getting-started-1">‚ÄúGetting Started‚Äù section of the Asterinas Kernel</a>
to set up the development environment.</p>
</li>
<li>
<p>Inside the Docker container,
generate a disk image with Asterinas NixOS installed using this command:</p>
<pre><code class="language-bash">make nixos
</code></pre>
<p>or this command:</p>
<pre><code class="language-bash">make iso &amp;&amp; make run_iso
</code></pre>
<p>The difference between the two methods is that
the first installs NixOS to a disk image entirely inside the container,
whereas the second emulates the manual ISO installation steps
(see the <a href="#end-users">previous section</a>)
by running a VM.
Using either method results in a disk image with an Asterinas NixOS installation.</p>
</li>
<li>
<p>Start a VM to run the installed Asterinas NixOS:</p>
<pre><code class="language-bash">make run_nixos
</code></pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="popular-applications"><a class="header" href="#popular-applications">Popular Applications</a></h1>
<p>The <a href="https://search.nixos.org/packages">Nix package collection</a> contains over 120,000 packages.
Many of them may already work out of the box on Asterinas NixOS,
but it is impractical to test every package
and document its support status.
Instead, we group popular applications into categories
and document the ones we have verified to work.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="package-management"><a class="header" href="#package-management">Package Management</a></h1>
<p>NixOS provides a set of <a href="https://nix.dev/manual/nix/2.28/command-ref/main-commands">tools</a>
for building, installing, and managing packages.</p>
<h2 id="verified-usage"><a class="header" href="#verified-usage">Verified Usage</a></h2>
<h3 id="nix-build"><a class="header" href="#nix-build"><code>nix-build</code></a></h3>
<p><code>nix-build</code> builds Nix derivations and produces outputs in the Nix store.
It is the preferred way to build software reproducibly.</p>
<pre><code class="language-bash"># Step 1: Create a clean workspace
rm -rf /tmp/nix-hello-c &amp;&amp; mkdir -p /tmp/nix-hello-c &amp;&amp; cd /tmp/nix-hello-c

# Step 2: Write a C program
cat &gt; hello.c &lt;&lt;'EOF'
#include &lt;stdio.h&gt;

int main(void) {
    puts("Hello, World!");
    return 0;
}
EOF

# Step 3: Write a default.nix
cat &gt; default.nix &lt;&lt;'EOF'
{ pkgs ? import &lt;nixpkgs&gt; {} }:

pkgs.stdenv.mkDerivation {
  pname = "hello-c";
  version = "0.1.0";
  src = ./.;

  dontConfigure = true;

  buildPhase = ''
    cc hello.c -o hello
  '';

  installPhase = ''
    mkdir -p $out/bin
    install -m755 hello $out/bin/hello
  '';
}
EOF

# Step 4: Build and run
nix-build
./result/bin/hello
</code></pre>
<h3 id="nix-env"><a class="header" href="#nix-env"><code>nix-env</code></a></h3>
<p><code>nix-env</code> installs or removes individual packages in your user profile.</p>
<pre><code class="language-bash"># Install the `hello` package
nix-env -iA nixos.hello

# Remove the `hello` package
nix-env -e hello
</code></pre>
<h3 id="nix-shell"><a class="header" href="#nix-shell"><code>nix-shell</code></a></h3>
<p><code>nix-shell</code> creates a temporary development environment with the specified dependencies.
This is useful for testing software without modifying your system environment.</p>
<pre><code class="language-bash"># Enter a shell with the `hello` package available
nix-shell -p hello
</code></pre>
<h3 id="nixos-rebuild"><a class="header" href="#nixos-rebuild"><code>nixos-rebuild</code></a></h3>
<p><code>nixos-rebuild</code> manages the entire system configuration declaratively.
It applies changes defined in <code>configuration.nix</code>,
and is the recommended approach for installing packages system-wide.</p>
<pre><code class="language-bash"># Edit the system configuration file
vim /etc/nixos/configuration.nix

# Apply configuration changes and rebuild the system without rebooting
nixos-rebuild test
</code></pre>
<!--
TODO: upgrade mdbook to enable admonition blocks like the one below:

> [!WARNING]
> `nixos-rebuild switch` is not yet supported
-->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="desktop-environment"><a class="header" href="#desktop-environment">Desktop Environment</a></h1>
<h2 id="xfce"><a class="header" href="#xfce">Xfce</a></h2>
<p><a href="https://www.xfce.org/">Xfce</a> is a lightweight desktop environment for UNIX-like operating systems.</p>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<p>Add the following lines to the <code>configuration.nix</code> file:</p>
<pre><code class="language-nix">services.xserver.enable = true;
services.xserver.desktopManager.xfce.enable = true;
</code></pre>
<!--
TODO: upgrade mdbook to enable admonition blocks like the one below:

> [!WARNING]
> Xfce must be enabled during the initial installation of Asterinas NixOS. Applying configuration changes via `nixos-rebuild` is not working yet.
-->
<h3 id="verified-backends"><a class="header" href="#verified-backends">Verified Backends</a></h3>
<ul>
<li>Display server:
<ul>
<li>Xorg display server</li>
</ul>
</li>
<li>Graphics drivers:
<ul>
<li>Standard UEFI VGA framebuffer</li>
</ul>
</li>
</ul>
<h3 id="verified-functionality"><a class="header" href="#verified-functionality">Verified Functionality</a></h3>
<ul>
<li>Changing desktop wallpapers and background settings</li>
<li>Adjusting font size, style, and system theme</li>
<li>Creating application shortcuts and desktop launchers</li>
<li>Managing panels and window behavior</li>
<li>Using the settings manager and file browser</li>
</ul>
<h3 id="verified-gui-applications"><a class="header" href="#verified-gui-applications">Verified GUI Applications</a></h3>
<p>Utilities:</p>
<ul>
<li><code>galculator</code>: Calculator</li>
<li><code>mousepad</code>: The default Xfce text editor</li>
<li><code>mupdf</code>: A lightweight PDF and XPS viewer</li>
</ul>
<p>Games:</p>
<ul>
<li><code>fairymax</code>: Chess</li>
<li><code>five-or-more</code>: GNOME alignment game</li>
<li><code>lbreakout2</code>: Breakout/Arkanoid clone</li>
<li><code>gnome-chess</code>: GNOME chess</li>
<li><code>gnome-mines</code>: Minesweeper</li>
<li><code>gnome-sudoku</code>: GNOME sudoku</li>
<li><code>tali</code>: GNOME dice game</li>
<li><code>xboard</code>: Chess</li>
<li><code>xgalaga</code>: Galaga-style arcade game</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="containerization"><a class="header" href="#containerization">Containerization</a></h1>
<h2 id="podman"><a class="header" href="#podman">Podman</a></h2>
<p><a href="https://docs.podman.io/en/stable/Introduction.html">Podman</a> is a modern, daemonless container engine
that provides a Docker-compatible command-line interface,
making it easy for users familiar with Docker to transition.</p>
<h3 id="installation-1"><a class="header" href="#installation-1">Installation</a></h3>
<p>To install Podman, add the following line to <code>configuration.nix</code>:</p>
<pre><code class="language-nix">virtualization.podman.enable = true;
</code></pre>
<h3 id="verified-usage-1"><a class="header" href="#verified-usage-1">Verified Usage</a></h3>
<h4 id="podman-run"><a class="header" href="#podman-run"><code>podman run</code></a></h4>
<p><code>podman run</code> runs a command in a new container.</p>
<pre><code class="language-bash"># Start a container, execute a command, and then exit
podman run --name=c1 docker.io/library/alpine ls /etc

# Start a container and attach to an interactive shell
podman run -it docker.io/library/alpine
</code></pre>
<h4 id="podman-image"><a class="header" href="#podman-image"><code>podman image</code></a></h4>
<p><code>podman image</code> manages local images.</p>
<pre><code class="language-bash"># List downloaded images
podman image ls
</code></pre>
<h4 id="podman-ps"><a class="header" href="#podman-ps"><code>podman ps</code></a></h4>
<p><code>podman ps</code> lists containers.</p>
<pre><code class="language-bash"># Show the status of all containers (including exited ones)
podman ps -a
</code></pre>
<h4 id="podman-rm"><a class="header" href="#podman-rm"><code>podman rm</code></a></h4>
<p><code>podman rm</code> removes one or more containers.</p>
<pre><code class="language-bash"># Remove a container named foo
podman rm foo
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-kernel"><a class="header" href="#asterinas-kernel">Asterinas Kernel</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Asterinas is a <em>secure</em>, <em>fast</em>, and <em>general-purpose</em> OS kernel
that provides an <em>Linux-compatible</em> ABI.
It can serve as a seamless replacement for Linux
while enhancing <em>memory safety</em> and <em>developer friendliness</em>.</p>
<ul>
<li>
<p>Asterinas prioritizes memory safety
by employing Rust as its sole programming language
and limiting the use of <em>unsafe Rust</em>
to a clearly defined and minimal Trusted Computing Base (TCB).
This innovative approach,
known as <a href="#the-framekernel-architecture">the framekernel architecture</a>,
establishes Asterinas as a more secure and dependable kernel option.</p>
</li>
<li>
<p>Asterinas surpasses Linux in terms of developer friendliness.
It empowers kernel developers to
(1) utilize the more productive Rust programming language,
(2) leverage a purpose-built toolkit called <a href="#asterinas-kernel">OSDK</a> to streamline their workflows,
and (3) choose between releasing their kernel modules as open source
or keeping them proprietary,
thanks to the flexibility offered by <a href="">MPL</a>.</p>
</li>
</ul>
<p>While the journey towards a production-grade OS kernel can be challenging,
we are steadfastly progressing towards our goal.
Currently, Asterinas only supports x86-64 VMs.
However, <a href="#roadmap">our aim for 2024</a> is
to make Asterinas production-ready on x86-64
for both bare-metal and VM environments.</p>
<h2 id="getting-started-1"><a class="header" href="#getting-started-1">Getting Started</a></h2>
<p>Get yourself an x86-64 Linux machine with Docker installed.
Follow the three simple steps below to get Asterinas up and running.</p>
<!-- REMINDER: Be careful when editing the first two steps
since `distro/README.md` references them -->
<ol>
<li>
<p>Download the latest source code.</p>
<pre><code class="language-bash">git clone https://github.com/asterinas/asterinas
</code></pre>
</li>
<li>
<p>Run a Docker container as the development environment.</p>
<pre><code class="language-bash">docker run -it --privileged \
            --network=host \
            -v /dev:/dev \
            -v $(pwd)/asterinas:/root/asterinas \
            asterinas/asterinas:0.17.0-20260227
</code></pre>
</li>
<li>
<p>Inside the container, go to the project folder to build and run Asterinas.</p>
<pre><code class="language-bash">make kernel
make run_kernel
</code></pre>
</li>
</ol>
<p>If everything goes well, Asterinas is now up and running inside a VM.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="advanced-build-and-test-instructions"><a class="header" href="#advanced-build-and-test-instructions">Advanced Build and Test Instructions</a></h1>
<h2 id="user-mode-unit-tests"><a class="header" href="#user-mode-unit-tests">User-Mode Unit Tests</a></h2>
<p>Asterinas consists of many crates,
some of which do not require a VM environment
and can be tested with the standard <code>cargo test</code>.
They are listed in the root <code>Makefile</code>
and can be tested together through the following Make command.</p>
<pre><code class="language-bash">make test
</code></pre>
<p>To test an individual crate, enter the directory of the crate and invoke <code>cargo test</code>.</p>
<h3 id="kernel-mode-unit-tests"><a class="header" href="#kernel-mode-unit-tests">Kernel-Mode Unit Tests</a></h3>
<p>Many crates in Asterinas do require a VM environment to be tested.
The unit tests for these crates are empowered by OSDK.</p>
<pre><code class="language-bash">make ktest
</code></pre>
<p>To test an individual crate in kernel mode, enter the directory of the crate and invoke <code>cargo osdk test</code>.</p>
<pre><code class="language-bash">cd asterinas/ostd
cargo osdk test
</code></pre>
<h2 id="integration-test"><a class="header" href="#integration-test">Integration Test</a></h2>
<h3 id="general-test"><a class="header" href="#general-test">General Test</a></h3>
<p>The following command builds and runs the test binaries in <code>test/initramfs/src/apps</code> directory on Asterinas.</p>
<pre><code class="language-bash">make run_kernel AUTO_TEST=test
</code></pre>
<h3 id="syscall-test"><a class="header" href="#syscall-test">Syscall Test</a></h3>
<p>The following command builds and runs the syscall test binaries on Asterinas.</p>
<pre><code class="language-bash">make run_kernel AUTO_TEST=syscall
</code></pre>
<p>To run system call tests interactively, start an instance of Asterinas with the system call tests built and installed.</p>
<pre><code class="language-bash">make run_kernel BUILD_SYSCALL_TEST=1
</code></pre>
<p>Then, in the interactive shell, run the following script to start the syscall tests.</p>
<pre><code class="language-bash">/opt/syscall_test/run_syscall_test.sh
</code></pre>
<h2 id="debug"><a class="header" href="#debug">Debug</a></h2>
<h3 id="using-gdb-to-debug"><a class="header" href="#using-gdb-to-debug">Using GDB to Debug</a></h3>
<p>To debug Asterinas via <a href="https://qemu-project.gitlab.io/qemu/system/gdb.html">QEMU GDB support</a>,
you can compile Asterinas in the debug profile,
start an Asterinas instance and run the GDB interactive shell in another terminal.</p>
<p>Start a GDB-enabled VM of Asterinas with OSDK and wait for debugging connection:</p>
<pre><code class="language-bash">make gdb_server
</code></pre>
<p>The server will listen at the default address specified in <code>Makefile</code>, i.e., a local TCP port <code>:1234</code>.
Change the address in <code>Makefile</code> for your convenience,
and check <code>cargo osdk run -h</code> for more details about the address.</p>
<p>Two options are provided to interact with the debug server.</p>
<ul>
<li>
<p>A GDB client: start a GDB client in another terminal.</p>
<pre><code class="language-bash">make gdb_client
</code></pre>
</li>
<li>
<p>VS Code: <a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a> extension is required.
After starting a debug server with OSDK from the shell with <code>make gdb_server</code>,
a temporary <code>launch.json</code> is generated under <code>.vscode</code>.
Your previous launch configs will be restored after the server is down.
Press <code>F5</code>(Run and Debug) to start a debug session via VS Code.
Click <code>Continue</code>(or, press <code>F5</code>) at the first break to resume the paused server instance,
then it will continue until reaching your first breakpoint.</p>
</li>
</ul>
<p>Note that if debugging with KVM enabled, you must use hardware assisted breakpoints. See ‚Äúhbreak‚Äù in
<a href="https://ftp.gnu.org/old-gnu/Manuals/gdb/html_node/gdb_28.html">the GDB manual</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="intel-tdx"><a class="header" href="#intel-tdx">Intel TDX</a></h1>
<p>Asterinas can serve as a secure guest OS for Intel TDX-protected virtual machines (VMs).
This documentation describes
how Asterinas can be run and tested easily on a TDX-enabled Intel server.</p>
<p>Intel TDX (Trust Domain Extensions) is a Trusted Execution Environment (TEE) technology
that enhances VM security
by creating isolated, hardware-enforced trust domains
with encrypted memory, secure initialization, and attestation mechanisms.
For more information about Intel TDX, jump to the last section.</p>
<h2 id="why-choose-asterinas-for-intel-tdx"><a class="header" href="#why-choose-asterinas-for-intel-tdx">Why choose Asterinas for Intel TDX</a></h2>
<p>VM TEEs such as Intel TDX deserve a more secure option for its guest OS than Linux.
Linux,
with its inherent memory safety issues and large Trusted Computing Base (TCB),
has long suffered from security vulnerabilities due to memory safety bugs.
Additionally,
when Linux is used as the guest kernel inside a VM TEE,
it must process untrusted inputs
(over 1500 instances in Linux, per Intel‚Äôs estimation)
from the host (via hypercalls, MMIO, and etc.).
These untrusted inputs create new attack surfaces
that can be exploited through memory safety vulnerabilities,
known as Iago attacks.</p>
<p>Asterinas offers greater memory safety than Linux,
particularly against Iago attacks.
Thanks to its framekernel architecture,
the memory safety of Asterinas relies solely on the Asterinas Framework,
excluding the safe device drivers built on top of the Asterinas Framework
that may handle untrusted inputs from the host.
For more information, see <a href="https://www.youtube.com/watch?v=3AQ5lpXujGo">our talk on OC3‚Äô24</a>.</p>
<h2 id="prepare-the-intel-tdx-environment"><a class="header" href="#prepare-the-intel-tdx-environment">Prepare the Intel TDX Environment</a></h2>
<p>Please make sure your server supports Intel TDX.</p>
<p>See <a href="https://github.com/canonical/tdx/tree/noble-24.04?tab=readme-ov-file#4-setup-host-os">this guide</a>
or other materials to enable Intel TDX in host OS.</p>
<p>To verify the TDX host status,
you can type:</p>
<pre><code class="language-bash">dmesg | grep "TDX module initialized"
</code></pre>
<p>The following result is an example:</p>
<pre><code class="language-bash">[   20.507296] tdx: TDX module initialized.
</code></pre>
<p><code>TDX module initialized</code> means TDX module is loaded successfully.</p>
<h2 id="build-and-run-asterinas"><a class="header" href="#build-and-run-asterinas">Build and run Asterinas</a></h2>
<ol>
<li>
<p>Download the latest source code.</p>
<pre><code class="language-bash">git clone https://github.com/asterinas/asterinas
</code></pre>
</li>
<li>
<p>Run a Docker container as the development environment.</p>
<pre><code class="language-bash">docker run -it --privileged --network=host --device=/dev/kvm -v $(pwd)/asterinas:/root/asterinas asterinas/asterinas:0.17.0-20260227
</code></pre>
</li>
<li>
<p>Inside the container,
go to the project folder to build and run Asterinas.</p>
<pre><code class="language-bash">make run_kernel INTEL_TDX=1
</code></pre>
</li>
</ol>
<p>If everything goes well,
Asterinas is now up and running inside a TD.</p>
<h2 id="using-gdb-to-debug-1"><a class="header" href="#using-gdb-to-debug-1">Using GDB to Debug</a></h2>
<p>A Trust Domain (TD) is debuggable if its <code>ATTRIBUTES.DEBUG</code> bit is 1.
In this mode, the host VMM can use Intel TDX module functions
to read and modify TD VCPU state and TD private memory,
which are not accessible when the TD is non-debuggable.</p>
<p>Start Asterinas in a GDB-enabled TD and wait for debugging connection:</p>
<pre><code class="language-bash">make gdb_server INTEL_TDX=1
</code></pre>
<p>Behind the scene, this command adds <code>debug=on</code> configuration to the QEMU parameters
to enable TD debuggable mode.</p>
<p>The server will listen at the default address specified in <code>Makefile</code>,
i.e., a local TCP port <code>:1234</code>.</p>
<p>Start a GDB client in another terminal:</p>
<pre><code class="language-bash">make gdb_client INTEL_TDX=1
</code></pre>
<p>Note that you must use hardware assisted breakpoints
because KVM is enabled when debugging a TD.</p>
<h2 id="about-intel-tdx"><a class="header" href="#about-intel-tdx">About Intel TDX</a></h2>
<p>Intel¬Æ Trust Domain Extensions (Intel¬Æ TDX)
is Intel‚Äôs newest confidential computing technology.
This hardware-based trusted execution environment (TEE)
facilitates the deployment of trust domains (TD),
which are hardware-isolated virtual machines (VM) designed to
protect sensitive data and applications from unauthorized access.</p>
<p>A CPU-measured Intel TDX module enables Intel TDX.
This software module runs in a new CPU Secure Arbitration Mode (SEAM)
as a peer virtual machine manager (VMM),
and supports TD entry and exit
using the existing virtualization infrastructure.
The module is hosted in a reserved memory space
identified by the SEAM Range Register (SEAMRR).</p>
<p>Intel TDX uses hardware extensions for managing and encrypting memory
and protects both the confidentiality and integrity
of the TD CPU state from non-SEAM mode.</p>
<p>Intel TDX uses architectural elements such as SEAM,
a shared bit in Guest Physical Address (GPA),
secure Extended Page Table (EPT),
physical-address-metadata table,
Intel¬Æ Total Memory Encryption ‚Äì Multi-Key (Intel¬Æ TME-MK),
and remote attestation.</p>
<p>Intel TDX ensures data integrity, confidentiality, and authenticity,
which empowers engineers and tech professionals
to create and maintain secure systems,
enhancing trust in virtualized environments.</p>
<p>For more information,
please refer to <a href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html">Intel TDX website</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="the-framekernel-architecture"><a class="header" href="#the-framekernel-architecture">The Framekernel Architecture</a></h1>
<h2 id="framekernel-what-and-why"><a class="header" href="#framekernel-what-and-why">Framekernel: What and Why</a></h2>
<blockquote>
<p>The security of a microkernel, the speed of a monolithic kernel.</p>
</blockquote>
<p>Asterinas introduces a novel OS architecture called <em>framekernel</em>,
which unleashes the full power of Rust
to bring the best of both monolithic kernels and microkernels.</p>
<p>Within the framekernel architecture,
the entire OS resides in the same address space (like a monolithic kernel)
and is required to be written in Rust.
However, there‚Äôs a twist‚Äîthe kernel is partitioned in two halves:
the OS Framework (akin to a microkernel)
and the OS Services.
Only the OS Framework is allowed to use <em>unsafe Rust</em>,
while the OS Services must be written exclusively in <em>safe Rust</em>.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Unsafe Rust</th><th>Responsibilities</th><th>Code Sizes</th></tr>
</thead>
<tbody>
<tr><td>OS Framework</td><td>Allowed</td><td>Encapsulate low-level unsafe code within high-level safe APIs</td><td>Small</td></tr>
<tr><td>OS Services</td><td>Not allowed</td><td>Implement OS functionalities, e.g., system calls, file systems, device drivers</td><td>Large</td></tr>
</tbody>
</table>
</div>
<p>As a result,
the memory safety of the kernel can be reduced to that of the OS Framework,
thus minimizing the Trusted Computing Base (TCB)
associated with the kernel‚Äôs memory safety.
On the other hand,
the single address space allows different parts of the kernel
to communicate in the most efficient means,
e.g., function calls and shared memory.
Thanks to the framekernel architecture,
Asterinas can offer both exceptional performance and enhanced safety.</p>
<p><img src="images/a_comparison_between_os_archs.svg" alt="A comparison between different OS architectures"></p>
<h2 id="requirements-for-the-os-framework"><a class="header" href="#requirements-for-the-os-framework">Requirements for the OS Framework</a></h2>
<p>While the concept of framekernel is straightforward,
the design and implementation of the required OS framework present challenges.
It must concurrently fulfill four criteria.</p>
<p><img src="images/four_requirements_for_os_framework.svg" alt="The four requirements for the OS framework"></p>
<ul>
<li><strong>Soundness.</strong>
The safe APIs of the framework are considered sound
if no <a href="https://doc.rust-lang.org/reference/behavior-considered-undefined.html#behavior-considered-undefined">undefined behaviors</a> shall be triggered
by whatever safe Rust code that a programmer may write using the APIs</li>
</ul>
<ul>
<li>as long as the code is verified by the Rust toolchain.
Soundness ensures that the OS framework,
in conjunction with the Rust toolchain,
bears the full responsibility for the kernel‚Äôs memory safety.</li>
</ul>
<ul>
<li>
<p><strong>Expressiveness.</strong>
The framework should empower developers
to implement a substantial range of OS functionalities
in safe Rust using the APIs.
It is especially important that
the framework enables writing device drivers in safe Rust,
considering that device drivers comprise the bulk of the code
in a fully-fleged OS kernel (like Linux).</p>
</li>
<li>
<p><strong>Minimalism.</strong>
As the TCB for memory safety,
the framework should be kept as small as possible.
No functionality should be implemented inside the framework
if doing it outside is possible.</p>
</li>
<li>
<p><strong>Efficiency.</strong>
The safe API provided by the framework is only allowed
to introduce minimal overheads.
Ideally, these APIs should be realized
as <a href="https://monomorph.is/posts/zero-cost-abstractions/">zero-cost abstractions</a>.</p>
</li>
</ul>
<p>Fortunately, our efforts
to design and implement an OS framework meeting these standards
have borne fruit in the form of the <a href="ostd">Asterinas OSTD</a>.
Using this framework as a foundation,
we have developed the Asterinas Kernel;
this framework also enables others to create their own framekernels,
with different goals and tradeoffs.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="linux-compatibility"><a class="header" href="#linux-compatibility">Linux Compatibility</a></h1>
<blockquote>
<p>‚ÄúWe don‚Äôt break user space.‚Äù</p>
<p>‚Äî Linus Torvalds</p>
</blockquote>
<p>Asterinas is dedicated to maintaining compatibility with the Linux ABI,
ensuring that applications and administrative tools
designed for Linux can seamlessly operate within Asterinas.
While we prioritize compatibility,
it is important to note that Asterinas does not,
nor will it in the future,
support the loading of Linux kernel modules.</p>
<h2 id="system-calls"><a class="header" href="#system-calls">System Calls</a></h2>
<p>At the time of writing,
Asterinas supports over 230 Linux system calls for the x86-64 architecture,
which are summarized in the table below.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Numbers</th><th>Names</th><th>Supported</th><th>Flag Coverage</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>read</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>1</td><td>write</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>2</td><td>open</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#open-and-openat">‚ö†Ô∏è</a></td></tr>
<tr><td>3</td><td>close</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>4</td><td>stat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>5</td><td>fstat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>6</td><td>lstat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>7</td><td>poll</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#poll-and-ppoll">‚ö†Ô∏è</a></td></tr>
<tr><td>8</td><td>lseek</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#lseek">‚ö†Ô∏è</a></td></tr>
<tr><td>9</td><td>mmap</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mmap-and-munmap">‚ö†Ô∏è</a></td></tr>
<tr><td>10</td><td>mprotect</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mprotect">‚ö†Ô∏è</a></td></tr>
<tr><td>11</td><td>munmap</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>12</td><td>brk</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>13</td><td>rt_sigaction</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#rt_sigaction">‚ö†Ô∏è</a></td></tr>
<tr><td>14</td><td>rt_sigprocmask</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#rt_sigprocmask">‚ö†Ô∏è</a></td></tr>
<tr><td>15</td><td>rt_sigreturn</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>16</td><td>ioctl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioctl">‚ö†Ô∏è</a></td></tr>
<tr><td>17</td><td>pread64</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>18</td><td>pwrite64</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>19</td><td>readv</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>20</td><td>writev</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>21</td><td>access</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>22</td><td>pipe</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>23</td><td>select</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>24</td><td>sched_yield</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>25</td><td>mremap</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mremap">‚ö†Ô∏è</a></td></tr>
<tr><td>26</td><td>msync</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#msync">‚ö†Ô∏è</a></td></tr>
<tr><td>27</td><td>mincore</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>28</td><td>madvise</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#madvise">‚ö†Ô∏è</a></td></tr>
<tr><td>29</td><td>shmget</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>30</td><td>shmat</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>31</td><td>shmctl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>32</td><td>dup</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>33</td><td>dup2</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>34</td><td>pause</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>35</td><td>nanosleep</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>36</td><td>getitimer</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>37</td><td>alarm</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>38</td><td>setitimer</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>39</td><td>getpid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>40</td><td>sendfile</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>41</td><td>socket</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#socket">‚ö†Ô∏è</a></td></tr>
<tr><td>42</td><td>connect</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#connect">‚ö†Ô∏è</a></td></tr>
<tr><td>43</td><td>accept</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#accept-and-accept4">‚ö†Ô∏è</a></td></tr>
<tr><td>44</td><td>sendto</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">‚ö†Ô∏è</a></td></tr>
<tr><td>45</td><td>recvfrom</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#recvfrom-and-recvmsg">‚ö†Ô∏è</a></td></tr>
<tr><td>46</td><td>sendmsg</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">‚ö†Ô∏è</a></td></tr>
<tr><td>47</td><td>recvmsg</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#recvfrom-and-recvmsg">‚ö†Ô∏è</a></td></tr>
<tr><td>48</td><td>shutdown</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>49</td><td>bind</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#bind">‚ö†Ô∏è</a></td></tr>
<tr><td>50</td><td>listen</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>51</td><td>getsockname</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>52</td><td>getpeername</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>53</td><td>socketpair</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#socketpair">‚ö†Ô∏è</a></td></tr>
<tr><td>54</td><td>setsockopt</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#getsockopt-and-setsockopt">‚ö†Ô∏è</a></td></tr>
<tr><td>55</td><td>getsockopt</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#getsockopt-and-setsockopt">‚ö†Ô∏è</a></td></tr>
<tr><td>56</td><td>clone</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#clone-and-clone3">‚ö†Ô∏è</a></td></tr>
<tr><td>57</td><td>fork</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>58</td><td>vfork</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>59</td><td>execve</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>60</td><td>exit</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>61</td><td>wait4</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#wait4">‚ö†Ô∏è</a></td></tr>
<tr><td>62</td><td>kill</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>63</td><td>uname</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>64</td><td>semget</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semget">‚ö†Ô∏è</a></td></tr>
<tr><td>65</td><td>semop</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semop-and-semtimedop">‚ö†Ô∏è</a></td></tr>
<tr><td>66</td><td>semctl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semctl">‚ö†Ô∏è</a></td></tr>
<tr><td>67</td><td>shmdt</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>68</td><td>msgget</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>69</td><td>msgsnd</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>70</td><td>msgrcv</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>71</td><td>msgctl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>72</td><td>fcntl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#fcntl">‚ö†Ô∏è</a></td></tr>
<tr><td>73</td><td>flock</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>74</td><td>fsync</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>75</td><td>fdatasync</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>76</td><td>truncate</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>77</td><td>ftruncate</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>78</td><td>getdents</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>79</td><td>getcwd</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>80</td><td>chdir</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>81</td><td>fchdir</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>82</td><td>rename</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>83</td><td>mkdir</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>84</td><td>rmdir</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>85</td><td>creat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>86</td><td>link</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>87</td><td>unlink</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>88</td><td>symlink</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>89</td><td>readlink</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>90</td><td>chmod</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>91</td><td>fchmod</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>92</td><td>chown</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>93</td><td>fchown</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>94</td><td>lchown</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>95</td><td>umask</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>96</td><td>gettimeofday</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>97</td><td>getrlimit</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>98</td><td>getrusage</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#getrusage">‚ö†Ô∏è</a></td></tr>
<tr><td>99</td><td>sysinfo</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>100</td><td>times</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>101</td><td>ptrace</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>102</td><td>getuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>103</td><td>syslog</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>104</td><td>getgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>105</td><td>setuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>106</td><td>setgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>107</td><td>geteuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>108</td><td>getegid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>109</td><td>setpgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>110</td><td>getppid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>111</td><td>getpgrp</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>112</td><td>setsid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>113</td><td>setreuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>114</td><td>setregid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>115</td><td>getgroups</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>116</td><td>setgroups</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>117</td><td>setresuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>118</td><td>getresuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>119</td><td>setresgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>120</td><td>getresgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>121</td><td>getpgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>122</td><td>setfsuid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>123</td><td>setfsgid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>124</td><td>getsid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>125</td><td>capget</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#capget-and-capset">‚ö†Ô∏è</a></td></tr>
<tr><td>126</td><td>capset</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#capget-and-capset">‚ö†Ô∏è</a></td></tr>
<tr><td>127</td><td>rt_sigpending</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>128</td><td>rt_sigtimedwait</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>129</td><td>rt_sigqueueinfo</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>130</td><td>rt_sigsuspend</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>131</td><td>sigaltstack</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>132</td><td>utime</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>133</td><td>mknod</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>134</td><td>uselib</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>135</td><td>personality</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>136</td><td>ustat</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>137</td><td>statfs</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>138</td><td>fstatfs</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>139</td><td>sysfs</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>140</td><td>getpriority</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>141</td><td>setpriority</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>142</td><td>sched_setparam</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>143</td><td>sched_getparam</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>144</td><td>sched_setscheduler</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_setscheduler">‚ö†Ô∏è</a></td></tr>
<tr><td>145</td><td>sched_getscheduler</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>146</td><td>sched_get_priority_max</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>147</td><td>sched_get_priority_min</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>148</td><td>sched_rr_get_interval</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>149</td><td>mlock</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>150</td><td>munlock</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>151</td><td>mlockall</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>152</td><td>munlockall</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>153</td><td>vhangup</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>154</td><td>modify_ldt</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>155</td><td>pivot_root</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>156</td><td>_sysctl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>157</td><td>prctl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#prctl">‚ö†Ô∏è</a></td></tr>
<tr><td>158</td><td>arch_prctl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#arch_prctl">‚ö†Ô∏è</a></td></tr>
<tr><td>159</td><td>adjtimex</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>160</td><td>setrlimit</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>161</td><td>chroot</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>162</td><td>sync</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>163</td><td>acct</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>164</td><td>settimeofday</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>165</td><td>mount</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#mount">‚ö†Ô∏è</a></td></tr>
<tr><td>166</td><td>umount2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#umount-and-umount2">‚ö†Ô∏è</a></td></tr>
<tr><td>167</td><td>swapon</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>168</td><td>swapoff</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>169</td><td>reboot</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#reboot">‚ö†Ô∏è</a></td></tr>
<tr><td>170</td><td>sethostname</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>171</td><td>setdomainname</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>172</td><td>iopl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>173</td><td>ioperm</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>174</td><td>create_module</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>175</td><td>init_module</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>176</td><td>delete_module</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>177</td><td>get_kernel_syms</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>178</td><td>query_module</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>179</td><td>quotactl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>180</td><td>nfsservctl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>181</td><td>getpmsg</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>182</td><td>putpmsg</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>183</td><td>afs_syscall</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>184</td><td>tuxcall</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>185</td><td>security</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>186</td><td>gettid</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>187</td><td>readahead</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>188</td><td>setxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>189</td><td>lsetxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>190</td><td>fsetxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>191</td><td>getxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>192</td><td>lgetxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>193</td><td>fgetxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>194</td><td>listxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>195</td><td>llistxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>196</td><td>flistxattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>197</td><td>removexattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>198</td><td>lremovexattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>199</td><td>fremovexattr</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>200</td><td>tkill</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>201</td><td>time</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>202</td><td>futex</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#futex">‚ö†Ô∏è</a></td></tr>
<tr><td>203</td><td>sched_setaffinity</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>204</td><td>sched_getaffinity</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>205</td><td>set_thread_area</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>206</td><td>io_setup</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>207</td><td>io_destroy</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>208</td><td>io_getevents</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>209</td><td>io_submit</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>210</td><td>io_cancel</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>211</td><td>get_thread_area</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>212</td><td>lookup_dcookie</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>213</td><td>epoll_create</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>214</td><td>epoll_ctl_old</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>215</td><td>epoll_wait_old</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>216</td><td>remap_file_pages</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>217</td><td>getdents64</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>218</td><td>set_tid_address</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>219</td><td>restart_syscall</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>220</td><td>semtimedop</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semop-and-semtimedop">‚ö†Ô∏è</a></td></tr>
<tr><td>221</td><td>fadvise64</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#fadvise64">‚ö†Ô∏è</a></td></tr>
<tr><td>222</td><td>timer_create</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timer_create">‚ö†Ô∏è</a></td></tr>
<tr><td>223</td><td>timer_settime</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>224</td><td>timer_gettime</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>225</td><td>timer_getoverrun</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>226</td><td>timer_delete</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>227</td><td>clock_settime</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>228</td><td>clock_gettime</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#clock_gettime">‚ö†Ô∏è</a></td></tr>
<tr><td>229</td><td>clock_getres</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>230</td><td>clock_nanosleep</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#clock_nanosleep">‚ö†Ô∏è</a></td></tr>
<tr><td>231</td><td>exit_group</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>232</td><td>epoll_wait</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>233</td><td>epoll_ctl</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#epoll_ctl">‚ö†Ô∏è</a></td></tr>
<tr><td>234</td><td>tgkill</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>235</td><td>utimes</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>236</td><td>vserver</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>237</td><td>mbind</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>238</td><td>set_mempolicy</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>239</td><td>get_mempolicy</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>240</td><td>mq_open</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>241</td><td>mq_unlink</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>242</td><td>mq_timedsend</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>243</td><td>mq_timedreceive</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>244</td><td>mq_notify</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>245</td><td>mq_getsetattr</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>246</td><td>kexec_load</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>247</td><td>waitid</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#waitid">‚ö†Ô∏è</a></td></tr>
<tr><td>248</td><td>add_key</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>249</td><td>request_key</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>250</td><td>keyctl</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>251</td><td>ioprio_set</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioprio_set-and-ioprio_get">‚ö†Ô∏è</a></td></tr>
<tr><td>252</td><td>ioprio_get</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioprio_set-and-ioprio_get">‚ö†Ô∏è</a></td></tr>
<tr><td>253</td><td>inotify_init</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>254</td><td>inotify_add_watch</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#inotify_add_watch">‚ö†Ô∏è</a></td></tr>
<tr><td>255</td><td>inotify_rm_watch</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>256</td><td>migrate_pages</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>257</td><td>openat</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#open-and-openat">‚ö†Ô∏è</a></td></tr>
<tr><td>258</td><td>mkdirat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>259</td><td>mknodat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>260</td><td>fchownat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>261</td><td>futimesat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>262</td><td>newfstatat</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#newfstatat">‚ö†Ô∏è</a></td></tr>
<tr><td>263</td><td>unlinkat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>264</td><td>renameat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>265</td><td>linkat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>266</td><td>symlinkat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>267</td><td>readlinkat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>268</td><td>fchmodat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>269</td><td>faccessat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>270</td><td>pselect6</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>271</td><td>ppoll</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#poll-and-ppoll">‚ö†Ô∏è</a></td></tr>
<tr><td>272</td><td>unshare</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#unshare">‚ö†Ô∏è</a></td></tr>
<tr><td>273</td><td>set_robust_list</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>274</td><td>get_robust_list</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>275</td><td>splice</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>276</td><td>tee</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>277</td><td>sync_file_range</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>278</td><td>vmsplice</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>279</td><td>move_pages</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>280</td><td>utimensat</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#utimensat">‚ö†Ô∏è</a></td></tr>
<tr><td>281</td><td>epoll_pwait</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>282</td><td>signalfd</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>283</td><td>timerfd_create</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timerfd_create">‚ö†Ô∏è</a></td></tr>
<tr><td>284</td><td>eventfd</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>285</td><td>fallocate</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#fallocate">‚ö†Ô∏è</a></td></tr>
<tr><td>286</td><td>timerfd_settime</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timerfd_settime">‚ö†Ô∏è</a></td></tr>
<tr><td>287</td><td>timerfd_gettime</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>288</td><td>accept4</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#accept-and-accept4">‚ö†Ô∏è</a></td></tr>
<tr><td>289</td><td>signalfd4</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>290</td><td>eventfd2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#eventfd-and-eventfd2">‚ö†Ô∏è</a></td></tr>
<tr><td>291</td><td>epoll_create1</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>292</td><td>dup3</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>293</td><td>pipe2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#pipe-and-pipe2">‚ö†Ô∏è</a></td></tr>
<tr><td>294</td><td>inotify_init1</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#inotify_init-and-inotify_init1">‚ö†Ô∏è</a></td></tr>
<tr><td>295</td><td>preadv</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>296</td><td>pwritev</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>297</td><td>rt_tgsigqueueinfo</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>298</td><td>perf_event_open</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>299</td><td>recvmmsg</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>300</td><td>fanotify_init</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>301</td><td>fanotify_mark</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>302</td><td>prlimit64</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>303</td><td>name_to_handle_at</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>304</td><td>open_by_handle_at</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>305</td><td>clock_adjtime</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>306</td><td>syncfs</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>307</td><td>sendmmsg</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">‚ö†Ô∏è</a></td></tr>
<tr><td>308</td><td>setns</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#setns">‚ö†Ô∏è</a></td></tr>
<tr><td>309</td><td>getcpu</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>310</td><td>process_vm_readv</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>311</td><td>process_vm_writev</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>312</td><td>kcmp</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>313</td><td>finit_module</td><td>‚ùå</td><td>N/A</td></tr>
<tr><td>314</td><td>sched_setattr</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_getattr-and-sched_setattr">‚ö†Ô∏è</a></td></tr>
<tr><td>315</td><td>sched_getattr</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_getattr-and-sched_setattr">‚ö†Ô∏è</a></td></tr>
<tr><td>316</td><td>renameat2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#renameat2">‚ö†Ô∏è</a></td></tr>
<tr><td>318</td><td>getrandom</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#getrandom">‚ö†Ô∏è</a></td></tr>
<tr><td>319</td><td>memfd_create</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#memfd_create">‚ö†Ô∏è</a></td></tr>
<tr><td>322</td><td>execveat</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>327</td><td>preadv2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#preadv2-and-pwritev2">‚ö†Ô∏è</a></td></tr>
<tr><td>328</td><td>pwritev2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#preadv2-and-pwritev2">‚ö†Ô∏è</a></td></tr>
<tr><td>332</td><td>statx</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#statx">‚ö†Ô∏è</a></td></tr>
<tr><td>424</td><td>pidfd_send_signal</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>434</td><td>pidfd_open</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>435</td><td>clone3</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#clone-and-clone3">‚ö†Ô∏è</a></td></tr>
<tr><td>436</td><td>close_range</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>438</td><td>pidfd_getfd</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>439</td><td>faccessat2</td><td>‚úÖ</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#faccessat2">‚ö†Ô∏è</a></td></tr>
<tr><td>441</td><td>epoll_pwait2</td><td>‚úÖ</td><td>üíØ</td></tr>
<tr><td>452</td><td>fchmodat2</td><td>‚úÖ</td><td>üíØ</td></tr>
</tbody>
</table>
</div>
<ul>
<li>
<p>Supported:</p>
<ul>
<li>‚úÖ = syscall supported</li>
<li>‚ùå = not supported</li>
</ul>
</li>
<li>
<p>Flag Coverage:</p>
<ul>
<li>üíØ = all flags/commands/modes are supported</li>
<li>‚ö†Ô∏è = syscall works, but some flags/modes are not implemented</li>
<li>‚ùì = implementation exists, but we have not audited its coverage yet</li>
<li>N/A = not applicable (e.g., syscall not supported)</li>
</ul>
</li>
</ul>
<p>Most of these system calls (or their variants) are also supported
for the RISC-V and LoongArch architectures.</p>
<h2 id="file-systems"><a class="header" href="#file-systems">File Systems</a></h2>
<p>Here is the list of supported file systems:</p>
<ul>
<li>Devfs</li>
<li>Devpts</li>
<li>Ext2</li>
<li>Procfs</li>
<li>Ramfs</li>
</ul>
<h2 id="sockets"><a class="header" href="#sockets">Sockets</a></h2>
<p>Here is the list of supported socket types:</p>
<ul>
<li>TCP sockets over IPv4</li>
<li>UDP sockets over IPv4</li>
<li>Unix sockets</li>
</ul>
<h2 id="vdso"><a class="header" href="#vdso">vDSO</a></h2>
<p>Here is the list of supported symbols in vDSO:</p>
<ul>
<li><code>__vdso_clock_gettime</code></li>
<li><code>__vdso_gettimeofday</code></li>
<li><code>__vdso_time</code></li>
</ul>
<h2 id="boot-protocols"><a class="header" href="#boot-protocols">Boot Protocols</a></h2>
<p>Here is the list of supported boot protocols:</p>
<ul>
<li><a href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html">Multiboot</a></li>
<li><a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">Multiboot2</a></li>
<li><a href="https://www.kernel.org/doc/html/v5.4/x86/boot.html#bit-boot-protocol">Linux 32-bit boot protocol</a></li>
<li><a href="https://www.kernel.org/doc/html/v5.4/x86/boot.html#efi-handover-protocol">Linux EFI handover</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="syscall-flag-coverage"><a class="header" href="#syscall-flag-coverage">Syscall Flag Coverage</a></h1>
<p>This section documents the flag coverage of Asterinas‚Äôs implementation of Linux system calls.
It introduces <a href="#system-call-matching-language-scml"><strong>System Call Matching Language (SCML)</strong></a>,
a lightweight domain‚Äëspecific language for
specifying allowed and disallowed patterns of system‚Äëcall invocations.</p>
<p>The rest of this section uses SCML
to accurately and concisely describe
both supported and unsupported functionality of system calls,
which are divided into the following categories:</p>
<ul>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management">Process and thread management</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management">Memory management</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations">File &amp; directory operations</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control">File systems &amp; mount control</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control">File descriptor &amp; I/O control</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication">Inter-process communication</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets">Networking &amp; sockets</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers">Signals &amp; timers</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security">Namespaces, cgroups &amp; security</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc">System information &amp; misc</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="system-call-matching-language-scml"><a class="header" href="#system-call-matching-language-scml">System Call Matching Language (SCML)</a></h1>
<p>SCML specifies matching patterns for system‚Äëcall invocations.
Asterinas developers can easily write SCML rules to describe supported patterns.
Likewise, users and developers can intuitively read these rules
to understand which system calls and features are available.</p>
<p>SCML is designed to integrate seamlessly with
<a href="https://man7.org/linux/man-pages/man1/strace.1.html">strace</a>,
the standard Linux system‚Äëcall tracer.
Strace emits each invocation in a C‚Äëstyle syntax;
given a set of SCML rules,
a tool can automatically determine
whether a strace log entry conforms to the supported patterns.
This paves the way for an SCML‚Äëbased analyzer
that reports unsupported calls in any application‚Äôs trace.</p>
<h2 id="strace-a-quick-example"><a class="header" href="#strace-a-quick-example">Strace: A Quick Example</a></h2>
<p>To illustrate, run strace on a simple ‚ÄúHello, World!‚Äù program:</p>
<pre><code class="language-bash">$ strace ./hello_world
</code></pre>
<p>A typical trace might look like this:</p>
<pre><code class="language-shell">execve("./hello_world", ["./hello_world"], 0xffffffd3f710 /* 4 vars */) = 0
brk(NULL)                               = 0xaaaabdc1b000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xffff890f4000
openat(AT_FDCWD, "/lib/aarch64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0\360\206\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=1722920, ...}) = 0
‚Ä¶
write(1, "Hello, World!\n", 14)         = 14
exit_group(0)                           = ?
</code></pre>
<p>Key points of this output:</p>
<ul>
<li>System calls are rendered as <code>name(arg1, ‚Ä¶, argN)</code>.</li>
<li>Flags appear as <code>FLAG1|FLAG2|‚Ä¶|FLAGN</code>.</li>
<li>Structs use <code>{field1=value1, ‚Ä¶}</code>.</li>
<li>Arrays are shown as <code>[value1, ‚Ä¶]</code>.</li>
</ul>
<p>SCML‚Äôs syntax draws directly from these conventions.</p>
<h2 id="scml-by-example"><a class="header" href="#scml-by-example">SCML by Example</a></h2>
<p>SCML is intentionally simple:
most Linux system‚Äëcall semantics hinge on bitflags.
SCML rules act as templates:
you define a rule once,
and a human or an analyzer uses it to check if a syscall invocation matches it or not.</p>
<p>Imagine you‚Äôre developing a Linux-compatible OS (like Asterinas)
that supports just a restricted subset of syscalls and their options.
We will use SCML to describe the restricted functionality.</p>
<h3 id="matching-rules-for-system-calls"><a class="header" href="#matching-rules-for-system-calls">Matching Rules for System Calls</a></h3>
<p>For example,
your OS supports the <a href="https://man7.org/linux/man-pages/man2/openat.2.html"><code>open</code></a> system call
with one or more of the four flags: <code>O_RDONLY</code>, <code>O_WRONLY</code>, <code>O_RDWR</code>, and <code>O_CLOEXEC</code>:
This constraint can be expressed in the following system call matching rule.</p>
<pre><code class="language-c">open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC);
</code></pre>
<p>To allow file creation,
you add another matching rule that
includes the <code>O_CREAT</code> flag and requires a <code>mode</code> argument:</p>
<pre><code class="language-c">open(path, flags = O_CREAT | O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, mode);
</code></pre>
<p>To support the <code>O_PATH</code> flag
(only valid with <code>O_CLOEXEC</code>, not with  <code>O_RDONLY</code>, <code>O_WRONLY</code>, or <code>O_RDWR</code>),
you add a third matching rule:</p>
<pre><code class="language-c">open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<p>SCML rules constrain only the flagged arguments;
other parameters (like <code>path</code> and <code>mode</code>) accept any value.</p>
<p>In many system calls, the number of arguments may vary depending on the flags provided.
To accommodate this, SCML allows you to use the <code>..</code> wildcard in the parameter list.
This indicates that any additional arguments are accepted, regardless of their value or count.</p>
<p>For example:</p>
<pre><code class="language-c">open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, ..);
</code></pre>
<p>Here, the <code>..</code> wildcard makes the rule flexible enough to match invocations of <code>open</code> with extra parameters,
such as when the <code>O_CREAT</code> flag is present and a <code>mode</code> argument is required.
This approach makes it easy to write concise rules that only constrain the arguments of interest,
while allowing other parameters to vary as needed.</p>
<h3 id="c-style-comments"><a class="header" href="#c-style-comments">C-Style Comments</a></h3>
<p>SCML also supports C‚Äëstyle comments:</p>
<pre><code class="language-c">// All matching rules for the open syscall.
// A supported invocation of the open syscall must match at least one of the rules.
open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC);
open(path, flags = O_CREAT | O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, mode);
open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<h3 id="matching-rules-for-bitflags"><a class="header" href="#matching-rules-for-bitflags">Matching Rules for Bitflags</a></h3>
<p>Above, we embedded flag combinations directly within individual system‚Äëcall rules,
which can lead to duplication and make maintenance harder.
SCML allows you to define named bitflag rules that
can be reused across multiple rules.
This reduces repetition and centralizes your flag definitions.
For example:</p>
<pre><code class="language-c">// Define a reusable bitflags rule
access_mode = O_RDONLY | O_WRONLY | O_RDWR;

open(path, flags = &lt;access_mode&gt; | O_CLOEXEC);
open(path, flags = O_CREAT | &lt;access_mode&gt; | O_CLOEXEC, mode);
open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<h3 id="matching-rules-for-structs"><a class="header" href="#matching-rules-for-structs">Matching Rules for Structs</a></h3>
<p>SCML can match flags inside struct fields.
Consider <a href="https://man7.org/linux/man-pages/man2/sigaction.2.html"><code>sigaction</code></a>:</p>
<pre><code class="language-c">struct sigaction = {
    sa_flags = SA_NOCLDSTOP | SA_NOCLDWAIT,
    ..
};
</code></pre>
<p>Here, <code>..</code> is a wildcard for remaining fields that we do not care.</p>
<p>Then, we can write a system call rule that
refers to the struct rule using the <code>&lt;struct_rule&gt;</code> syntax.</p>
<pre><code class="language-c">sigaction(signum, act = &lt;sigaction&gt;, oldact = &lt;sigaction&gt;);
</code></pre>
<p>Instead of defining a separate struct rule,
you can also inline the struct pattern directly in the parameter list.
This is convenient when the struct pattern is only used once
or when you want to express different constraints for the same struct type in different contexts.</p>
<p>For example, the following rule inlines the struct pattern for <code>capget</code>:</p>
<pre><code class="language-c">capget(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);
</code></pre>
<h3 id="matching-rules-for-arrays"><a class="header" href="#matching-rules-for-arrays">Matching Rules for Arrays</a></h3>
<p>SCML can describe how to match flags embedded inside the struct values of an array.
This is the case of the <a href="https://man7.org/linux/man-pages/man2/poll.2.html"><code>poll</code></a> system call.
It takes an array of values of <code>struct pollfd</code>,
whose <code>event</code> and <code>revents</code> fields are bitflags.</p>
<pre><code class="language-c">// Support all but the POLLPRI flags
events = POLLIN | POLLOUT | POLLRDHUP | POLLERR | POLLHUP | POLLNVAL;

struct pollfd = {
    events  = &lt;events&gt;,
    revents = &lt;events&gt;,
    ..
};

poll(fds = [ &lt;pollfd&gt; ], nfds, timeout);
</code></pre>
<p>Notice how SCML denotes an array with the <code>[ &lt;struct_rule&gt; ]</code> syntax.</p>
<h3 id="special-built-in-matching-rules"><a class="header" href="#special-built-in-matching-rules">Special Built-in Matching Rules</a></h3>
<p>Bitflags-based matching rules described above are expressive enough to
capture most patterns of interesting system call arguments.
But some system call arguments cannot be characterized with bitflags.
To address such cases, SCML introduces two special built-in matching rules:
<code>&lt;PATH&gt;</code> and <code>&lt;INTEGER&gt;</code></p>
<h4 id="the-file-path-matching-rule"><a class="header" href="#the-file-path-matching-rule">The file path matching rule</a></h4>
<p>The <code>&lt;PATH&gt;</code> matching rule is used to
denote a system call argument of a C-string file path.
For example, the matching rules for the <code>open</code> system call
can be enhanced with <code>&lt;PATH&gt;</code> as follows:</p>
<pre><code class="language-c">access_mode = O_RDONLY | O_WRONLY | O_RDWR;

open(path = &lt;PATH&gt;, flags = &lt;access_mode&gt; | O_CLOEXEC);
open(path = &lt;PATH&gt;, flags = O_CREAT | &lt;access_mode&gt; | O_CLOEXEC, mode);
open(path = &lt;PATH&gt;, flags = O_PATH | O_CLOEXEC);
</code></pre>
<p>File paths provide a new dimension to determine whether a system call is supported or not.
Linux has multiple pseudo file systems such as
DevTmpFS, ProcFS, SysFS, CgroupFS, and ConfigFS,
mounted at well-known locations.
A Linux-compatible OS such as Asterinas may only support a sub-tree of an pseudo FS.
Knowing which system call arguments refer to file paths,
a tool may be built to automatically issue warnings
when unsupported file paths are accessed by system calls.</p>
<h4 id="the-integer-matching-rule"><a class="header" href="#the-integer-matching-rule">The integer matching rule</a></h4>
<p>The <code>&lt;INTEGER&gt;</code> matching rule can match any integer system call argument
such as <code>1234</code>, <code>-100</code>, <code>0xdeadbeef</code>, and <code>0o666</code>.
It can be used as a fallback rule
when a system call takes an argument of either bitflags or integer.</p>
<pre><code class="language-c">timer_create(
    clockid =
        // Static clock IDs represented as bitflags
        CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID | CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_BOOTTIME |
        // Dynamic clock IDs (per-process or per-thread clock IDs)
        // represented as an integer value.
        &lt;INTEGER&gt;,
    sevp,
    timerid
);
</code></pre>
<h3 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced Usage</a></h3>
<p>Just like you can write multiple rules of the same system call,
you may define multiple rules for the same struct:</p>
<pre><code class="language-c">// Rules for control message header
struct cmsghdr = {
    cmsg_level = SOL_SOCKET,
    cmsg_type  = SO_TIMESTAMP_OLD | SCM_RIGHTS | SCM_CREDENTIALS,
    ..
};
struct cmsghdr = {
    cmsg_level = SOL_IP,
    cmsg_type  = IP_TTL,
    ..
};
</code></pre>
<p>A <code>cmsghdr</code> value matches if it satisfies any one rule.</p>
<p>Struct rules may also be nested:</p>
<pre><code class="language-c">// Rule for message header, which refers to the rules for control message header
struct msghdr = {
    msg_control = [ &lt;cmsghdr&gt; ],
    ..
};

recvmsg(socket, message = &lt;msghdr&gt;, flags);
</code></pre>
<p>SCML supports arrays with nested structures and heterogeneous element types,
as encountered in system calls like <code>recvmsg</code> where netlink message payloads
follow the TLV (Type-Length-Value) format.
Arrays can contain multiple elements of varying types:
inline struct patterns (<code>{ ... }</code>), nested arrays (<code>[ ... ]</code>),
or references to named rules (<code>&lt;identifier&gt;</code>).
This flexibility allows SCML to represent hierarchical data structures
as they appear in strace output.</p>
<p>For example, when receiving a netlink message about adding a network address:</p>
<pre><code class="language-c">struct iovec = {
    iov_base = [
        [
            {
                nlmsg_type = RTM_NEWADDR,
                ..
            },
            [
                [ { nla_type = IFA_CACHEINFO, .. } ]
            ]
        ]
    ],
    ..
};

recvmsg(
    sockfd,
    msg = {
        msg_iov = [ &lt;iovec&gt; ],
        ..
    },
    flags
);
</code></pre>
<p>This example demonstrates receiving a netlink message of type
<code>RTM_NEWADDR</code> containing nested attributes with cache information
(<code>IFA_CACHEINFO</code>). The nested array structure illustrates how SCML
handles heterogeneous arrays where elements can be both structs and
nested arrays, reflecting the hierarchical TLV encoding typical of netlink.</p>
<h2 id="formal-syntax"><a class="header" href="#formal-syntax">Formal Syntax</a></h2>
<p>Below is the formal syntax of SCML,
expressed in Extended Backus‚ÄìNaur Form (EBNF).
Non‚Äëterminals are in angle brackets, terminals in quotes.</p>
<pre><code>&lt;scml&gt;           ::= { &lt;rule&gt; }
&lt;rule&gt;           ::= &lt;syscall-rule&gt; ';' 
                   | &lt;struct-rule&gt; ';'
                   | &lt;bitflags-rule&gt; ';'

&lt;syscall-rule&gt;   ::= &lt;identifier&gt; '(' [ &lt;param-list&gt; ] ')'
&lt;param-list&gt;     ::= '..'
                   | &lt;param&gt; { ',' &lt;param&gt; } [ ',' '..' ]
&lt;param&gt;          ::= &lt;identifier&gt; '=' &lt;flag-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;struct-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;array-pattern&gt;
                   | &lt;identifier&gt;

&lt;flag-pattern&gt;   ::= &lt;flag-part&gt; { '|' &lt;flag-part&gt; }
&lt;flag-part&gt;      ::= &lt;identifier&gt;
                   | '&lt;' &lt;identifier&gt; '&gt;'

&lt;array-pattern&gt;  ::= '[' &lt;array-element&gt; { ',' &lt;array-element&gt; } ']'
&lt;array-element&gt;  ::= '&lt;' &lt;identifier&gt; '&gt;'
                   | &lt;struct-pattern&gt;
                   | &lt;array-pattern&gt;

&lt;struct-rule&gt;    ::= 'struct' &lt;identifier&gt; '=' &lt;struct-pattern&gt;
&lt;struct-pattern&gt; ::= '{' &lt;field-list&gt; [ ',' '..' ] '}'
&lt;field-list&gt;     ::= &lt;field&gt; { ',' &lt;field&gt; }
&lt;field&gt;          ::= &lt;identifier&gt;
                   | &lt;identifier&gt; '=' &lt;flag-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;struct-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;array-pattern&gt;

&lt;bitflags-rule&gt;  ::= &lt;identifier&gt; '=' &lt;flag-pattern&gt;

&lt;identifier&gt;     ::= letter { letter | digit | '_' }

comment          ::= '//' { any-char }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="process--thread-management"><a class="header" href="#process--thread-management">Process &amp; Thread Management</a></h1>
<!--
Put system calls such as
fork, vfork, clone, execve, exit, exit_group, wait4, waitid,
getpid, getppid, gettid, setuid, setgid, getuid, getgid, and prctl
under this category.
-->
<h3 id="sched_getattr-and-sched_setattr"><a class="header" href="#sched_getattr-and-sched_setattr"><code>sched_getattr</code> and <code>sched_setattr</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Get the scheduling policy of a "normal" thread
sched_getattr(
    pid,
    attr = {
        sched_policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
// Set the scheduling policy of a "normal" thread
sched_setattr(
    pid,
    attr = {
        sched_policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE,
        sched_flags = 0,
        ..
    },
    flags = 0,
);

// Get the scheduling policy of a real-time thread
sched_getattr(
    pid,
    attr = {
        sched_policy = SCHED_FIFO | SCHED_RR,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
// Set the scheduling policy of a real-time thread
sched_setattr(
    pid,
    attr = {
        sched_policy = SCHED_FIFO | SCHED_RR,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
</code></pre>
<p>Unsupported scheduling policies:</p>
<ul>
<li><code>SCHED_DEADLINE</code></li>
</ul>
<p>Unsupported scheduling flags:</p>
<ul>
<li><code>SCHED_FLAG_RESET_ON_FORK</code></li>
<li><code>SCHED_FLAG_RECLAIM</code></li>
<li><code>SCHED_FLAG_DL_OVERRUN</code></li>
<li><code>SCHED_FLAG_UTIL_CLAMP_MIN</code></li>
<li><code>SCHED_FLAG_UTIL_CLAMP_MAX</code></li>
</ul>
<h3 id="wait4"><a class="header" href="#wait4"><code>wait4</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Wait until a specified child process undergoes a state change (termination, stopping and resumption)
wait4(
    pid, wstatus,
    options = WNOHANG | WSTOPPED | WCONTINUED | WNOWAIT,
    rusage
);
</code></pre>
<p>Ignored options:</p>
<ul>
<li><code>WEXITED</code></li>
<li><code>WNOTHREAD</code></li>
<li><code>WALL</code></li>
<li><code>WCLONE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/wait4.2.html">the man page</a>.</p>
<h3 id="clone-and-clone3"><a class="header" href="#clone-and-clone3"><code>clone</code> and <code>clone3</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">signal_flags = SIGHUP | SIGINT | SIGQUIT | SIGILL |
               SIGTRAP | SIGABRT | SIGSTKFLT | SIGFPE |
               SIGKILL | SIGBUS | SIGSEGV | SIGXCPU |
               SIGPIPE | SIGALRM | SIGTERM | SIGUSR1 |
               SIGUSR2 | SIGCHLD | SIGPWR | SIGVTALRM |
               SIGPROF | SIGIO | SIGWINCH | SIGSTOP |
               SIGTSTP | SIGCONT | SIGTTIN | SIGTTOU |
               SIGURG | SIGXFSZ | SIGSYS | SIGRTMIN;

opt_flags =
    // Optional flags
    //
    // Share the parent's virtual memory
    CLONE_VM |
    // Share the parent's filesystem
    CLONE_FS |
    // Share the parent's file descriptor table
    CLONE_FILES |
    // Share the parent's signal handlers
    CLONE_SIGHAND |
    // Place child in the same thread group as parent
    CLONE_THREAD |
    // Share the parent's System V semaphore adjustments
    CLONE_SYSVSEM |
    // Suspend parent until the child exits or calls `execve`
    CLONE_VFORK |
    // Create a new mount namespace for the child
    CLONE_NEWNS |
    // Write child `TID` to parent's memory
    CLONE_PARENT_SETTID |
    // Allocate a `PID` file descriptor for the child
    CLONE_PIDFD |
    // Set thread-local storage for the child
    CLONE_SETTLS |
    // Write child `TID` to child's memory
    CLONE_CHILD_SETTID |
    // Clear child `TID` in child's memory on exit
    CLONE_CHILD_CLEARTID |
    // Make the child's parent the same as the caller's parent
    CLONE_PARENT;

// Create a thread or process
clone(
    fn, stack,
    flags = &lt;opt_flags&gt; | &lt;signal_flags&gt;,
    func_arg, ..
);

// Create a thread or process with enhanced control by providing structured arguments
clone3(
    clone_args = {
        flags = &lt;opt_flags&gt;,
        ..
    },
    size
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/clone.2.html">the man page</a>.</p>
<h3 id="sched_setscheduler"><a class="header" href="#sched_setscheduler"><code>sched_setscheduler</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Set scheduling policy
sched_setscheduler(pid, policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE | SCHED_FIFO | SCHED_RR, param);
</code></pre>
<p>Unsupported policies or flags:</p>
<ul>
<li><code>SCHED_RESET_ON_FORK</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/sched_setscheduler.2.html">the man page</a>.</p>
<h3 id="waitid"><a class="header" href="#waitid"><code>waitid</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Wait for a child process to change state
waitid(
    which = P_PID | P_PIDFD | P_PGID | P_ALL,
    pid, infop,
    options = WNOHANG | WSTOPPED | WCONTINUED | WNOWAIT,
    ru
);
</code></pre>
<p>Ignored options:</p>
<ul>
<li><code>WEXITED</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/waitid.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="memory-management"><a class="header" href="#memory-management">Memory Management</a></h1>
<!--
Put system calls such as 
brk, mmap, munmap, mprotect, mremap, msync, mincore, madvise, 
shmget, shmat, shmctl, mlock, munlock, mbind, and set_mempolicy
under this part.
-->
<h2 id="memory-mappings"><a class="header" href="#memory-mappings">Memory Mappings</a></h2>
<h3 id="mmap-and-munmap"><a class="header" href="#mmap-and-munmap"><code>mmap</code> and <code>munmap</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">prot = PROT_NONE |
    PROT_EXEC |
    PROT_READ |
    PROT_WRITE;
opt_flags =
    MAP_ANONYMOUS |
    MAP_FIXED |
    MAP_FIXED_NOREPLACE |
    MAP_GROWSDOWN |
    MAP_HUGETLB |
    MAP_LOCKED |
    MAP_NONBLOCK |
    MAP_NORESERVE |
    MAP_POPULATE;

// Create a private memory mapping
mmap(
    addr, length,
    prot = &lt;prot&gt;,
    flags = MAP_PRIVATE | &lt;opt_flags&gt;,
    fd, offset
);

// Create a shared memory mapping
mmap(
    addr, length,
    prot = &lt;prot&gt;,
    flags = MAP_SHARED | MAP_SHARED_VALIDATE | &lt;opt_flags&gt;,
    fd, offset
);

// Unmap a memory mapping
munmap(addr, length);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MAP_HUGETLB</code></li>
<li><code>MAP_GROWSDOWN</code></li>
<li><code>MAP_LOCKED</code></li>
<li><code>MAP_NONBLOCK</code></li>
<li><code>MAP_NORESERVE</code></li>
<li><code>MAP_POPULATE</code></li>
</ul>
<p>Partially supported flags:</p>
<ul>
<li><code>MAP_FIXED_NOREPLACE</code> is treated as <code>MAP_FIXED</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>MAP_32BIT</code></li>
<li><code>MAP_HUGE_1GB</code></li>
<li><code>MAP_HUGE_2MB</code></li>
<li><code>MAP_UNINITIALIZED</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">the man page</a>.</p>
<h3 id="msync"><a class="header" href="#msync"><code>msync</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Flush memory region to disk asynchronously
msync(
    addr, length,
    flags = MS_ASYNC | MS_INVALIDATE
);

// Flush memory region to disk synchronously
msync(
    addr, length,
    flags = MS_SYNC | MS_INVALIDATE
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MS_INVALIDATE</code> is ignored because all processes use the same page cache</li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/msync.2.html">the man page</a>.</p>
<h3 id="mremap"><a class="header" href="#mremap"><code>mremap</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Resize an existing memory mapping. Relocation is allowed if given `MREMAP_MAYMOVE`.
mremap(
    old_address,
    old_size,
    new_size,
    flags = MREMAP_MAYMOVE
);

// Resize an existing memory mapping and force relocation to a specified location.
mremap(
    old_address,
    old_size,
    new_size,
    flags = MREMAP_MAYMOVE | MREMAP_FIXED,
    new_address
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/mremap.2.html">the man page</a>.</p>
<h3 id="mprotect"><a class="header" href="#mprotect"><code>mprotect</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">prot = PROT_NONE |
    PROT_EXEC |
    PROT_READ |
    PROT_WRITE;

// Set memory access permissions
mprotect(
    addr,
    len,
    prot = &lt;prot&gt;
);
</code></pre>
<p>Silently-ignored protection flags:</p>
<ul>
<li><code>PROT_SEM</code></li>
<li><code>PROT_SAO</code></li>
<li><code>PROT_GROWSUP</code></li>
<li><code>PROT_GROWSDOWN</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/mprotect.2.html">the man page</a>.</p>
<h3 id="madvise"><a class="header" href="#madvise"><code>madvise</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Do not expect access in the near future and free associated resources
madvise(addr, length, advice = MADV_DONTNEED);
</code></pre>
<p>Silently-ignored advice:</p>
<ul>
<li><code>MADV_NORMAL</code></li>
<li><code>MADV_RANDOM</code></li>
<li><code>MADV_SEQUENTIAL</code></li>
<li><code>MADV_WILLNEED</code></li>
<li><code>MADV_FREE</code></li>
<li><code>MADV_MERGEABLE</code></li>
<li><code>MADV_UNMERGEABLE</code></li>
<li><code>MADV_HUGEPAGE</code></li>
<li><code>MADV_NOHUGEPAGE</code></li>
</ul>
<p>Unsupported advice:</p>
<ul>
<li><code>MADV_RANDOM</code></li>
<li><code>MADV_REMOVE</code></li>
<li><code>MADV_DONTFORK</code></li>
<li><code>MADV_DOFORK</code></li>
<li><code>MADV_HWPOISON</code></li>
<li><code>MADV_UNMERGEABLE</code></li>
<li><code>MADV_SOFT_OFFLINE</code></li>
<li><code>MADV_DONTDUMP</code></li>
<li><code>MADV_DODUMP</code></li>
<li><code>MADV_FREE</code></li>
<li><code>MADV_WIPEONFORK</code></li>
<li><code>MADV_KEEPONFORK</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/madvise.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-and-directory-operations"><a class="header" href="#file-and-directory-operations">File and Directory Operations</a></h1>
<!--
Put system calls such as
open, openat, creat, close, read, write, readv, writev, pread64, 
pwrite64, lseek, stat, fstat, lstat, statx, mkdir, rmdir, link, 
unlink, rename, symlink, readlink, chmod, fchmod, chown, fchown, 
utime, and utimensat
under this category.
-->
<h3 id="open-and-openat"><a class="header" href="#open-and-openat"><code>open</code> and <code>openat</code></a></h3>
<p>Supported functionality of <code>open</code> in SCML:</p>
<pre><code class="language-c">access_mode =
    O_RDONLY |
    O_WRONLY |
    O_RDWR;
creation_flags =
    O_CLOEXEC |
    O_DIRECTORY |
    O_EXCL |
    O_NOCTTY |
    O_NOFOLLOW |
    O_TRUNC;
status_flags =
    O_APPEND |
    O_ASYNC |
    O_DIRECT |
    O_LARGEFILE |
    O_NOATIME |
    O_NONBLOCK |
    O_SYNC;

// Open an existing file
open(
    path,
    flags = &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
);
openat(
    dirfd,
    path,
    flags = &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
);

// Create a new file
open(
    path,
    flags = O_CREAT | &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
    mode
);
openat(
    dirfd,
    path,
    flags = O_CREAT | &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
    mode
);

// Status flags that are meaningful with O_PATH
opath_valid_flags = O_CLOEXEC | O_DIRECTORY | O_NOFOLLOW;
// All other flags are ignored with O_PATH
opath_ignored_flags = O_CREAT | &lt;creation_flags&gt; | &lt;status_flags&gt;;
// Obtain a file descriptor to indicate a location in FS
open(
    path,
    flags = O_PATH | &lt;opath_valid_flags&gt; | &lt;opath_ignored_flags&gt;
);
openat(
    dirfd,
    path,
    flags = O_PATH | &lt;opath_valid_flags&gt; | &lt;opath_ignored_flags&gt;
);

// Create an unnamed file
// open(path, flags = O_TMPFILE | &lt;creation_flags&gt; | &lt;status_flags&gt;)
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>O_NOCTTY</code></li>
<li><code>O_DSYNC</code></li>
<li><code>O_SYNC</code></li>
<li><code>O_LARGEFILE</code></li>
<li><code>O_NOATIME</code></li>
<li><code>O_NOCTTY</code></li>
</ul>
<p>Partially-supported flags:</p>
<ul>
<li><code>O_PATH</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>O_TMPFILE</code></li>
</ul>
<p>Supported and unsupported functionality of <code>openat</code> are the same as <code>open</code>.
The SCML rules are omitted for brevity.</p>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/openat.2.html">the man page</a>.</p>
<h3 id="renameat2"><a class="header" href="#renameat2"><code>renameat2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Rename a file, moving it between directories if required.
renameat2(olddirfd, oldpath, newdirfd, newpath, 0);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>RENAME_EXCHANGE</code></li>
<li><code>RENAME_NOREPLACE</code></li>
<li><code>RENAME_WHITEOUT</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/rename.2.html">the man page</a>.</p>
<h3 id="lseek"><a class="header" href="#lseek"><code>lseek</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Set file offset
lseek(
    fd, offset,
    whence = SEEK_SET | SEEK_CUR | SEEK_END
);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>SEEK_DATA</code></li>
<li><code>SEEK_HOLE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/lseek.2.html">the man page</a>.</p>
<h3 id="newfstatat"><a class="header" href="#newfstatat"><code>newfstatat</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Retrieve file status by file descriptor
newfstatat(
    dirfd, path, statbuf,
    flags = AT_EMPTY_PATH | AT_SYMLINK_NOFOLLOW
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_NO_AUTOMOUNT</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/newfstatat.2.html">the man page</a>.</p>
<h3 id="preadv2-and-pwritev2"><a class="header" href="#preadv2-and-pwritev2"><code>preadv2</code> and <code>pwritev2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Read data from multiple buffers
preadv2(fd, iov, iovcnt, offset, flags = 0);

// Write data to multiple buffers
pwritev2(fd, iov, iovcnt, offset, flags = 0);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>RWF_DSYNC</code></li>
<li><code>RWF_HIPRI</code></li>
<li><code>RWF_SYNC</code></li>
<li><code>RWF_NOWAIT</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>RWF_APPEND</code></li>
<li><code>RWF_NOAPPEND</code></li>
<li><code>RWF_ATOMIC</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/preadv2.2.html">the man page</a>.</p>
<h3 id="faccessat2"><a class="header" href="#faccessat2"><code>faccessat2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Check user's permissions for a file
faccessat2(
    dirfd, path, mode,
    flags = AT_EMPTY_PATH | AT_SYMLINK_NOFOLLOW
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_EACCESS</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/faccessat2.2.html">the man page</a>.</p>
<h3 id="statx"><a class="header" href="#statx"><code>statx</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">statx_flags = AT_EMPTY_PATH | AT_NO_AUTOMOUNT | AT_STATX_FORCE_SYNC |
              AT_STATX_DONT_SYNC | AT_STATX_SYNC_AS_STAT | AT_SYMLINK_NOFOLLOW;
statx_mask = STATX_TYPE | STATX_MODE | STATX_NLINK | STATX_UID | STATX_GID |
             STATX_ATIME | STATX_MTIME | STATX_CTIME | STATX_INO | STATX_SIZE |
             STATX_BLOCKS | STATX_BASIC_STATS | STATX_BTIME | STATX_ALL |
             STATX_MNT_ID | STATX_DIOALIGN | STATX_MNT_ID_UNIQUE | STATX_SUBVOL |
             STATX_WRITE_ATOMIC | STATX_DIO_READ_ALIGN;

// Get file status (extended)
statx(
    dirfd, pathname,
    flags = &lt;statx_flags&gt;,
    mask = &lt;statx_mask&gt;,
    statxbuf
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_NO_AUTOMOUNT</code></li>
<li><code>AT_STATX_FORCE_SYNC</code></li>
<li><code>AT_STATX_DONT_SYNC</code></li>
</ul>
<p>Silently-ignored masks:</p>
<ul>
<li><code>STATX_DIOALIGN</code></li>
<li><code>STATX_MNT_ID_UNIQUE</code></li>
<li><code>STATX_SUBVOL</code></li>
<li><code>STATX_WRITE_ATOMIC</code></li>
<li><code>STATX_DIO_READ_ALIGN</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/statx.2.html">the man page</a>.</p>
<h3 id="fallocate"><a class="header" href="#fallocate"><code>fallocate</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Allocate disk space within the range specified
fallocate(fd, mode = FALLOC_FL_KEEP_SIZE, offset, size);

// Deallocate space (create a hole) while keeping the file size unchanged
fallocate(fd, mode = FALLOC_FL_PUNCH_HOLE | FALLOC_FL_KEEP_SIZE, offset, size);
</code></pre>
<p>Unsupported modes:</p>
<ul>
<li><code>FALLOC_FL_UNSHARE_RANGE</code></li>
<li><code>FALLOC_FL_COLLAPSE_RANGE</code></li>
<li><code>FALLOC_FL_ZERO_RANGE</code></li>
<li><code>FALLOC_FL_INSERT_RANGE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/fallocate.2.html">the man page</a>.</p>
<h3 id="utimensat"><a class="header" href="#utimensat"><code>utimensat</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Change file timestamps with nanosecond precision
utimensat(dirfd, path, times, flags = AT_SYMLINK_NOFOLLOW);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>AT_EMPTY_PATH</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/utimensat.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-systems--mount-control"><a class="header" href="#file-systems--mount-control">File Systems &amp; Mount Control</a></h1>
<!--
Put system calls such as
mount, umount2, pivot_root, statfs, fstatfs, truncate, ftruncate, fsync, 
fdatasync, sync, syncfs, sync_file_range, open_tree, move_mount, fsopen,
fsconfig, fsmount, fspick, inotify_init, inotify_init1, inotify_add_watch,
inotify_rm_watch
under this category.
-->
<h2 id="mount-and-unmount-file-systems"><a class="header" href="#mount-and-unmount-file-systems">Mount and Unmount File Systems</a></h2>
<h3 id="mount"><a class="header" href="#mount"><code>mount</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create a new mount
mount(
    source, target, filesystemtype,
    mountflags = 0,
    data
);

// Move the existing mount point
mount(
    source, target, filesystemtype,
    mountflags = MS_MOVE,
    data
);

// Create a bind mount
mount(
    source, target, filesystemtype,
    mountflags = MS_BIND | MS_REC,
    data
);
</code></pre>
<p>Partially supported mount flags:</p>
<ul>
<li><code>MS_REC</code> is only effective when used in conjunction with <code>MS_BIND</code></li>
<li><code>MS_REMOUNT</code> can be used, but the set options have no actual effect.</li>
<li><code>MS_DIRSYNC</code> can be set but have no actual effect.</li>
<li><code>MS_LAZYTIME</code> can be set but have no actual effect.</li>
<li><code>MS_MANDLOCK</code> can be set but have no actual effect.</li>
<li><code>MS_NOATIME</code> can be set but have no actual effect.</li>
<li><code>MS_NODEV</code> can be set but have no actual effect.</li>
<li><code>MS_NODIRATIME</code> can be set but have no actual effect.</li>
<li><code>MS_NOEXEC</code> can be set but have no actual effect.</li>
<li><code>MS_NOSUID</code> can be set but have no actual effect.</li>
<li><code>MS_RDONLY</code> can be set but have no actual effect.</li>
<li><code>MS_RELATIME</code> can be set but have no actual effect.</li>
<li><code>MS_SILENT</code> can be set but have no actual effect.</li>
<li><code>MS_STRICTATIME</code> can be set but have no actual effect.</li>
<li><code>MS_SYNCHRONOUS</code> can be set but have no actual effect.</li>
</ul>
<p>Unsupported mount flags:</p>
<ul>
<li><code>MS_SHARED</code></li>
<li><code>MS_SLAVE</code></li>
<li><code>MS_UNBINDABLE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/mount.2.html">the man page</a>.</p>
<h3 id="umount-and-umount2"><a class="header" href="#umount-and-umount2"><code>umount</code> and <code>umount2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Unmount a mounted file system
umount(target);

// Unmount a mounted file system with enhanced behavior control
umount2(target, flags = UMOUNT_NOFOLLOW);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MNT_FORCE</code></li>
<li><code>MNT_DETACH</code></li>
<li><code>MNT_EXPIRE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/umount.2.html">the man page</a>.</p>
<h2 id="event-notifications"><a class="header" href="#event-notifications">Event Notifications</a></h2>
<h3 id="inotify_init-and-inotify_init1"><a class="header" href="#inotify_init-and-inotify_init1"><code>inotify_init</code> and <code>inotify_init1</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create an inotify instance
inotify_init();

// Create an inotify instance with enhanced behavior control
inotify_init1(flags = IN_CLOEXEC | IN_NONBLOCK);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/inotify_init.2.html">the man page</a>.</p>
<h3 id="inotify_add_watch"><a class="header" href="#inotify_add_watch"><code>inotify_add_watch</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">inotify_events = IN_ACCESS | IN_MODIFY | IN_ATTRIB | IN_CLOSE_WRITE |
                 IN_CLOSE_NOWRITE | IN_OPEN | IN_CREATE | IN_DELETE |
                 IN_DELETE_SELF | IN_CLOSE;

inotify_controls = IN_ONLYDIR | IN_DONT_FOLLOW | IN_MASK_CREATE |
                   IN_MASK_ADD | IN_ONESHOT;

// Add a watch to an initialized inotify instance
inotify_add_watch(fd, pathname, mask = &lt;inotify_events&gt; | &lt;inotify_controls&gt;);
</code></pre>
<p>Unsupported event flags:</p>
<ul>
<li><code>IN_MOVED_FROM</code> and <code>IN_MOVED_TO</code> - Move events are not generated</li>
<li><code>IN_MOVE_SELF</code> - Self move events are not generated</li>
<li><code>IN_UNMOUNT</code> - Unmount events are not generated</li>
<li><code>IN_Q_OVERFLOW</code> - Queue overflow events are not generated (events are silently dropped when queue is full)</li>
<li><code>IN_ALL_EVENTS</code> - Only includes actually supported events</li>
</ul>
<p>Unsupported control flags:</p>
<ul>
<li><code>IN_EXCL_UNLINK</code> - Events on unlinked files are not excluded</li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man7/inotify.7.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-descriptor-and-io-control"><a class="header" href="#file-descriptor-and-io-control">File Descriptor and I/O Control</a></h1>
<!--
Put system calls such as
dup, dup2, dup3, fcntl, ioctl, pipe, pipe2, splice, tee, vmsplice, sendfile,
eventfd, eventfd2, memfd_create and fadvise64
under this category.
-->
<h3 id="fcntl"><a class="header" href="#fcntl"><code>fcntl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">ignore_flags = O_RDONLY | O_WRONLY | O_RDWR | O_CREAT | O_EXCL | O_NOCTTY | O_TRUNC;
can_change_flags = O_APPEND | O_ASYNC | O_DIRECT | O_NOATIME | O_NONBLOCK;

// Duplicate a file descriptor
fcntl(fd, cmd = F_DUPFD | F_DUPFD_CLOEXEC, arg);

// Retrieve file descriptor flags (F_GETFD), file status flags (F_GETFL)
// or SIGIO/SIGURG owner process (F_GETOWN)
fcntl(fd, cmd = F_GETFD | F_GETFL | F_GETOWN);

// Set file descriptor flags
fcntl(fd, cmd = F_SETFD, arg = FD_CLOEXEC);

// Set file status flags
fcntl(fd, cmd = F_SETFL, arg = &lt;ignore_flags&gt; | &lt;can_change_flags&gt;);

// Manage record locks: test (F_GETLK), non-blocking set (F_SETLK), blocking set (F_SETLKW)
fcntl(fd, cmd = F_GETLK | F_SETLK | F_SETLKW, arg);

// Assign SIGIO/SIGURG owner process
fcntl(fd, cmd = F_SETOWN, arg);

// Add seals to the inode referred to
fcntl(fd, cmd = F_ADD_SEALS, arg = F_SEAL_SEAL | F_SEAL_SHRINK | F_SEAL_GROW | F_SEAL_WRITE | F_SEAL_FUTURE_WRITE);

// Get seals from the inode referred to
fcntl(fd, cmd = F_GET_SEALS);
</code></pre>
<p>Unsupported commands:</p>
<ul>
<li><code>F_NOTIFY</code></li>
<li><code>F_OFD_SETLK</code>, <code>F_OFD_SETLKW</code> and <code>F_OFD_GETLK</code></li>
<li><code>F_GETOWN_EX</code> and <code>F_SETOWN_EX</code></li>
<li><code>F_GETSIG</code> and <code>F_SETSIG</code></li>
<li><code>F_SETLEASE</code> and <code>F_GETLEASE</code></li>
<li><code>F_SETPIPE_SZ</code> and <code>F_GETPIPE_SZ</code></li>
<li><code>F_GET_RW_HINT</code> and <code>F_SET_RW_HINT</code></li>
<li><code>F_GET_FILE_RW_HINT</code> and <code>F_SET_FILE_RW_HINT</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/fcntl.2.html">the man page</a>.</p>
<h3 id="pipe-and-pipe2"><a class="header" href="#pipe-and-pipe2"><code>pipe</code> and <code>pipe2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create pipe
pipe(pipefd);

// Create pipe with enhanced behavior control
pipe2(pipefd, flags = O_CLOEXEC);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>O_DIRECT</code></li>
<li><code>O_NONBLOCK</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/pipe.2.html">the man page</a>.</p>
<h3 id="eventfd-and-eventfd2"><a class="header" href="#eventfd-and-eventfd2"><code>eventfd</code> and <code>eventfd2</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create event notification descriptor
eventfd(initval);

// Create event notification descriptor with enhanced behavior control
eventfd2(initval, flags = EFD_CLOEXEC);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>EFD_NONBLOCK</code></li>
<li><code>EFD_SEMAPHORE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/eventfd.2.html">the man page</a>.</p>
<h3 id="memfd_create"><a class="header" href="#memfd_create"><code>memfd_create</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create an anonymous file and return a file descriptor that refers to it
memfd_create(name, flags = MFD_CLOEXEC | MFD_ALLOW_SEALING);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MFD_HUGETLB</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>MFD_HUGE_64KB</code></li>
<li><code>MFD_HUGE_512KB</code></li>
<li><code>MFD_HUGE_1MB</code></li>
<li><code>MFD_HUGE_2MB</code></li>
<li><code>MFD_HUGE_8MB</code></li>
<li><code>MFD_HUGE_16MB</code></li>
<li><code>MFD_HUGE_32MB</code></li>
<li><code>MFD_HUGE_256MB</code></li>
<li><code>MFD_HUGE_512MB</code></li>
<li><code>MFD_HUGE_1GB</code></li>
<li><code>MFD_HUGE_2GB</code></li>
<li><code>MFD_HUGE_16GB</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/memfd_create.2.html">the man page</a>.</p>
<h3 id="fadvise64"><a class="header" href="#fadvise64"><code>fadvise64</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Announce an intention to access file data in a specific pattern in the future
fadvise64(fd, offset, len, advice = 0);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>POSIX_FADV_NORMAL</code></li>
<li><code>POSIX_FADV_RANDOM</code></li>
<li><code>POSIX_FADV_SEQUENTIAL</code></li>
<li><code>POSIX_FADV_WILLNEED</code></li>
<li><code>POSIX_FADV_DONTNEED</code></li>
<li><code>POSIX_FADV_NOREUSE</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/posix_fadvise.2.html">the man page</a>.</p>
<h3 id="epoll_ctl"><a class="header" href="#epoll_ctl"><code>epoll_ctl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct epoll_event = {
    events = EPOLLIN | EPOLLOUT | EPOLLRDHUP | EPOLLPRI | EPOLLERR | EPOLLHUP |
             EPOLLET | EPOLLONESHOT,
    ..
};

// Add, modify, or delete entries in the interest list of an epoll file descriptor
epoll_ctl(
    epfd,
    op = EPOLL_CTL_ADD | EPOLL_CTL_MOD | EPOLL_CTL_DEL,
    fd, event = &lt;epoll_event&gt;
);
</code></pre>
<p>Unsupported flags in events:</p>
<ul>
<li><code>EPOLLEXCLUSIVE</code></li>
<li><code>EPOLLWAKEUP</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/epoll_ctl.2.html">the man page</a>.</p>
<h3 id="poll-and-ppoll"><a class="header" href="#poll-and-ppoll"><code>poll</code> and <code>ppoll</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct pollfd = {
    events = POLLIN | POLLPRI | POLLOUT | POLLRDHUP | POLLERR |
             POLLHUP | POLLNVAL | POLLRDNORM,
    ..
};

// Wait for I/O event on a set of file descriptors
poll(fds = [ &lt;pollfd&gt; ], nfds, timeout);

// Wait for I/O event on a set of file descriptors with specified signals temporarily blocked
ppoll(fds = [ &lt;pollfd&gt; ], nfds, timeout, sigset, sigset_size);
</code></pre>
<p>Unsupported events:</p>
<ul>
<li><code>POLLRDBAND</code></li>
<li><code>POLLWRNORM</code></li>
<li><code>POLLWRBAND</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/poll.2.html">the man page</a>.</p>
<h3 id="ioctl"><a class="header" href="#ioctl"><code>ioctl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">tty_ops = TCGETS | TCSETS | TCSETSW | TCSETSF | TIOCGWINSZ | TIOCSWINSZ |
          TIOCGPTN | FIONREAD | KDFONTOP | KDSETMODE | KDGETMODE |
          KDSKBMODE | KDGKBMODE;
term_ops = TIOCGPGRP | TIOCSPGRP | TIOCSCTTY | TIOCNOTTY | TIOCGSID;
pty_master_ops = TIOCSPTLCK | TIOCGPTLCK | TIOCGPTPEER | TIOCPKT | TIOCGPKT;

// Control file descriptor flags and I/O modes
ioctl(fd, op = FIONCLEX | FIOCLEX | FIONBIO | FIOASYNC, ..);

// Control terminal devices
ioctl(fd, op = &lt;pty_master_ops&gt; | &lt;tty_ops&gt; | &lt;term_ops&gt;, ..);

// Control framebuffer display
ioctl(
    fd,
    op = FBIOGET_VSCREENINFO | FBIOPUT_VSCREENINFO | FBIOGET_FSCREENINFO |
         FBIOGETCMAP | FBIOPUTCMAP | FBIOPAN_DISPLAY | FBIOBLANK,
    ..
);

// Control Event devices (evdev)
ioctl(
    fd,
    op = EVIOCGVERSION | EVIOCGID | EVIOCGNAME | EVIOCGPHYS | EVIOCGUNIQ |
         EVIOCGKEY | EVIOCGLED | EVIOCGSW | EVIOCSCLOCKID | EVIOCGBIT,
    ..
);

// Control block devices
ioctl(fd, op = BLKGETSIZE64, ..);

// Control Trust Domain Extensions (TDX) guest devices
ioctl(fd, op = TDX_CMD_GET_REPORT0, ..);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/ioctl.2.html">the man page</a>.</p>
<h3 id="ioprio_set-and-ioprio_get"><a class="header" href="#ioprio_set-and-ioprio_get"><code>ioprio_set</code> and <code>ioprio_get</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Set the I/O priority for a single thread
ioprio_set(which = IOPRIO_WHO_PROCESS, who, ioprio);

// Get the I/O priority for a single thread
ioprio_get(which = IOPRIO_WHO_PROCESS, who);
</code></pre>
<p>Unsupported selectors:</p>
<ul>
<li><code>IOPRIO_WHO_PGRP</code></li>
<li><code>IOPRIO_WHO_USER</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/ioprio_set.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="inter-process-communication"><a class="header" href="#inter-process-communication">Inter-Process Communication</a></h1>
<!--
Put system calls such as
msgget, msgsnd, msgrcv, msgctl, semget, semop, semctl, shmget, shmat, shmctl
futex, set_robust_list, and get_robust_list
under this category.
-->
<h3 id="futex"><a class="header" href="#futex"><code>futex</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">opt_flags = FUTEX_PRIVATE_FLAG | FUTEX_CLOCK_REALTIME;

// Block current thread if target value at `uaddr` matches `val`, and wait up to `timeout`.
futex(
    uaddr,
    futex_op = FUTEX_WAIT | &lt;opt_flags&gt;,
    val, timeout
);

// Block current thread with bitmask condition if target value at `uaddr` matches `val`,
// and wait up to `timeout`.
futex(
    uaddr,
    futex_op = FUTEX_WAIT_BITSET | &lt;opt_flags&gt;,
    val, timeout, unused = NULL, bitmask
);

// Unblock up to `max_waiters` threads waiting on `uaddr`
futex(
    uaddr,
    futex_op = FUTEX_WAKE | &lt;opt_flags&gt;,
    max_waiters
);

// Unblock up to `max_waiters` threads on `uaddr`, if the value on `uaddr` matches `bitmask`
futex(
    uaddr,
    futex_op = FUTEX_WAKE_BITSET | &lt;opt_flags&gt;,
    max_waiters, unused0 = NULL, unused1 = NULL, bitmask
);

// Unblock up to `max_waiters` threads waiting on `uaddr`, and requeue up to
// `max_requeue_waiters` of the remaining waiters to the target futex at `uaddr2`.
futex(
    uaddr,
    futex_op = FUTEX_REQUEUE | &lt;opt_flags&gt;,
    max_waiters, max_requeue_waiters, uaddr2
);

// Perform atomic operation encoded in `operation` on `uaddr2`. Unblock up to `max_waiters`
// threads waiting on `uaddr`, and conditionally unblock up to `max_waiters2` threads
// waiting on `uaddr2` based on the result of the atomic operation.
futex(
    uaddr,
    futex_op = FUTEX_WAKE_OP | &lt;opt_flags&gt;,
    max_waiters, max_waiters2, uaddr2, operation
);
</code></pre>
<p>Unsupported operations:</p>
<ul>
<li><code>FUTEX_FD</code></li>
<li><code>FUTEX_CMP_REQUEUE</code></li>
<li><code>FUTEX_LOCK_PI</code></li>
<li><code>FUTEX_UNLOCK_PI</code></li>
<li><code>FUTEX_TRYLOCK_PI</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/futex.2.html">the man page</a>.</p>
<h2 id="system-v-semaphore"><a class="header" href="#system-v-semaphore">System V semaphore</a></h2>
<h3 id="semget"><a class="header" href="#semget"><code>semget</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Creat or open a semaphore set
semget(
    key,
    nsems,
    semflg = IPC_CREAT | IPC_EXCL
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/semget.2.html">the man page</a>.</p>
<h3 id="semop-and-semtimedop"><a class="header" href="#semop-and-semtimedop"><code>semop</code> and <code>semtimedop</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct sembuf = {
    sem_flg = IPC_NOWAIT,
    ..
};

// Semaphore operations without blocking
semop(
    semid,
    sops = [ &lt;sembuf&gt; ],
    nsops
);
</code></pre>
<p>Unsupported semaphore flags:</p>
<ul>
<li><code>SEM_UNDO</code></li>
</ul>
<p>Supported and unsupported functionality of <code>semtimedop</code> are the same as <code>semop</code>.
The SCML rules are omitted for brevity.</p>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/semop.2.html">the man page</a>.</p>
<h3 id="semctl"><a class="header" href="#semctl"><code>semctl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Remove the semaphore set
semctl(
    semid,
    semnum,
    cmd = IPC_RMID
);

// Initialize the value of the semnum-th semaphore
semctl(
    semid,
    semnum,
    cmd = SETVAL,
    arg
);

// Return the current value (GETVAL), last operating process's PID (GETPID),
// count of processes awaiting increment (GETNCNT) or count of processes awaiting
// zero (GETZCNT) of the semnum-th semaphore
semctl(
    semid,
    semnum,
    cmd = GETVAL | GETPID | GETNCNT | GETZCNT
);

// Retrieve a copy of the `semid_ds` kernel structure for the specified semaphore set
semctl(
    semid,
    semnum,
    cmd = IPC_STAT,
    arg
);
</code></pre>
<p>Unsupported commands:</p>
<ul>
<li><code>IPC_INFO</code></li>
<li><code>SEM_INFO</code></li>
<li><code>SEM_STAT</code></li>
<li><code>SEM_STAT_ANY</code></li>
<li><code>GETALL</code></li>
<li><code>SETALL</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/semctl.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="networking--sockets"><a class="header" href="#networking--sockets">Networking &amp; Sockets</a></h1>
<!--
Put system calls such as

socket, socketpair, bind, listen, accept, connect, getsockname, getpeername, 
sendto, recvfrom, sendmsg, recvmsg, shutdown, setsockopt, getsockopt, 
sendmmsg, recvmmsg, accept4, recvmsg, and socketcall
under this category.
-->
<h2 id="socket-creation"><a class="header" href="#socket-creation">Socket Creation</a></h2>
<h3 id="socket"><a class="header" href="#socket"><code>socket</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Optional flags for socket type
opt_type_flags = SOCK_NONBLOCK | SOCK_CLOEXEC;

// Create a UNIX socket
socket(
    family = AF_UNIX,
    type = SOCK_STREAM | SOCK_SEQPACKET | &lt;opt_type_flags&gt;,
    protocol = 0
);

// Create an IPv4 socket (TCP or UDP)
socket(
    family = AF_INET,
    type = SOCK_STREAM | SOCK_DGRAM | &lt;opt_type_flags&gt;,
    protocol = IPPROTO_IP | IPPROTO_TCP | IPPROTO_UDP
);

// Create a netlink socket
socket(
    family = AF_NETLINK,
    type = SOCK_RAW | SOCK_DGRAM | &lt;opt_type_flags&gt;,
    protocol = NETLINK_ROUTE | NETLINK_KOBJECT_UEVENT
);

// Create a VSOCK socket
socket(
    family = AF_VSOCK,
    type = SOCK_STREAM | &lt;opt_type_flags&gt;,
    protocol = 0
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/socket.2.html">the man page</a>.</p>
<h3 id="socketpair"><a class="header" href="#socketpair"><code>socketpair</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Optional flags for socket type
opt_type_flags = SOCK_NONBLOCK | SOCK_CLOEXEC;

// Create a pair of connected UNIX sockets
socketpair(
    family = AF_UNIX,
    type = SOCK_STREAM | SOCK_SEQPACKET | &lt;opt_type_flags&gt;,
    protocol = 0,
    sv
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/socketpair.2.html">the man page</a>.</p>
<h2 id="socket-setup"><a class="header" href="#socket-setup">Socket Setup</a></h2>
<h3 id="bind"><a class="header" href="#bind"><code>bind</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

// Bind a socket to an address
bind(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/bind.2.html">the man page</a>.</p>
<h3 id="connect"><a class="header" href="#connect"><code>connect</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

// Connect to a peer socket
connect(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/connect.2.html">the man page</a>.</p>
<h3 id="accept-and-accept4"><a class="header" href="#accept-and-accept4"><code>accept</code> and <code>accept4</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_VSOCK,
    ..
};

// Accept an incoming connection
accept(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);

// Accept an incoming connection and set flags for the new socket
accept4(
    sockfd, addr = &lt;sockaddr&gt;, addrlen,
    flags = SOCK_NONBLOCK | SOCK_CLOEXEC
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/accept.2.html">the man page</a>.</p>
<h2 id="socket-communication"><a class="header" href="#socket-communication">Socket Communication</a></h2>
<h3 id="sendto-sendmsg-and-sendmmsg"><a class="header" href="#sendto-sendmsg-and-sendmmsg"><code>sendto</code>, <code>sendmsg</code> and <code>sendmmsg</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

struct msg_hdr = {
    msg_name = &lt;sockaddr&gt;,
    msg_control = NULL,
    ..
};

struct mmsg_hdr = {
    hdr = &lt;msg_hdr&gt;,
    msg_len
};

// Send message on a socket
sendto(
    sockfd, buf, len,
    flags = 0,
    dest_addr = &lt;sockaddr&gt;,
    addrlen
);

// Send message using scatter-gather buffers and ancillary data
sendmsg(
    sockfd,
    msg = &lt;msg_hdr&gt;,
    flags = 0
);


// Send multiple messages on a socket
sendmmsg(
    sockfd,
    mmsgs = [ &lt;mmsg_hdr&gt; ],
    mmsg_count,
    flags = 0
);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>MSG_CONFIRM</code></li>
<li><code>MSG_DONTROUTE</code></li>
<li><code>MSG_DONTWAIT</code></li>
<li><code>MSG_EOR</code></li>
<li><code>MSG_MORE</code></li>
<li><code>MSG_CONFIRM</code></li>
<li><code>MSG_NOSIGNAL</code></li>
<li><code>MSG_OOB</code></li>
<li><code>MSG_FASTOPEN</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/sendto.2.html">the man page</a>.</p>
<h3 id="recvfrom-and-recvmsg"><a class="header" href="#recvfrom-and-recvmsg"><code>recvfrom</code> and <code>recvmsg</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Receive message from a socket
recvfrom(
    sockfd, buf, size,
    flags = 0,
    src_addr, addrlen
);

// Receive message using scatter-gather buffers and ancillary data
recvmsg(
    sockfd,
    msg,
    flags = 0
);
</code></pre>
<p>Partially-supported flags:</p>
<ul>
<li><code>MSG_PEEK</code> because it is only supported in netlink socket</li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/recvfrom.2.html">the man page</a>.</p>
<h2 id="socket-options"><a class="header" href="#socket-options">Socket Options</a></h2>
<h3 id="getsockopt-and-setsockopt"><a class="header" href="#getsockopt-and-setsockopt"><code>getsockopt</code> and <code>setsockopt</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">socket_options = SO_SNDBUF | SO_RCVBUF | SO_REUSEADDR | SO_REUSEPORT |
                 SO_PRIORITY | SO_LINGER | SO_PASSCRED | SO_KEEPALIVE |
                 SO_SNDBUFFORCE | SO_RCVBUFFORCE | SO_ERROR |
                 SO_PEERCRED | SO_ACCEPTCONN | SO_PEERGROUPS;

ip_options = IP_TOS | IP_TTL | IP_HDRINCL;

tcp_options = TCP_NODELAY | TCP_MAXSEG | TCP_KEEPIDLE | TCP_SYNCNT |
              TCP_DEFER_ACCEPT | TCP_WINDOW_CLAMP | TCP_CONGESTION |
              TCP_USER_TIMEOUT | TCP_INQ;

// Get options at socket level
getsockopt(
    sockfd, level = SOL_SOCKET,
    optname = &lt;socket_options&gt;,
    optval, optlen
);

// Get options at IP level
getsockopt(
    sockfd, level = SOL_IP,
    optname = &lt;ip_options&gt;,
    optval, optlen
);

// Get options at TCP level
getsockopt(
    sockfd, level = SOL_TCP,
    optname = &lt;tcp_options&gt;,
    optval, optlen
);

// Set options at socket level
setsockopt(
    sockfd, level = SOL_SOCKET,
    optname = &lt;socket_options&gt;,
    optval, optlen
);

// Set options at IP level
setsockopt(
    sockfd, level = SOL_IP,
    optname = &lt;ip_options&gt;,
    optval, optlen
);

// Set options at TCP level
setsockopt(
    sockfd, level = SOL_TCP,
    optname = &lt;tcp_options&gt;,
    optval, optlen
);

// Set options at netlink level
setsockopt(
    sockfd, level = SOL_NETLINK,
    optname = NETLINK_ADD_MEMBERSHIP | NETLINK_DROP_MEMBERSHIP,
    optval, optlen
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/getsockopt.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="signals--timers"><a class="header" href="#signals--timers">Signals &amp; Timers</a></h1>
<!--
Put system calls such as

rt_sigaction, rt_sigprocmask, rt_sigpending, rt_sigqueueinfo, rt_tgsigqueueinfo,
rt_sigreturn, kill, tkill, tgkill, alarm, setitimer, getitimer, nanosleep,
timer_create, timer_settime, timer_gettime, and timer_delete
under this category.
-->
<h2 id="signals"><a class="header" href="#signals">Signals</a></h2>
<h3 id="rt_sigaction"><a class="header" href="#rt_sigaction"><code>rt_sigaction</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Change and/or retrieve a signal action
rt_sigaction(
    signum,
    act = {
        sa_flags = SA_ONSTACK | SA_RESTART | SA_NODEFER | SA_RESTORER | SA_SIGINFO | SA_RESETHAND,
        ..
    },
    oldact, sigsetsize
);
</code></pre>
<p>Unsupported <code>sigaction</code> flags:</p>
<ul>
<li><code>SA_NOCLDSTOP</code></li>
<li><code>SA_NOCLDWAIT</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/sigaction.2.html">the man page</a>.</p>
<h3 id="rt_sigprocmask"><a class="header" href="#rt_sigprocmask"><code>rt_sigprocmask</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Change and/or retrieve blocked signals
rt_sigprocmask(
    how = SIG_BLOCK | SIG_UNBLOCK | SIG_SETMASK, set, oldset, sigsetsize
);
</code></pre>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/sigprocmask.2.html">the man page</a>.</p>
<h2 id="posix-interval-timers"><a class="header" href="#posix-interval-timers">POSIX Interval Timers</a></h2>
<h3 id="timer_create"><a class="header" href="#timer_create"><code>timer_create</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">opt_notify_methods = SIGEV_NONE | SIGEV_SIGNAL | SIGEV_THREAD_ID;

// Create a timer with predefined clock source
timer_create(
    clockid = CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID | CLOCK_REALTIME | CLOCK_MONOTONIC,
    sevp = {
        sigev_notify = &lt;opt_notify_methods&gt;,
        ..
    },
    timerid
);

// Create a timer based on a per-process or per-thread clock
timer_create(
    clockid = &lt;INTEGER&gt;,
    sevp = {
        sigev_notify = &lt;opt_notify_methods&gt;,
        ..
    },
    timerid
);
</code></pre>
<p>Partially-supported clock IDs:</p>
<ul>
<li><code>CLOCK_BOOTTIME</code> is treated as <code>CLOCK_MONOTONIC</code></li>
</ul>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>Unsupported notification methods:</p>
<ul>
<li><code>SIGEV_THREAD</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/timer_create.2.html">the man page</a>.</p>
<h3 id="timerfd_create"><a class="header" href="#timerfd_create"><code>timerfd_create</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Create a timer file descriptor with a predefined clock source
timerfd_create(
    clockid = CLOCK_REALTIME | CLOCK_MONOTONIC,
    flags = TFD_CLOEXEC | TFD_NONBLOCK
);
</code></pre>
<p>Partially-supported clock IDs:</p>
<ul>
<li><code>CLOCK_BOOTTIME</code> is treated as <code>CLOCK_MONOTONIC</code></li>
</ul>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/timerfd_create.2.html">the man page</a>.</p>
<h3 id="timerfd_settime"><a class="header" href="#timerfd_settime"><code>timerfd_settime</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Arm or disarm a timer file descriptor
timerfd_settime(
    ufd,
    flags = TFD_TIMER_ABSTIME,
    utmr,
    otmr
);
</code></pre>
<p>Ignored flags:</p>
<ul>
<li><code>TFD_TIMER_CANCEL_ON_SET</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/timerfd_create.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="namespaces-cgroups--security"><a class="header" href="#namespaces-cgroups--security">Namespaces, Cgroups &amp; Security</a></h1>
<!--
Put system calls such as
unshare, setns, clone (with namespace flags), chroot, pivot_root, prctl,
capset, seccomp, landlock_create_ruleset, landlock_add_rule, 
landlock_restrict_self, and bpf
under this category.
-->
<h3 id="prctl"><a class="header" href="#prctl"><code>prctl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Retrieve or set the parent-death signal
prctl(op = PR_GET_PDEATHSIG | PR_SET_PDEATHSIG, sig);

// Get or set the name of calling thread
prctl(op = PR_GET_NAME | PR_SET_NAME, name);

// Query whether process retains permitted capabilities after `UID` changes
prctl(op = PR_GET_KEEPCAPS);

// Configure permitted capabilities retention after `UID` changes
prctl(op = PR_SET_KEEPCAPS, state);

// Retrieve or set "child subreaper" attribute
prctl(op = PR_GET_CHILD_SUBREAPER | PR_SET_CHILD_SUBREAPER, isset);

// Retrieve or set the timer slack value (nanoseconds)
prctl(op = PR_GET_TIMERSLACK | PR_SET_TIMERSLACK, slack_ns);
</code></pre>
<p>Partially-supported operations:</p>
<ul>
<li><code>PR_GET_DUMPABLE</code> and <code>PR_SET_DUMPABLE</code> because coredump is not supported</li>
</ul>
<p>Unsupported operations:</p>
<ul>
<li><code>PR_CAP_AMBIENT</code>, <code>PR_CAPBSET_READ</code> and <code>PR_CAPBSET_DROP</code></li>
<li><code>PR_GET_ENDIAN</code> and <code>PR_SET_ENDIAN</code></li>
<li><code>PR_GET_FP_MODE</code> and <code>PR_SET_FP_MODE</code></li>
<li><code>PR_GET_FPEMU</code> and <code>PR_SET_FPEMU</code></li>
<li><code>PR_GET_FPEXC</code> and <code>PR_SET_FPEXC</code></li>
<li><code>PR_GET_IO_FLUSHER</code> and <code>PR_SET_IO_FLUSHER</code></li>
<li><code>PR_MCE_KILL</code> and <code>PR_MCE_KILL_GET</code></li>
<li><code>PR_SET_MM</code> and <code>PR_SET_VMA</code></li>
<li><code>PR_MPX_ENABLE_MANAGEMENT</code> and <code>PR_MPX_DISABLE_MANAGEMENT</code></li>
<li><code>PR_GET_NO_NEW_PRIVS</code> and <code>PR_SET_NO_NEW_PRIVS</code></li>
<li><code>PR_PAC_RESET_KEYS</code></li>
<li><code>PR_SET_PTRACER</code></li>
<li><code>PR_GET_SECCOMP</code> and <code>PR_SET_SECCOMP</code></li>
<li><code>PR_GET_SPECULATION_CTRL</code> and <code>PR_SET_SPECULATION_CTRL</code></li>
<li><code>PR_SVE_GET_VL</code> and <code>PR_SVE_SET_VL</code></li>
<li><code>PR_SET_SYSCALL_USER_DISPATCH</code></li>
<li><code>PR_GET_TAGGED_ADDR_CTRL</code> and <code>PR_SET_TAGGED_ADDR_CTRL</code></li>
<li><code>PR_TASK_PERF_EVENTS_ENABLE</code> and <code>PR_TASK_PERF_EVENTS_DISABLE</code></li>
<li><code>PR_GET_THP_DISABLE</code> and <code>PR_SET_THP_DISABLE</code></li>
<li><code>PR_GET_TID_ADDRESS</code></li>
<li><code>PR_GET_TIMING</code> and <code>PR_SET_TIMING</code></li>
<li><code>PR_GET_TSC</code> and <code>PR_SET_TSC</code></li>
<li><code>PR_GET_UNALIGN</code> and <code>PR_SET_UNALIGN</code></li>
<li><code>PR_GET_AUXV</code></li>
<li><code>PR_GET_MDWE</code> and <code>PR_SET_MDWE</code></li>
<li><code>PR_RISCV_SET_ICACHE_FLUSH_CTX</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/prctl.2.html">the man page</a>.</p>
<h3 id="capget-and-capset"><a class="header" href="#capget-and-capset"><code>capget</code> and <code>capset</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Get capabilities of thread
capget(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);

// Set capabilities of thread
capset(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);
</code></pre>
<p>Unsupported versions:</p>
<ul>
<li><code>_LINUX_CAPABILITY_VERSION_1</code></li>
<li><code>_LINUX_CAPABILITY_VERSION_2</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/capget.2.html">the man page</a>.</p>
<h3 id="unshare"><a class="header" href="#unshare"><code>unshare</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Disassociate parts of the process execution context
unshare(flags = CLONE_FILES | CLONE_FS | CLONE_NEWNS | CLONE_NEWUTS | CLONE_THREAD | CLONE_SIGHAND | CLONE_VM);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>CLONE_NEWCGROUP</code></li>
<li><code>CLONE_NEWIPC</code></li>
<li><code>CLONE_NEWNET</code></li>
<li><code>CLONE_NEWPID</code></li>
<li><code>CLONE_NEWTIME</code></li>
<li><code>CLONE_NEWUSER</code></li>
</ul>
<p>Silently-ignored flags:</p>
<ul>
<li><code>CLONE_SYSVSEM</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/unshare.2.html">the man page</a>.</p>
<h3 id="setns"><a class="header" href="#setns"><code>setns</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Reassociate thread with a namespace
setns(fd, ns_type = CLONE_NEWNS | CLONE_NEWUTS);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>CLONE_NEWCGROUP</code></li>
<li><code>CLONE_NEWIPC</code></li>
<li><code>CLONE_NEWNET</code></li>
<li><code>CLONE_NEWPID</code></li>
<li><code>CLONE_NEWTIME</code></li>
<li><code>CLONE_NEWUSER</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/setns.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="system-information--misc"><a class="header" href="#system-information--misc">System Information &amp; Misc.</a></h1>
<!--
Put system calls such as
uname, getrlimit, reboot, setrlimit, sysinfo, times, gettimeofday, clock_gettime,
clock_settime, getrusage, getdents, getdents64, personality, syslog,
arch_prctl, set_tid_address, and getrandom
under this category.
-->
<h3 id="arch_prctl"><a class="header" href="#arch_prctl"><code>arch_prctl</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Get or set the FS register
arch_prctl(
    code = ARCH_GET_FS | ARCH_SET_FS,
    addr
);
</code></pre>
<p>Unsupported codes:</p>
<ul>
<li><code>ARCH_GET_CPUID</code> and <code>ARCH_SET_CPUID</code></li>
<li><code>ARCH_GET_GS</code> and <code>ARCH_SET_GS</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/arch_prctl.2.html">the man page</a>.</p>
<h3 id="getrusage"><a class="header" href="#getrusage"><code>getrusage</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Return resource usage statistics for the calling process
getrusage(
    who = RUSAGE_SELF,
    usage
);

// Return resource usage statistics for the calling thread
getrusage(
    who = RUSAGE_THREAD,
    usage
);
</code></pre>
<p>Unsupported <code>who</code> flags:</p>
<ul>
<li><code>RUSAGE_CHILDREN</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/getrusage.2.html">the man page</a>.</p>
<h3 id="getrandom"><a class="header" href="#getrandom"><code>getrandom</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Obtain random bytes
getrandom(
    buf, buflen,
    flags =
        // Optional flags:
        //
        // High-entropy pool
        GRND_RANDOM
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>GRND_NONBLOCK</code> because the underlying operation never blocks</li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/getrandom.2.html">the man page</a>.</p>
<h3 id="reboot"><a class="header" href="#reboot"><code>reboot</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">reboot_magic2 = LINUX_REBOOT_MAGIC2 | LINUX_REBOOT_MAGIC2A | LINUX_REBOOT_MAGIC2B | LINUX_REBOOT_MAGIC2C;

// Stop the current system
reboot(
    magic  = LINUX_REBOOT_MAGIC1,
    magic2 = &lt;reboot_magic2&gt;,
    op     = LINUX_REBOOT_CMD_HALT | LINUX_REBOOT_CMD_POWER_OFF | LINUX_REBOOT_CMD_RESTART,
    arg
);
</code></pre>
<p>Unsupported <code>op</code> flags:</p>
<ul>
<li><code>LINUX_REBOOT_CMD_CAD_OFF</code></li>
<li><code>LINUX_REBOOT_CMD_CAD_ON</code></li>
<li><code>LINUX_REBOOT_CMD_KEXEC</code></li>
<li><code>LINUX_REBOOT_CMD_RESTART2</code></li>
<li><code>LINUX_REBOOT_CMD_SW_SUSPEND</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/reboot.2.html">the man page</a>.</p>
<h2 id="posix-clocks"><a class="header" href="#posix-clocks">POSIX Clocks</a></h2>
<h3 id="clock_gettime"><a class="header" href="#clock_gettime"><code>clock_gettime</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">predefined_clockid = CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_MONOTONIC_RAW |
                     CLOCK_REALTIME_COARSE | CLOCK_MONOTONIC_COARSE | CLOCK_BOOTTIME |
                     CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID;

// Get the time of a clock specified by a static ID
clock_gettime(clockid = &lt;predefined_clockid&gt;, tp);

// Get the time of a clock specified by a dynamic ID
clock_gettime(clockid = &lt;INTEGER&gt;, tp);
</code></pre>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/clock_gettime.2.html">the man page</a>.</p>
<h3 id="clock_nanosleep"><a class="header" href="#clock_nanosleep"><code>clock_nanosleep</code></a></h3>
<p>Supported functionality in SCML:</p>
<pre><code class="language-c">// Sleep with a specified clock
clock_nanosleep(
    clockid = CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_BOOTTIME | CLOCK_PROCESS_CPUTIME_ID,
    flags =
        // Optional flags:
        //
        // Sleep until an absolute time point
        TIMER_ABSTIME,
    t, remain
);
</code></pre>
<p>Unsupported clock IDs:</p>
<ul>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>For more information,
see <a href="https://man7.org/linux/man-pages/man2/clock_nanosleep.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h1>
<p>Asterinas is a general-purpose OS kernel
designed to support multiple CPU architectures and a variety of use cases.
Currently, it only supports x86-64 VMs.
Our roadmap includes the following plans:</p>
<ul>
<li>By 2024, we aim to achieve production-ready status for VM environments on x86-64.</li>
<li>In 2025 and beyond, we will expand our support for CPU architectures and hardware devices.</li>
</ul>
<h2 id="target-early-use-cases"><a class="header" href="#target-early-use-cases">Target Early Use Cases</a></h2>
<p>One of the biggest challenges for a new OS kernel is driver support.
Linux has been widely accepted due to its wide range of hardware support.
As a newcomer, Asterinas faces the challenge of implementing drivers
for all devices on a target platform,
which would take a significant amount of time.</p>
<p>To address this obstacle,
we have decided to enter the cloud market first.
In an IaaS (Infrastructure-as-a-Service) cloud, workloads of different tenants are run in VMs
or <a href="https://dl.acm.org/doi/10.1145/3373376.3378507">VM-style bare-metal servers</a>
for maximum isolation and elasticity.
The main device driver requirement for the VM environment is virtio,
which is already supported by Asterinas.
Therefore, using Asterinas as the guest OS of a VM
or the host OS of a VM-style bare-metal server in production
looks quite feasible in the near future.</p>
<p>Asterinas provides high assurance of memory safety
thanks to <a href="#the-framekernel-architecture">the framekernel architecture</a>.
Thus, in the cloud setting,
Asterinas is attractive for usage scenarios
where Linux ABI is necessary but Linux itself is considered insecure
due to its large Trusted Computing Base (TCB) and memory unsafety.
Specifically, we are focusing on two use cases:</p>
<ol>
<li>
<p>VM-based TEEs:
All major CPU architectures have introduced
VM-based Trusted Execution Environment (TEE) technology,
such as ARM CCA, AMD SEV, and Intel TDX.
Applications running inside TEEs often handle private or sensitive data.
By running on a lightweight and memory-safe OS kernel like Asterinas,
they can greatly enhance security and privacy.</p>
</li>
<li>
<p>Secure containers:
In the cloud-native era, applications are commonly deployed in containers.
The popular container runtimes like runc and Docker rely on
the OS-level isolation enforced by Linux.
However, <a href="https://dl.acm.org/doi/10.1145/3274694.3274720">Linux containers are prone to privilege escalation bugs</a>.
With its safety and security prioritized architecture,
Asterinas can offer more reliable OS-level isolation,
making it ideal for secure containers.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-ostd"><a class="header" href="#asterinas-ostd">Asterinas OSTD</a></h1>
<blockquote>
<p>Confucious remarked,
‚ÄúI could follow whatever my heart desired
without transgressing the law.‚Äù</p>
<p>Â≠êÊõ∞Ôºö
‚Äú‰ªéÂøÉÊâÄÊ¨≤Ôºå‰∏çÈÄæÁü©„ÄÇ‚Äù</p>
</blockquote>
<p>With the Asterinas OSTD (Operating System Standard Library),
you don‚Äôt have to learn the dark art of unsafe Rust programming
and risk shooting yourself in the foot.
You will be doing whatever your heart desires,
and be confident that your kernel will never crash
or be hacked due to undefined behaviors,
even if today marks your Day 1 as a Rust programmer.</p>
<h2 id="apis"><a class="header" href="#apis">APIs</a></h2>
<p>Asterinas OSTD stands
as a powerful and solid foundation for safe kernel development,
providing high-level safe Rust APIs that are</p>
<ol>
<li>Essential for OS development, and</li>
<li>Dependent on the use of unsafe Rust.</li>
</ol>
<p>Most of these APIs fall into the following categories:</p>
<ul>
<li>Memory management (e.g., allocating and accessing physical memory pages)</li>
<li>Task management (e.g., context switching between kernel tasks)</li>
<li>User space (e.g., manipulating and entering the user space)</li>
<li>Interrupt handling (e.g., registering interrupt handlers)</li>
<li>Timer management (e.g., registering timer handlers)</li>
<li>Driver support (e.g., performing DMA and MMIO)</li>
<li>Boot support (e.g., retrieving information from the bootloader)</li>
<li>Synchronization (e.g., locking and sleeping)</li>
</ul>
<p>To explore how these APIs come into play,
see <a href="#example-writing-a-kernel-in-about-100-lines-of-safe-rust">the example of a 100-line kernel in safe Rust</a>.</p>
<p>The OSTD APIs have been extensively documented.
You can access the comprehensive API documentation by visiting the <a href="https://docs.rs/ostd/latest/ostd">docs.rs</a>.</p>
<h2 id="four-requirements-satisfied"><a class="header" href="#four-requirements-satisfied">Four Requirements Satisfied</a></h2>
<p>In designing and implementing OSTD,
we have risen to meet the challenge of
fulfilling <a href="#the-framekernel-architecture">the aforementioned four criteria as demanded by the framekernel architecture</a>.</p>
<p>Expressiveness is evident through Asterinas Kernel itself,
where all system calls,
file systems,
network protocols,
and device drivers (e.g., Virtio drivers)
have been implemented in safe Rust
by leveraging OSTD.</p>
<p>Adopting a minimalist philosophy,
OSTD has a small codebase.
At its core lies the <code>ostd</code> crate,
currently encompassing about 10K lines of code - a figure
that is even smaller than those of many microkernels.
As OSTD evolves,
its codebase will expand,
albeit at a relatively slow rate
in comparison to the OS services layered atop it.</p>
<p>The OSTD‚Äôs efficiency is measurable
through the performance metrics of its APIs
and the system calls of Asterinas Kernel.
No intrinsic limitations have been identified within Rust
or the framekernel architecture
that could hinder kernel performance.</p>
<p>Soundness, unlike the other three requirements,
is not as easily quantified or proved.
While formal verification stands as the gold standard,
it requires considerable resources and time
and is not an immediate priority.
As a more pragmatic approach,
we will explain why the high-level design is sound
in the soundness analysis and rely on the many
eyes of the community to catch any potential flaws
in the implementation.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="example-writing-a-kernel-in-about-100-lines-of-safe-rust"><a class="header" href="#example-writing-a-kernel-in-about-100-lines-of-safe-rust">Example: Writing a Kernel in About 100 Lines of Safe Rust</a></h1>
<p>To give you a sense of
how Asterinas OSTD enables writing kernels in safe Rust,
we will show a new kernel in about 100 lines of safe Rust.</p>
<p>Our new kernel will be able to run the following Hello World program.</p>
<pre><code class="language-s"># SPDX-License-Identifier: MPL-2.0

.global _start                      # entry point
.section .text                      # code section
_start:
    mov     $1, %rax                # syscall number of write
    mov     $1, %rdi                # stdout
    mov     $message, %rsi          # address of message         
    mov     $message_end, %rdx
    sub     %rsi, %rdx              # calculate message len
    syscall
    mov     $60, %rax               # syscall number of exit, move it to rax
    mov     $0, %rdi                # exit code, move it to rdi
    syscall  

.section .rodata                    # read only data section
message:
    .ascii  "Hello, world\n"
message_end:
</code></pre>
<p>The assembly program above can be compiled with the following command.</p>
<pre><code class="language-bash">gcc -static -nostdlib hello.S -o hello
</code></pre>
<p>The user program above requires our kernel to support three main features:</p>
<ol>
<li>Loading a program as a process image in user space;</li>
<li>Handling the write system call;</li>
<li>Handling the exit system call.</li>
</ol>
<p>A sample implementation of the kernel in safe Rust is given below.
Comments are added
to highlight how the APIs of Asterinas OSTD enable safe kernel development.</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

#![no_std]
#![deny(unsafe_code)]

extern crate alloc;

use align_ext::AlignExt;
use core::str;

use alloc::sync::Arc;
use alloc::vec;

use ostd::arch::cpu::context::UserContext;
use ostd::mm::{
    CachePolicy, FallibleVmRead, FrameAllocOptions, PageFlags, PageProperty, Vaddr, VmIo, VmSpace,
    VmWriter, PAGE_SIZE,
};
use ostd::power::{poweroff, ExitCode};
use ostd::prelude::*;
use ostd::task::{disable_preempt, Task, TaskOptions};
use ostd::user::{ReturnReason, UserMode};

/// The kernel's boot and initialization process is managed by OSTD.
/// After the process is done, the kernel's execution environment
/// (e.g., stack, heap, tasks) will be ready for use and the entry function
/// labeled as `#[ostd::main]` will be called.
#[ostd::main]
pub fn main() {
    let program_binary = include_bytes!("../hello");
    let vm_space = Arc::new(create_vm_space(program_binary));
    vm_space.activate();
    let user_task = create_user_task(vm_space);
    user_task.run();
}

fn create_vm_space(program: &amp;[u8]) -&gt; VmSpace {
    let nbytes = program.len().align_up(PAGE_SIZE);
    let user_pages = {
        let segment = FrameAllocOptions::new()
            .alloc_segment(nbytes / PAGE_SIZE)
            .unwrap();
        // Physical memory pages can be only accessed
        // via the `UFrame` or `USegment` abstraction.
        segment.write_bytes(0, program).unwrap();
        segment
    };

    // The page table of the user space can be
    // created and manipulated safely through
    // the `VmSpace` abstraction.
    let vm_space = VmSpace::new();
    const MAP_ADDR: Vaddr = 0x0040_0000; // The map addr for statically-linked executable
    let preempt_guard = disable_preempt();
    let mut cursor = vm_space
        .cursor_mut(&amp;preempt_guard, &amp;(MAP_ADDR..MAP_ADDR + nbytes))
        .unwrap();
    let map_prop = PageProperty::new_user(PageFlags::RWX, CachePolicy::Writeback);
    for frame in user_pages {
        cursor.map(frame.into(), map_prop);
    }
    drop(cursor);
    vm_space
}

fn create_user_task(vm_space: Arc&lt;VmSpace&gt;) -&gt; Arc&lt;Task&gt; {
    fn user_task() {
        let current = Task::current().unwrap();
        // Switching between user-kernel space is
        // performed via the UserMode abstraction.
        let mut user_mode = {
            let user_ctx = create_user_context();
            UserMode::new(user_ctx)
        };

        loop {
            // The execute method returns when system
            // calls or CPU exceptions occur or some
            // events specified by the kernel occur.
            let return_reason = user_mode.execute(|| false);

            // The CPU registers of the user space
            // can be accessed and manipulated via
            // the `UserContext` abstraction.
            let user_context = user_mode.context_mut();
            if ReturnReason::UserSyscall == return_reason {
                let vm_space = current.data().downcast_ref::&lt;Arc&lt;VmSpace&gt;&gt;().unwrap();
                handle_syscall(user_context, &amp;vm_space);
            }
        }
    }

    // Kernel tasks are managed by the Framework,
    // while scheduling algorithms for them can be
    // determined by the users of the Framework.
    Arc::new(TaskOptions::new(user_task).data(vm_space).build().unwrap())
}

fn create_user_context() -&gt; UserContext {
    // The user-space CPU states can be initialized
    // to arbitrary values via the `UserContext`
    // abstraction.
    let mut user_ctx = UserContext::default();
    const ENTRY_POINT: Vaddr = 0x0040_1000; // The entry point for statically-linked executable
    user_ctx.set_rip(ENTRY_POINT);
    user_ctx
}

fn handle_syscall(user_context: &amp;mut UserContext, vm_space: &amp;VmSpace) {
    const SYS_WRITE: usize = 1;
    const SYS_EXIT: usize = 60;

    match user_context.rax() {
        SYS_WRITE =&gt; {
            // Access the user-space CPU registers safely.
            let (_, buf_addr, buf_len) =
                (user_context.rdi(), user_context.rsi(), user_context.rdx());
            let buf = {
                let mut buf = vec![0u8; buf_len];
                // Copy data from the user space without
                // unsafe pointer dereferencing.
                let mut reader = vm_space.reader(buf_addr, buf_len).unwrap();
                reader
                    .read_fallible(&amp;mut VmWriter::from(&amp;mut buf as &amp;mut [u8]))
                    .unwrap();
                buf
            };
            // Use the console for output safely.
            println!("{}", str::from_utf8(&amp;buf).unwrap());
            // Manipulate the user-space CPU registers safely.
            user_context.set_rax(buf_len);
        }
        SYS_EXIT =&gt; poweroff(ExitCode::Success),
        _ =&gt; unimplemented!(),
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="osdk-user-guide"><a class="header" href="#osdk-user-guide">OSDK User Guide</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>The Asterinas OSDK (short for Operating System Development Kit)
is designed to simplify the development of Rust operating systems.
It aims to streamline the process
by leveraging <a href="#the-framekernel-architecture">the framekernel architecture</a>.</p>
<p>The OSDK provides a command-line tool <code>cargo-osdk</code>,
which facilitates project management
for those developed on the framekernel architecture.
<code>cargo-osdk</code> can be used as a subcommand of Cargo.
Much like Cargo for Rust projects,
<code>cargo-osdk</code> enables building, running,
and testing projects conveniently.</p>
<h2 id="install-osdk"><a class="header" href="#install-osdk">Install OSDK</a></h2>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<p>Currently, OSDK is only supported on x86_64 Ubuntu systems.
We will add support for more operating systems in the future.</p>
<p>To run a kernel developed by OSDK with QEMU,
the following tools need to be installed:</p>
<ul>
<li>Rust &gt;= 1.75.0</li>
<li>cargo-binutils</li>
<li>gcc</li>
<li>gdb</li>
<li>grub</li>
<li>ovmf</li>
<li>qemu-system-x86_64</li>
<li>xorriso</li>
</ul>
<p>The dependencies required for installing Rust and running QEMU can be installed by:</p>
<pre><code class="language-bash">apt install build-essential curl gdb grub-efi-amd64 grub2-common \
    libpixman-1-dev mtools ovmf qemu-system-x86 xorriso
</code></pre>
<p>About how to install Rust, you can refer to
the <a href="https://www.rust-lang.org/tools/install">official site</a>.</p>
<p><code>cargo-binutils</code> can be installed
after Rust is installed by</p>
<pre><code class="language-bash">cargo install cargo-binutils
</code></pre>
<h3 id="install"><a class="header" href="#install">Install</a></h3>
<p><code>cargo-osdk</code> is published on <a href="https://crates.io/">crates.io</a>,
and can be installed by running</p>
<pre><code class="language-bash">cargo install cargo-osdk
</code></pre>
<h3 id="upgrade"><a class="header" href="#upgrade">Upgrade</a></h3>
<p>If <code>cargo-osdk</code> is already installed,
the tool can be upgraded by running</p>
<pre><code class="language-bash">cargo install --force cargo-osdk
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="why-osdk"><a class="header" href="#why-osdk">Why OSDK</a></h1>
<p>OSDK is designed to elevate the development experience
for Rust OS developers to the ease and convenience
typically associated with Rust application development.
Imagine crafting operating systems
with the same simplicity as applications!
This is important to Asterinas
as we believe that the project‚Äôs success
is intricately tied to the productivity and happiness
of its developers.
So the OSDK is here to upgrade your dev experience.</p>
<p>To be honest, writing OS kernels is hard.
Even when you‚Äôre using Rust,
which is a total game-changer for OS devs,
the challenge stands tall.
There is a bunch of reasons.</p>
<p>First, it is hard to write a new kernel from scratch.
Everything that has been taken for granted by
application developers are gone:
no stack, no heap, no threads, not even the standard I/O.
It‚Äôs just you and the no_std world of Rust.
You have to implement these basic programming primitives
by getting your hands dirty with the most low-level,
error-prone, and nitty-gritty details of computer architecture.
It‚Äôs a journey of learning, doing, and
a whole lot of finger-crossing
to make sure everything clicks into place.
This means a high entry bar for new OS creators.</p>
<p>Second, it is hard to
reuse OS-related libraries/crates across projects.
Think about it:
most applications share a common groundwork,
like libc, Rust‚Äôs std library, or an SDK.
This isn‚Äôt the case with kernels -
they lack this shared starting point,
forcing each one to craft its own set of tools
from the ground up.
Take device drivers, for example.
They often need DMA-capable buffers for chatting with hardware,
but since every kernel has its own DMA API flavor,
a driver for one kernel is pretty much a no-go for another.
This means that for each new kernel out there,
developers find themselves having to ‚Äòreinvent the wheel‚Äô
for many core components that are standard in other kernels.</p>
<p>Third, it is hard to do unit tests for OS functionalities.
Unit testing plays a crucial role in ensuring code quality,
but when you‚Äôre dealing with a monolithic kernel like Linux,
it‚Äôs like a spaghetti bowl of intertwined parts.
Trying to isolate one part for testing?
Forget about it.
You‚Äôd have to boot the whole kernel just to test a slice of it.
Loadable kernel modules are no exception:
you can‚Äôt test them without plugging them into a live kernel.
This monolithic approach to unit testing is slow and unproductive
as it performs the job of unit tests
at a price of integration tests.
Regardless of the kernel architecture,
Rust‚Äôs built-in unit testing facility
is not suited for kernel development,
leaving each kernel to hack together their own testing frameworks.</p>
<p>Last, it is hard to avoid writing unsafe Rust in a Rust kernel.
Rust brings safety‚Ä¶
well, at least for Rust applications,
where you can pretty much stay
in the wonderland of safe Rust all the way through.
But for a Rust kernel,
one cannot help but use unsafe Rust.
This is because, among other reasons,
low-level operations (e.g., managing page tables,
doing context switching, handling interrupts,
and interacting with devices) have to be expressed
with unsafe Rust features (like executing assembly code
or dereferencing raw pointers).
The misuse of unsafe Rust could lead to
various safety and security issues,
as reported by <a href="https://rustsec.org">RustSec Advisory Database</a>.
Despite having <a href="https://doc.rust-lang.org/nomicon/">a whole book</a>
to document ‚Äúthe Dark Arts of Unsafe Rust‚Äù,
unsafe Rust is still tricky to use correctly,
even among seasoned Rust developers.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="creating-an-os-project"><a class="header" href="#creating-an-os-project">Creating an OS Project</a></h1>
<p>The OSDK can be used to create a new kernel project
or a new library project.
A kernel project defines the entry point of the kernel
and can be run with QEMU.
A library project can provide certain OS functionalities
and be imported by other OSes.</p>
<h2 id="creating-a-new-kernel-project"><a class="header" href="#creating-a-new-kernel-project">Creating a new kernel project</a></h2>
<p>Creating a new kernel project is simple.
You only need to execute the following command:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos
</code></pre>
<h2 id="creating-a-new-library-project"><a class="header" href="#creating-a-new-library-project">Creating a new library project</a></h2>
<p>Creating a new library project requires just one command:</p>
<pre><code class="language-bash">cargo osdk new mylib
</code></pre>
<h2 id="generated-files"><a class="header" href="#generated-files">Generated files</a></h2>
<p>Next, we will introduce
the contents of the generated project in detail.
If you don‚Äôt wish to delve into the details,
you can skip the following sections.</p>
<h3 id="overview-2"><a class="header" href="#overview-2">Overview</a></h3>
<p>The generated directory
for both the kernel project and library project
contains the following contents:</p>
<pre><code class="language-text">myos/
‚îú‚îÄ‚îÄ Cargo.toml
‚îú‚îÄ‚îÄ OSDK.toml
‚îú‚îÄ‚îÄ rust-toolchain.toml
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ lib.rs
</code></pre>
<h3 id="srclibrs"><a class="header" href="#srclibrs"><code>src/lib.rs</code></a></h3>
<h4 id="kernel-project"><a class="header" href="#kernel-project">Kernel project</a></h4>
<p>The <code>src/lib.rs</code> file contains the code for a simple kernel.
The function marked with the <code>#[ostd::main]</code> macro
is considered the kernel entry point by OSDK.
The kernel
will print <code>Hello world from the guest kernel!</code>to the console
and then abort.</p>
<pre><code class="language-rust">#![no_std]
#![deny(unsafe_code)]

use ostd::prelude::*;

#[ostd::main]
fn kernel_main() {
    println!("Hello world from guest kernel!");
}</code></pre>
<h4 id="library-project"><a class="header" href="#library-project">Library project</a></h4>
<p>The <code>src/lib.rs</code> of library project only contains
a simple kernel mode unit test.
It follows a similar code pattern as user mode unit tests.
The test module is marked with the <code>#[cfg(ktest)]</code> macro,
and each test case is marked with <code>#[ktest]</code>.</p>
<pre><code class="language-rust">#![no_std]
#![deny(unsafe_code)]

#[cfg(ktest)]
mod tests {
    use ostd::prelude::*;

    #[ktest]
    fn it_works() {
        let memory_regions = &amp;ostd::boot::boot_info().memory_regions;
        assert!(!memory_regions.is_empty());
    }
}</code></pre>
<h3 id="cargotoml"><a class="header" href="#cargotoml"><code>Cargo.toml</code></a></h3>
<p>The <code>Cargo.toml</code> file is the Rust project manifest.
In addition to the contents of a normal Rust project,
OSDK will add the dependencies of the Asterinas OSTD to the file.
The dependency version may change over time.</p>
<pre><code class="language-toml">[dependencies.ostd]
git = "https://github.com/asterinas/asterinas"
branch = "main"
</code></pre>
<p>OSDK will also exclude the directory
which is used to generate temporary files.</p>
<pre><code class="language-toml">[workspace]
exclude = ["target/osdk/base"]
</code></pre>
<h3 id="osdktoml"><a class="header" href="#osdktoml"><code>OSDK.toml</code></a></h3>
<p>The <code>OSDK.toml</code> file is a manifest
that defines the exact behavior of OSDK.
By default, it includes settings on how to start QEMU to run a kernel.
The meaning of each key can be found
in the <a href="#manifest-1">manifest documentation</a>.
Please avoid changing the default settings
unless you know what you are doing.</p>
<p>The default manifest of a kernel project:</p>
<pre><code class="language-toml">project_type = "kernel"

[boot]
method = "grub-rescue-iso"

[qemu]
args = """\
    -machine q35,kernel-irqchip=split \
    -cpu Icelake-Server,+x2apic \
    --no-reboot \
    -m 8G \
    -smp 1 \
    -nographic \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off \
    -display none \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -drive if=pflash,format=raw,unit=0,readonly=on,file=/root/ovmf/release/OVMF.fd \
    -drive if=pflash,format=raw,unit=1,file=/root/ovmf/release/OVMF_VARS.fd \
"""
</code></pre>
<h3 id="rust-toolchaintoml"><a class="header" href="#rust-toolchaintoml"><code>rust-toolchain.toml</code></a></h3>
<p>The Rust toolchain for the kernel.
It is the same as the toolchain of the Asterinas OSTD.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="running-or-testing-an-os-project"><a class="header" href="#running-or-testing-an-os-project">Running or Testing an OS Project</a></h1>
<p>The OSDK allows for convenient building, running,
and testing of an OS project.
The following example shows the typical workflow.</p>
<p>Suppose you have created a new kernel project named <code>myos</code>
and you are in the project directory:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos &amp;&amp; cd myos
</code></pre>
<h2 id="build-the-project"><a class="header" href="#build-the-project">Build the project</a></h2>
<p>To build the project and its dependencies,
simply type:</p>
<pre><code class="language-bash">cargo osdk build
</code></pre>
<p>The initial build of an OSDK project
may take a considerable amount of time
as it involves downloading the Rust toolchain used by the framekernel.
However, this is a one-time process.</p>
<h2 id="run-the-project"><a class="header" href="#run-the-project">Run the project</a></h2>
<p>To launch the kernel with QEMU,
use the following command:</p>
<pre><code class="language-bash">cargo osdk run
</code></pre>
<p>OSDK will boot the kernel
and initialize OS resources like the console for output,
and then hand over control to the kernel entry point
to execute the kernel code.</p>
<p><strong>Note</strong>: Only kernel projects (the projects
that defines the function marked with <code>#[ostd::main]</code>)
can be run;
library projects cannot.</p>
<h2 id="test-the-project"><a class="header" href="#test-the-project">Test the project</a></h2>
<p>Suppose you have created a new library project named <code>mylib</code>
which contains a default test case
and you are in the project directory.</p>
<pre><code class="language-bash">cargo osdk new --lib mylib &amp;&amp; cd mylib
</code></pre>
<p>To run the kernel mode tests, use the following command:</p>
<pre><code class="language-bash">cargo osdk test
</code></pre>
<p>OSDK will run all the kernel mode tests in the crate.</p>
<p>Test cases can be added not only in library projects
but also in kernel projects.</p>
<p>If you want to run a specific test with a given name,
for example, if the test is named <code>foo</code>,
use the following command:</p>
<pre><code class="language-bash">cargo osdk test foo
</code></pre>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<p>All of the <code>build</code>, <code>run</code>, and <code>test</code> commands accept options
to control their behavior, such as how to compile and
launch the kernel.
The following documentations provide details on
all the available options:</p>
<ul>
<li><a href="#cargo-osdk-build"><code>build</code> options</a></li>
<li><a href="#cargo-osdk-run"><code>run</code> options</a></li>
<li><a href="#cargo-osdk-test"><code>test</code> options</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="working-in-a-workspace"><a class="header" href="#working-in-a-workspace">Working in a Workspace</a></h1>
<p>Typically, an operating system may consist of multiple crates,
and these crates may be organized in a workspace.
The OSDK also supports managing projects in a workspace.
Below is an example that demonstrates
how to create, build, run, and test projects in a workspace.</p>
<h2 id="creating-a-new-workspace"><a class="header" href="#creating-a-new-workspace">Creating a new workspace</a></h2>
<p>Create a new workspace by executing the following commands:</p>
<pre><code class="language-bash">mkdir myworkspace &amp;&amp; cd myworkspace
touch Cargo.toml
</code></pre>
<p>Then, add the following content to <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[workspace]
members = []
resolver = "2"
</code></pre>
<h2 id="creating-a-kernel-project-and-a-library-project"><a class="header" href="#creating-a-kernel-project-and-a-library-project">Creating a kernel project and a library project</a></h2>
<p>The two projects can be created using the following commands:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos
cargo osdk new mylib
</code></pre>
<p>The generated directory structure will be as follows:</p>
<pre><code class="language-text">myworkspace/
  ‚îú‚îÄ‚îÄ Cargo.toml
  ‚îú‚îÄ‚îÄ OSDK.toml
  ‚îú‚îÄ‚îÄ rust-toolchain.toml
  ‚îú‚îÄ‚îÄ myos/
  ‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml
  ‚îÇ   ‚îî‚îÄ‚îÄ src/
  ‚îÇ       ‚îî‚îÄ‚îÄ lib.rs
  ‚îî‚îÄ‚îÄ mylib/
      ‚îú‚îÄ‚îÄ Cargo.toml
      ‚îî‚îÄ‚îÄ src/
          ‚îî‚îÄ‚îÄ lib.rs
</code></pre>
<p>At present, the OSDK mandates that there must be only one kernel project
within a workspace.</p>
<p>In addition to the two projects,
the OSDK will also generate <code>OSDK.toml</code> and <code>rust-toolchain.toml</code>
at the root of the workspace.</p>
<p>Next, add the following function to <code>mylib/src/lib.rs</code>.
This function will calculate the available memory
after booting:</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

pub fn available_memory() -&gt; usize {
    let regions = &amp;ostd::boot::boot_info().memory_regions;
    regions.iter().map(|region| region.len()).sum()
}</code></pre>
<p>Then, add a dependency on <code>mylib</code> to <code>myos/Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
mylib = { path = "../mylib" }
</code></pre>
<p>In <code>myos/src/lib.rs</code>,
modify the file content as follows.
This main function will call the function from <code>mylib</code>:</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

#![no_std]
#![deny(unsafe_code)]

use ostd::prelude::*;

#[ostd::main]
fn kernel_main() {
    let avail_mem_as_mb = mylib::available_memory() / 1_000_000;
    println!("The available memory is {} MB", avail_mem_as_mb);
}</code></pre>
<h2 id="building-and-running-the-kernel"><a class="header" href="#building-and-running-the-kernel">Building and Running the kernel</a></h2>
<p>Build and run the project using the following commands:</p>
<pre><code class="language-bash">cargo osdk build
cargo osdk run
</code></pre>
<p>If everything goes well,
you will see the output from the guest kernel.</p>
<h2 id="running-unit-test"><a class="header" href="#running-unit-test">Running unit test</a></h2>
<p>You can run test cases from all crates
by using the following command in the workspace folder:</p>
<pre><code class="language-bash">cargo osdk test
</code></pre>
<p>If you want to run test cases from a specific crate,
navigate to the crate‚Äôs folder
and run <code>cargo osdk test</code>.
For example, if you want to test <code>mylib</code>,
use the following command:</p>
<pre><code class="language-bash">cd mylib &amp;&amp; cargo osdk test
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced topics</a></h1>
<p>This chapter delves into advanced topics regarding OSDK,
including its application in TEE environments such as Intel TDX.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="running-an-os-in-intel-tdx-env"><a class="header" href="#running-an-os-in-intel-tdx-env">Running an OS in Intel TDX env</a></h1>
<p>The OSDK supports running your OS in an <a href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html">Intel TDX</a> environment conveniently.
Intel TDX can provide a more secure environment for your OS.</p>
<h2 id="prepare-the-intel-tdx-environment-1"><a class="header" href="#prepare-the-intel-tdx-environment-1">Prepare the Intel TDX Environment</a></h2>
<p>Please make sure your server supports Intel TDX.</p>
<p>See <a href="https://github.com/canonical/tdx/tree/noble-24.04?tab=readme-ov-file#4-setup-host-os">this guide</a>
or other materials to enable Intel TDX in host OS.</p>
<p>To verify the TDX host status, you can type:</p>
<pre><code class="language-bash">dmesg | grep "TDX module initialized"
</code></pre>
<p>The following result is an example:</p>
<pre><code class="language-bash">[   20.507296] tdx: TDX module initialized.
</code></pre>
<p>If you see the message ‚ÄúTDX module initialized‚Äù,
it means the TDX module has loaded successfully.</p>
<p>The Intel TDX environment requires TDX-enhanced versions of QEMU, KVM, GRUB,
and other essential software for running an OS.
Therefore, it is recommended to use a Docker image to deploy the environment.</p>
<p>Run a TDX Docker container:</p>
<pre><code class="language-bash">docker run -it --privileged --network=host --device=/dev/kvm asterinas/osdk:0.17.0-20260227
</code></pre>
<h2 id="edit-osdktoml-for-intel-tdx-support"><a class="header" href="#edit-osdktoml-for-intel-tdx-support">Edit <code>OSDK.toml</code> for Intel TDX support</a></h2>
<p>As Intel TDX has extra requirements or restrictions for VMs,
it demands adjusting the OSDK configurations accordingly.
This can be easily achieved with the <code>scheme</code> feature of the OSDK,
which provides a convenient way to override the default OSDK configurations
for a specific environment.</p>
<p>For example, you can append the following TDX-specific scheme to your <code>OSDK.toml</code> file.</p>
<pre><code class="language-toml">[scheme."tdx"]
supported_archs = ["x86_64"]
boot.method = "grub-qcow2"
grub.mkrescue_path = "~/tdx-tools/grub"
grub.boot_protocol = "linux"
qemu.args = '''\
    -accel kvm \
    -m 8G \
    -vga none \
    -monitor pty \
    -nodefaults \
    -drive file=target/osdk/asterinas/asterinas.qcow2,if=virtio,format=qcow2 \
    -monitor telnet:127.0.0.1:9001,server,nowait \
    -bios /root/ovmf/release/OVMF.fd \
    -object '{ \"qom-type\": \"tdx-guest\", \"id\": \"tdx0\", \"sept-ve-disable\": true, \"quote-generation-socket\": { \"type\": \"vsock\", \"cid\": \"2\", \"port\": \"4050\" } }' \
    -cpu host,-kvm-steal-time,pmu=off \
    -machine q35,kernel-irqchip=split,confidential-guest-support=tdx0 \
    -smp 1 \
    -nographic \
'''
</code></pre>
<p>To choose the configurations specified by the TDX scheme over the default ones,
add the <code>--scheme</code> argument to the build, run, or test command.</p>
<pre><code class="language-bash">cargo osdk build --scheme tdx
cargo osdk run --scheme tdx
cargo osdk test --scheme tdx
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="osdk-user-reference"><a class="header" href="#osdk-user-reference">OSDK User Reference</a></h1>
<p>The Asterinas OSDK is a command line tool that can be used
as a subcommand of Cargo.
The common usage of OSDK is:</p>
<pre><code class="language-bash">cargo osdk &lt;COMMAND&gt;
</code></pre>
<p>You can use <code>cargo osdk -h</code>
to see the full list of available commands.
For the specific usage of a subcommand,
you can use <code>cargo osdk help &lt;COMMAND&gt;</code>.</p>
<h2 id="manifest"><a class="header" href="#manifest">Manifest</a></h2>
<p>The OSDK utilizes a manifest named <code>OSDK.toml</code>
to define its precise behavior regarding
how to run a kernel with QEMU.
The <code>OSDK.toml</code> file should be placed
in the same folder as the project‚Äôs <code>Cargo.toml</code>.
The <a href="#manifest-1">Manifest documentation</a>
provides an introduction
to all the available configuration options.</p>
<p>The command line tool can also be used
to set the options in the manifest.
If both occur, the command line options
will always take priority over the options in the manifest.
For example, if the manifest defines the path of QEMU as:</p>
<pre><code class="language-toml">[qemu]
path = "/usr/bin/qemu-system-x86_64"
</code></pre>
<p>But the user provides a new QEMU path
when running the project using:</p>
<pre><code class="language-bash">cargo osdk run --qemu.path="/usr/local/qemu-kvm"
</code></pre>
<p>Then, the actual path of QEMU should be <code>/usr/local/qemu-kvm</code>
since command line options have higher priority.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<p>OSDK provides similar subcommands as Cargo,
and these subcommands have similar meanings
as corresponding Cargo subcommands.</p>
<p>Currently, OSDK supports the following subcommands:</p>
<ul>
<li><strong>new</strong>: Create a new kernel package or library package</li>
<li><strong>build</strong>: Compile the project and its dependencies</li>
<li><strong>run</strong>: Run the kernel with a VMM</li>
<li><strong>test</strong>: Execute kernel mode unit test by starting a VMM</li>
<li><strong>debug</strong>: Debug a remote target via GDB</li>
<li><strong>profile</strong>: Profile a remote GDB debug target to collect stack traces</li>
<li><strong>check</strong>: Analyze the current package and report errors</li>
<li><strong>clippy</strong>: Check the current package and catch common mistakes</li>
</ul>
<p>The <strong>new</strong>, <strong>build</strong>, <strong>run</strong>, <strong>test</strong> and <strong>debug</strong> subcommands
can accept additional options,
while the <strong>check</strong> and <strong>clippy</strong> subcommands can only accept arguments
that are compatible with the corresponding Cargo subcommands.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-new"><a class="header" href="#cargo-osdk-new">cargo osdk new</a></h1>
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p>The <code>cargo osdk new</code> command
is used to create a kernel project
or a new library project.
The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk new [OPTIONS] &lt;name&gt;
</code></pre>
<h2 id="arguments"><a class="header" href="#arguments">Arguments</a></h2>
<p><code>&lt;name&gt;</code>: the name of the crate.</p>
<h2 id="options-1"><a class="header" href="#options-1">Options</a></h2>
<p><code>--kernel</code>:
Use the kernel template.
If this option is not set,
the library template will be used by default.</p>
<p><code>--library</code>:
Use the library template. This is the default option.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<ul>
<li>Create a new kernel named <code>myos</code>:</li>
</ul>
<pre><code class="language-bash">cargo osdk new --kernel myos
</code></pre>
<ul>
<li>Create a new library named <code>mylib</code>:</li>
</ul>
<pre><code class="language-bash">cargo osdk new mylib
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-build"><a class="header" href="#cargo-osdk-build">cargo osdk build</a></h1>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p>The <code>cargo osdk build</code> command is used to
compile the project and its dependencies.
The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk build [OPTIONS]
</code></pre>
<h2 id="options-2"><a class="header" href="#options-2">Options</a></h2>
<p>The options can be divided into two types:
Cargo options that can be accepted by Cargo,
and Manifest options that can also be defined
in the manifest named <code>OSDK.toml</code>.</p>
<h3 id="cargo-options"><a class="header" href="#cargo-options">Cargo options</a></h3>
<ul>
<li>
<p><code>--profile &lt;PROFILE&gt;</code>:
Build artifacts with the specified Cargo profile
(built-in candidates are ‚Äòdev‚Äô, ‚Äòrelease‚Äô, ‚Äòtest‚Äô, and ‚Äòbench‚Äô)
[default: dev]</p>
</li>
<li>
<p><code>--release</code>:
Build artifacts in release mode, with optimizations</p>
</li>
<li>
<p><code>--features &lt;FEATURES&gt;</code>:
Space or comma separated list of features to activate</p>
</li>
<li>
<p><code>--no-default-features</code>:
Do not activate the <code>default</code> features</p>
</li>
<li>
<p><code>--config &lt;KEY=VALUE&gt;</code>:
Override a configuration value</p>
</li>
</ul>
<p>More Cargo options will be supported in future versions of OSDK.</p>
<h3 id="manifest-options"><a class="header" href="#manifest-options">Manifest options</a></h3>
<p>These options can also be defined
in the project‚Äôs manifest named <code>OSDK.toml</code>.
Command line options are used to override
or append values in <code>OSDK.toml</code>.
The allowed values for each option can be found
in the <a href="#manifest-1">Manifest Documentation</a>.</p>
<ul>
<li><code>--kcmd-args &lt;ARGS&gt;</code>:
Command line arguments for the guest kernel</li>
<li><code>--init-args &lt;ARGS&gt;</code>:
Command line arguments for the init process</li>
<li><code>--initramfs &lt;PATH&gt;</code>:
Path of the initramfs</li>
<li><code>--boot-method &lt;METHOD&gt;</code>:
The method to boot the kernel</li>
<li><code>--grub-mkrescue &lt;PATH&gt;</code>:
Path of grub-mkrescue</li>
<li><code>--grub-boot-protocol &lt;PROTOCOL&gt;</code>:
The boot protocol for booting the kernel</li>
<li><code>--display-grub-menu</code>:
To display the GRUB menu if booting with GRUB</li>
<li><code>--qemu-exe &lt;FILE&gt;</code>:
The QEMU executable file</li>
<li><code>--qemu-args &lt;ARGS&gt;</code>:
Extra arguments for running QEMU</li>
<li><code>--strip-elf</code>:
Whether to strip the built kernel ELF using <code>rust-strip</code></li>
<li><code>--scheme &lt;SCHEME&gt;</code>:
Select the specific configuration scheme provided in the OSDK manifest</li>
<li><code>--encoding &lt;FORMAT&gt;</code>:
Denote the encoding format for kernel self-decompression</li>
</ul>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<ul>
<li>Build a project with <code>./initramfs.cpio.gz</code>
as the initramfs and <code>multiboot2</code> as the boot protocol used by GRUB:</li>
</ul>
<pre><code class="language-bash">cargo osdk build --initramfs="./initramfs.cpio.gz" --grub-boot-protocol="multiboot2"
</code></pre>
<ul>
<li>Build a project and append <code>sh</code>, <code>-l</code>
to init process arguments:</li>
</ul>
<pre><code class="language-bash">cargo osdk build --init_args="sh" --init_args="-l"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-run"><a class="header" href="#cargo-osdk-run">cargo osdk run</a></h1>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p><code>cargo osdk run</code> is used to run the kernel with QEMU.
The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk run [OPTIONS]
</code></pre>
<h2 id="options-3"><a class="header" href="#options-3">Options</a></h2>
<p>Most options are the same as those of <code>cargo osdk build</code>.
Refer to the <a href="#cargo-osdk-build">documentation</a> of <code>cargo osdk build</code>
for more details.</p>
<p>Additionally, when running the kernel using QEMU, we can setup the QEMU as a
debug server using option <code>--gdb-server</code>. This option supports an additional
comma separated configuration list:</p>
<ul>
<li><code>addr=ADDR</code>: the network or unix socket address on which the GDB server listens
(default: <code>.osdk-gdb-socket</code>, a local UNIX socket);</li>
<li><code>wait-client</code>: let the GDB server wait for the GDB client before execution;</li>
<li><code>vscode</code>: generate a ‚Äò.vscode/launch.json‚Äô for debugging with Visual Studio Code
(Requires <a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a>).</li>
</ul>
<p>Besides, to collect coverage data, we can use option <code>--coverage</code>. This option
enables the coverage feature and collect coverage data to <code>coverage.profraw</code> when exit.</p>
<p>See <a href="#cargo-osdk-debug">Debug Command</a> to interact with the GDB server in terminal.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<p>Launch a debug server via QEMU with an unix socket stub, e.g. <code>.debug</code>:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server addr=.debug

```bash
cargo osdk run --gdb-server --gdb-server-addr .debug
</code></pre>
<p>Launch a debug server via QEMU with a TCP stub, e.g., <code>localhost:1234</code>:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server addr=:1234
</code></pre>
<p>Launch a debug server via QEMU and use VSCode to interact with:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server wait-client,vscode,addr=:1234
</code></pre>
<p>Launch a debug server via QEMU and use VSCode to interact with:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server --gdb-vsc --gdb-server-addr :1234
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-test"><a class="header" href="#cargo-osdk-test">cargo osdk test</a></h1>
<p><code>cargo osdk test</code> is used to
execute kernel mode unit test by starting QEMU.
The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk test [TESTNAME] [OPTIONS] 
</code></pre>
<h2 id="arguments-1"><a class="header" href="#arguments-1">Arguments</a></h2>
<p><code>TESTNAME</code>:
Only run tests containing this string in their names</p>
<h2 id="options-4"><a class="header" href="#options-4">Options</a></h2>
<p>The options are the same as those of <code>cargo osdk build</code>.
Refer to the <a href="#cargo-osdk-build">documentation</a> of <code>cargo osdk build</code>
for more details.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<ul>
<li>Execute tests that include <em>foo</em> in their names
using QEMU with 3GB of memory</li>
</ul>
<pre><code class="language-bash">cargo osdk test foo --qemu-args="-m 3G"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-debug"><a class="header" href="#cargo-osdk-debug">cargo osdk debug</a></h1>
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p><code>cargo osdk debug</code> is used to debug a remote target via GDB. You need to start
a running server to debug with. This is accomplished by the <code>run</code> subcommand
with <code>--gdb-server</code>. Then you can use the following command to attach to the
server and do debugging.</p>
<pre><code class="language-bash">cargo osdk debug [OPTIONS]
</code></pre>
<p>Note that when KVM is enabled, hardware-assisted break points (<code>hbreak</code>) are
needed instead of the normal break points (<code>break</code>/<code>b</code>) in GDB.</p>
<h2 id="options-5"><a class="header" href="#options-5">Options</a></h2>
<p><code>--remote &lt;REMOTE&gt;</code>:
Specify the address of the remote target [default: .osdk-gdb-socket].
The address can be either a path for the UNIX domain socket
or a TCP port on an IP address.</p>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>
<p>To debug a remote target started with
<a href="https://www.qemu.org/docs/master/system/gdb.html">QEMU GDB stub</a> or the <code>run</code>
subcommand, use the following commands.</p>
<p>Connect to an unix socket, e.g., <code>./debug</code>:</p>
<pre><code class="language-bash">cargo osdk debug --remote ./debug
</code></pre>
<p>Connect to a TCP port (<code>[IP]:PORT</code>), e.g., <code>localhost:1234</code>:</p>
<pre><code class="language-bash">cargo osdk debug --remote localhost:1234
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-profile"><a class="header" href="#cargo-osdk-profile">cargo osdk profile</a></h1>
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<p>The profile command is used to collect stack traces when running the target
kernel in QEMU. It attaches to the GDB server, initiated with the run subcommand,
and collects the stack trace periodically. The collected information can be
used to directly generate a flame graph, or be stored for later analysis using
<a href="https://github.com/brendangregg/FlameGraph">the original flame graph tool</a>.</p>
<h2 id="options-6"><a class="header" href="#options-6">Options</a></h2>
<p><code>--remote &lt;REMOTE&gt;</code>:</p>
<p>Specify the address of the remote target.
By default this is <code>.osdk-gdb-socket</code></p>
<p><code>--samples &lt;SAMPLES&gt;</code>:</p>
<p>The number of samples to collect (default 200).
It is recommended to go beyond 100 for performance analysis.</p>
<p><code>--interval &lt;INTERVAL&gt;</code>:</p>
<p>The interval between samples in seconds (default 0.1).</p>
<p><code>--parse &lt;PATH&gt;</code>:</p>
<p>Parse a collected JSON profile file into other formats.</p>
<p><code>--format &lt;FORMAT&gt;</code>:</p>
<p>Possible values:
- <code>json</code>:   The parsed stack trace log from GDB in JSON.
- <code>folded</code>: The folded stack trace for flame graph.
- <code>flame-graph</code>: A SVG flame graph.</p>
<p>If the user does not specify the format, it will be inferred from the
output file extension. If the output file does not have an extension,
the default format is flame graph.</p>
<p><code>--cpu-mask &lt;CPU_MASK&gt;</code>:</p>
<p>The mask of the CPU to generate traces for in the output profile data
(default first 128 cores). This mask is presented as an integer.</p>
<p><code>--output &lt;PATH&gt;</code>:</p>
<p>The path to the output profile data file.</p>
<p>If the user does not specify the output path, it will be generated from
the crate name, current time stamp and the format.</p>
<h2 id="examples-5"><a class="header" href="#examples-5">Examples</a></h2>
<p>To profile a remote QEMU GDB server running some workload for flame graph, do:</p>
<pre><code class="language-bash">cargo osdk profile --remote :1234 \
	--samples 100 --interval 0.01
</code></pre>
<p>If wanted a detailed analysis, do:</p>
<pre><code class="language-bash">cargo osdk profile --remote :1234 \
	--samples 100 --interval 0.01 --output trace.json
</code></pre>
<p>When you get the above detailed analysis, you can also use the JSON file
to generate the folded format for flame graph.</p>
<pre><code class="language-bash">cargo osdk profile --parse trace.json --output trace.folded
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="manifest-1"><a class="header" href="#manifest-1">Manifest</a></h1>
<h2 id="overview-8"><a class="header" href="#overview-8">Overview</a></h2>
<p>The OSDK tool utilizes a manifest to define its precise behavior.
Typically, the configuration file is named <code>OSDK.toml</code>
and is placed in the root directory of the workspace
(the same directory as the workspace‚Äôs <code>Cargo.toml</code>).
If there is only one crate and no workspace,
the file is placed in the crate‚Äôs root directory.</p>
<p>For a crate inside workspace,
it may have two distinct related manifests,
one is of the workspace
(in the same directory as the workspace‚Äôs <code>Cargo.toml</code>)
and one of the crate
(in the same directory as the crate‚Äôs <code>Cargo.toml</code>).
OSDK will firstly try to find the crate-level manifest.
If the crate-level manifest is found, OSDK uses it only.
If the manifest is not found, OSDK will look into the
workspace-level manifest.</p>
<h2 id="configurations"><a class="header" href="#configurations">Configurations</a></h2>
<p>Below, you will find a comprehensive version of
the available configurations in the manifest.</p>
<pre><code class="language-toml">project_type = "kernel"                     # &lt;1&gt; 

# --------------------------- the default scheme settings -------------------------------
supported_archs = ["x86_64", "riscv64"]     # &lt;2&gt;

# The common options for all build, run and test subcommands 
[build]                                     # &lt;3&gt;
features = ["no_std", "alloc"]              # &lt;4&gt;
profile = "dev"                             # &lt;5&gt;
strip_elf = false                           # &lt;6&gt;
encoding = "raw"                            # &lt;7&gt;
[boot]                                      # &lt;8&gt;
method = "qemu-direct"                      # &lt;9&gt;
kcmd_args = ["SHELL=/bin/sh", "HOME=/"]     # &lt;10&gt;
init_args = ["sh", "-l"]                    # &lt;11&gt;
initramfs = "path/to/it"                    # &lt;12&gt;
[grub]                                      # &lt;13&gt;  
mkrescue_path = "path/to/it"                # &lt;14&gt;
boot_protocol = "multiboot2"                # &lt;15&gt; 
display_grub_menu = false                   # &lt;16&gt;
[qemu]                                      # &lt;17&gt;
path = "path/to/it"                         # &lt;18&gt;
args = "-machine q35 -m 2G"                 # &lt;19&gt;

# Special options for run subcommand
[run]                                       # &lt;20&gt;
[run.build]                                 # &lt;3&gt;
[run.boot]                                  # &lt;8&gt;
[run.grub]                                  # &lt;13&gt;
[run.qemu]                                  # &lt;17&gt;

# Special options for test subcommand
[test]                                      # &lt;21&gt;
[test.build]                                # &lt;3&gt;
[test.boot]                                 # &lt;8&gt;
[test.grub]                                 # &lt;13&gt;
[test.qemu]                                 # &lt;17&gt;
# ----------------------- end of the default scheme settings ----------------------------

# A customized scheme settings
[scheme."custom"]                           # &lt;22&gt;
[scheme."custom".build]                     # &lt;3&gt;
[scheme."custom".run]                       # &lt;20&gt;
[scheme."custom".test]                      # &lt;21&gt;
</code></pre>
<p>Here are some additional notes for the fields:</p>
<ol>
<li>
<p>The type of current crate.</p>
<p>Optional. If not specified,
the default value is inferred from the usage of the macro <code>#[ostd::main]</code>.
if the macro is used, the default value is <code>kernel</code>.
Otherwise, the default value is <code>library</code>.</p>
<p>Possible values are <code>library</code> or <code>kernel</code>.</p>
</li>
<li>
<p>The architectures that can be supported.</p>
<p>Optional. By default OSDK supports all architectures.
When building or running,
if not specified in the CLI,
the architecture of the host machine will be used.</p>
<p>Possible values are <code>aarch64</code>, <code>riscv64</code>, <code>x86_64</code>.</p>
</li>
<li>
<p>Options for compilation stage.</p>
</li>
<li>
<p>Cargo features to activate.</p>
<p>Optional. The default value is empty.</p>
<p>Only features defined in <code>Cargo.toml</code> can be added to this array.</p>
</li>
<li>
<p>Build artifacts with the specified Cargo profile.</p>
<p>Optional. The default value is <code>dev</code>.</p>
<p>Possible values are <code>dev</code>, <code>release</code>, <code>test</code>, and <code>bench</code>
and other profiles defined in <code>Cargo.toml</code>.</p>
</li>
<li>
<p>Whether to strip the built kernel ELF using <code>rust-strip</code>.</p>
<p>Optional. The default value is <code>false</code>.</p>
</li>
<li>
<p>Denote the encoding format for kernel self-decompression</p>
<p>Optional. The default value is <code>raw</code>.</p>
<p>Possible values are <code>raw</code>, <code>gzip</code> and <code>zlib</code>.</p>
<p>If the boot protocol is not <code>linux</code>, it is not allowed to specipy the econding format.</p>
</li>
<li>
<p>Options for booting the kernel.</p>
</li>
<li>
<p>The boot method.</p>
<p>Optional. The default value is <code>qemu-direct</code>.</p>
<p>Possible values are <code>grub-rescue-iso</code>, <code>grub-qcow2</code> and <code>qemu-direct</code>.</p>
</li>
<li>
<p>The arguments provided will be passed to the guest kernel.</p>
<p>Optional. The default value is empty.</p>
<p>Each argument should be in one of the following two forms:
<code>KEY=VALUE</code> or <code>KEY</code> if no value is required.
Each <code>KEY</code> can appear at most once.</p>
</li>
<li>
<p>The arguments provided will be passed to the init process,
usually, the init shell.</p>
<p>Optional. The default value is empty.</p>
</li>
<li>
<p>The path to the initramfs.</p>
<p>Optional. The default value is empty.</p>
<p>If the path is relative, it is relative to the manifest‚Äôs enclosing directory.</p>
</li>
<li>
<p>Grub options. Only take effect if boot method is <code>grub-rescue-iso</code> or <code>grub-qcow2</code>.</p>
</li>
<li>
<p>The path to the <code>grub-mkrescue</code> executable.</p>
<p>Optional. The default value is the executable in the system path, if any.</p>
<p>If the path is relative, it is relative to the manifest‚Äôs enclosing directory.</p>
</li>
<li>
<p>The protocol GRUB used.</p>
<p>Optional. The default value is <code>multiboot2</code>.</p>
<p>Possible values are <code>linux</code>, <code>multiboot</code>, <code>multiboot2</code>.</p>
</li>
<li>
<p>Whether to display the GRUB menu when booting with GRUB.</p>
<p>Optional. The default value is <code>false</code>.</p>
</li>
<li>
<p>Options for finding and starting QEMU.</p>
</li>
<li>
<p>The path to the QEMU executable.</p>
<p>Optional. The default value is the executable in the system path, if any.</p>
<p>If the path is relative, it is relative to the manifest‚Äôs enclosing directory.</p>
</li>
<li>
<p>Additional arguments passed to QEMU are organized in a single string that
can include any POSIX shell compliant separators.</p>
<p>Optional. The default value is empty.</p>
<p>Each argument should be in the form of <code>KEY</code> and <code>VALUE</code>
or <code>KEY</code> if no value is required.
Some keys can appear multiple times
(e.g., <code>-device</code>, <code>-netdev</code>),
while other keys can appear at most once.
Certain keys, such as <code>-kernel</code> and <code>-initrd</code>,
are not allowed to be set here
as they may conflict with the settings of OSDK.</p>
<p>The field will be evaluated, so it is ok to use environment variables
in the arguments (usually for paths or conditional arguments). You can
even use this mechanism to read from files by using command replacement
<code>$(cat path/to/your/custom/args/file)</code>.</p>
</li>
<li>
<p>Special settings for running. Only take effect when running <code>cargo osdk run</code>.</p>
<p>By default, it inherits common options.</p>
<p>Values set here are used to override common options.</p>
</li>
<li>
<p>Special settings for testing.</p>
<p>Similar to <code>20</code>, but only take effect when running <code>cargo osdk test</code>.</p>
</li>
<li>
<p>The definition of customized scheme.</p>
<p>A customized scheme has the same fields as the default scheme.
By default, a customized scheme will inherit all options from the default scheme,
unless overridden by new options.</p>
</li>
</ol>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>Here is a sound, self-explanatory example which is used by OSDK
in the Asterinas project.</p>
<p>In the script <code>./tools/qemu_args.sh</code>, the environment variables will be
used to determine the actual set of qemu arguments.</p>
<pre><code class="language-toml"># The OSDK manifest at the Asterinas root virtual workspace 
# provides default OSDK settings for all packages.

# The common options for build, run and test
[boot]
method = "grub-rescue-iso"

[grub]
boot_protocol = "multiboot2"

[qemu]
args = "$(./tools/qemu_args.sh normal)"

# Special options for running
[run.boot]
kcmd_args = [
    "SHELL=/bin/sh",
    "LOGNAME=root",
    "HOME=/",
    "USER=root",
    "PATH=/bin:/benchmark",
    "init=/usr/bin/busybox",
]
init_args = ["sh", "-l"]
initramfs = "test/initramfs/build/initramfs.cpio.gz"

# Special options for testing
[test.qemu]
args = "$(./tools/qemu_args.sh test)"

# Other Schemes

[scheme."microvm"]
boot.method = "qemu-direct"
build.strip_elf = true
qemu.args = "$(./tools/qemu_args.sh microvm)"

[scheme."iommu"]
supported_archs = ["x86_64"]
qemu.args = "$(./tools/qemu_args.sh iommu)"

[scheme."tdx"]
supported_archs = ["x86_64"]
build.features = ["cvm_guest"]
boot.method = "grub-qcow2"
grub.boot_protocol = "linux"
qemu.args = "$(./tools/qemu_args.sh tdx)"

[scheme."riscv"]
supported_archs = ["riscv64"]
boot.method = "qemu-direct"
build.strip_elf = false

qemu.args = """\
    -cpu rv64,svpbmt=true \
    -machine virt \
    -m ${MEM-:8G} \
    -smp ${SMP-:1} \
    --no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log \
    -drive if=none,format=raw,id=x0,file=./test/initramfs/build/ext2.img \
    -drive if=none,format=raw,id=x1,file=./test/initramfs/build/exfat.img \
    # NOTE: The `/etc/profile.d/init.sh` assumes that `ext2.img` appears as the first block device (`/dev/vda`).
    # The ordering below ensures `x1` (ext2.img) is discovered before `x0`, maintaining this assumption.
    # TODO: Once UUID-based mounting is implemented, this strict ordering will no longer be required.
    -device virtio-blk-device,drive=x1 \
    -device virtio-blk-device,drive=x0 \
    -device virtio-keyboard-device \
    -device virtio-serial-device \
    -device virtconsole,chardev=mux \
"""

[scheme."sifive_u"]
supported_archs = ["riscv64"]
build.features = ["riscv_sv39_mode"]
boot.method = "qemu-direct"
build.strip_elf = false
qemu.with_monitor = true

qemu.args = """\
    -machine sifive_u \
    -m 8G \
    -smp 5 \
    -no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log
"""

[scheme."loongarch"]
boot.method = "qemu-direct"
build.strip_elf = false

qemu.args = """\
    -machine virt \
    -m 8G \
    -smp 1 \
    --no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log \
    -device virtio-keyboard-pci \
    -device virtio-serial \
    -device virtconsole,chardev=mux \
    -rtc base=utc
"""
</code></pre>
<h3 id="scheme"><a class="header" href="#scheme">Scheme</a></h3>
<p>Scheme is an advanced feature that allows you to create multiple profiles for
the same action (<code>build</code>, <code>run</code>, or <code>test</code>) under different scenarios (e.g.,
x86 vs. RISC-V). Schemes support any user-defined keys (see the 22nd
configuration) and can be selected using the <code>--scheme</code> CLI argument.</p>
<p>If a scheme <code>&lt;s&gt;</code> is selected for an action (such as <code>test</code>), the value of an
unspecified but required configuration <code>key</code> will be determined by the
following rules:</p>
<ul>
<li>If the general config (<code>scheme.&lt;s&gt;.key</code>) exists for the selected scheme, use
this value.</li>
<li>Otherwise, if the default scheme has this configuration for the action
(<code>test.key</code>), use this value.</li>
<li>Otherwise, if the default scheme has this configuration (<code>key</code>), use this
value.</li>
</ul>
<p>If the value is still not found, either the default value for the key will be
used or an error will be thrown.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h1>
<p>The OSDK tool uses the following environment variables to customize compilation and target behavior.</p>
<h2 id="osdk-specific-variables"><a class="header" href="#osdk-specific-variables">OSDK-Specific Variables</a></h2>
<ul>
<li><code>OSDK_TARGET_ARCH</code>: If set, OSDK will use the specified value as its default target architecture (e.g., x86_64, riscv64).
If not set, OSDK will default to the host architecture.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="before-you-contribute"><a class="header" href="#before-you-contribute">Before You Contribute</a></h1>
<p>This part of the Book provides guidelines for contributing to Asterinas.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="coding-guidelines"><a class="header" href="#coding-guidelines">Coding Guidelines</a></h1>
<p>This section describes coding and collaboration conventions
for the Asterinas project.
These guidelines aim to keep code
clear, consistent, maintainable, correct, and efficient.</p>
<p>For the underlying philosophy, principles,
and quality criteria for individual guidelines, see
<strong><a href="#how-guidelines-are-written">How Guidelines Are Written</a></strong>.</p>
<p>The guidelines are organized into the following pages:</p>
<ul>
<li><strong><a href="#general-guidelines">General Guidelines</a></strong> ‚Äî
Language-agnostic guidance for naming, comments,
layout, formatting, and API design.</li>
<li><strong><a href="#rust-guidelines">Rust Guidelines</a></strong> ‚Äî
Rust-specific guidance for naming, language items,
and cross-cutting topics.</li>
<li><strong><a href="#git-guidelines">Git Guidelines</a></strong> ‚Äî
Commit hygiene and pull-request conventions.</li>
<li><strong><a href="#testing-guidelines">Testing Guidelines</a></strong> ‚Äî
Test behavior, assertions, regression policy,
and cleanup.</li>
<li><strong><a href="#assembly-guidelines">Assembly Guidelines</a></strong> ‚Äî
<code>.S</code> and <code>global_asm!</code> conventions for sectioning,
function metadata, labels, and alignment.</li>
</ul>
<p>The guidelines represent the <em>desired</em> state of the codebase.
If you find conflicting cases in the codebase,
you are welcome to fix the code to match the guidelines.</p>
<h2 id="index"><a class="header" href="#index">Index</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Guideline</th><th>Short Name</th></tr>
</thead>
<tbody>
<tr><td>General</td><td>Be descriptive</td><td><a href="#descriptive-names"><code>descriptive-names</code></a></td></tr>
<tr><td>General</td><td>Be accurate</td><td><a href="#accurate-names"><code>accurate-names</code></a></td></tr>
<tr><td>General</td><td>Encode units and important attributes in names</td><td><a href="#encode-units"><code>encode-units</code></a></td></tr>
<tr><td>General</td><td>Use assertion-style boolean names</td><td><a href="#bool-names"><code>bool-names</code></a></td></tr>
<tr><td>General</td><td>Prefer semantic line breaks</td><td><a href="#semantic-line-breaks"><code>semantic-line-breaks</code></a></td></tr>
<tr><td>General</td><td>Explain why, not what</td><td><a href="#explain-why"><code>explain-why</code></a></td></tr>
<tr><td>General</td><td>Document design decisions</td><td><a href="#design-decisions"><code>design-decisions</code></a></td></tr>
<tr><td>General</td><td>Cite specifications and algorithm sources</td><td><a href="#cite-sources"><code>cite-sources</code></a></td></tr>
<tr><td>General</td><td>One concept per file</td><td><a href="#one-concept-per-file"><code>one-concept-per-file</code></a></td></tr>
<tr><td>General</td><td>Organize code for top-down reading</td><td><a href="#top-down-reading"><code>top-down-reading</code></a></td></tr>
<tr><td>General</td><td>Group statements into logical paragraphs</td><td><a href="#logical-paragraphs"><code>logical-paragraphs</code></a></td></tr>
<tr><td>General</td><td>Format error messages consistently</td><td><a href="#error-message-format"><code>error-message-format</code></a></td></tr>
<tr><td>General</td><td>Stick to familiar conventions</td><td><a href="#familiar-conventions"><code>familiar-conventions</code></a></td></tr>
<tr><td>General</td><td>Hide implementation details</td><td><a href="#hide-impl-details"><code>hide-impl-details</code></a></td></tr>
<tr><td>General</td><td>Validate at boundaries, trust internally</td><td><a href="#validate-at-boundaries"><code>validate-at-boundaries</code></a></td></tr>
<tr><td>Rust</td><td>Follow Rust CamelCase and acronym capitalization</td><td><a href="#camel-case-acronyms"><code>camel-case-acronyms</code></a></td></tr>
<tr><td>Rust</td><td>End closure variables with <code>_fn</code></td><td><a href="#closure-fn-suffix"><code>closure-fn-suffix</code></a></td></tr>
<tr><td>Rust</td><td>Introduce explaining variables</td><td><a href="#explain-variables"><code>explain-variables</code></a></td></tr>
<tr><td>Rust</td><td>Use block expressions to scope temporary state</td><td><a href="#block-expressions"><code>block-expressions</code></a></td></tr>
<tr><td>Rust</td><td>Use checked or saturating arithmetic</td><td><a href="#checked-arithmetic"><code>checked-arithmetic</code></a></td></tr>
<tr><td>Rust</td><td>Minimize nesting</td><td><a href="#minimize-nesting"><code>minimize-nesting</code></a></td></tr>
<tr><td>Rust</td><td>Keep functions small and focused</td><td><a href="#small-functions"><code>small-functions</code></a></td></tr>
<tr><td>Rust</td><td>Avoid boolean arguments</td><td><a href="#no-bool-args"><code>no-bool-args</code></a></td></tr>
<tr><td>Rust</td><td>Use types to enforce invariants</td><td><a href="#rust-type-invariants"><code>rust-type-invariants</code></a></td></tr>
<tr><td>Rust</td><td>Prefer enum over trait objects for closed sets</td><td><a href="#enum-over-dyn"><code>enum-over-dyn</code></a></td></tr>
<tr><td>Rust</td><td>Encapsulate fields behind getters</td><td><a href="#getter-encapsulation"><code>getter-encapsulation</code></a></td></tr>
<tr><td>Rust</td><td>Follow RFC 1574 summary line conventions</td><td><a href="#rfc1574-summary"><code>rfc1574-summary</code></a></td></tr>
<tr><td>Rust</td><td>End sentence comments with punctuation</td><td><a href="#comment-punctuation"><code>comment-punctuation</code></a></td></tr>
<tr><td>Rust</td><td>Wrap identifiers in backticks</td><td><a href="#backtick-identifiers"><code>backtick-identifiers</code></a></td></tr>
<tr><td>Rust</td><td>Do not disclose implementation details in doc comments</td><td><a href="#no-impl-in-docs"><code>no-impl-in-docs</code></a></td></tr>
<tr><td>Rust</td><td>Add module-level documentation for major components</td><td><a href="#module-docs"><code>module-docs</code></a></td></tr>
<tr><td>Rust</td><td>Justify every use of <code>unsafe</code></td><td><a href="#justify-unsafe-use"><code>justify-unsafe-use</code></a></td></tr>
<tr><td>Rust</td><td>Document safety conditions</td><td><a href="#document-safety-conds"><code>document-safety-conds</code></a></td></tr>
<tr><td>Rust</td><td>Deny unsafe code in <code>kernel/</code></td><td><a href="#deny-unsafe-kernel"><code>deny-unsafe-kernel</code></a></td></tr>
<tr><td>Rust</td><td>Reason about safety at the module boundary</td><td><a href="#module-boundary-safety"><code>module-boundary-safety</code></a></td></tr>
<tr><td>Rust</td><td>Default to the narrowest visibility</td><td><a href="#narrow-visibility"><code>narrow-visibility</code></a></td></tr>
<tr><td>Rust</td><td>Use workspace dependencies</td><td><a href="#workspace-deps"><code>workspace-deps</code></a></td></tr>
<tr><td>Rust</td><td>Suppress lints at the narrowest scope</td><td><a href="#narrow-lint-suppression"><code>narrow-lint-suppression</code></a></td></tr>
<tr><td>Rust</td><td>Use <code>#[expect(dead_code)]</code> with restraint</td><td><a href="#expect-dead-code"><code>expect-dead-code</code></a></td></tr>
<tr><td>Rust</td><td>Prefer functions over macros</td><td><a href="#macros-as-last-resort"><code>macros-as-last-resort</code></a></td></tr>
<tr><td>Rust</td><td>Establish and enforce a consistent lock order</td><td><a href="#lock-ordering"><code>lock-ordering</code></a></td></tr>
<tr><td>Rust</td><td>Never do I/O or blocking operations while holding a spinlock</td><td><a href="#no-io-under-spinlock"><code>no-io-under-spinlock</code></a></td></tr>
<tr><td>Rust</td><td>Do not use atomics casually</td><td><a href="#careful-atomics"><code>careful-atomics</code></a></td></tr>
<tr><td>Rust</td><td>Critical sections must not be split across lock boundaries</td><td><a href="#atomic-critical-sections"><code>atomic-critical-sections</code></a></td></tr>
<tr><td>Rust</td><td>Use <code>debug_assert</code> for correctness-only checks</td><td><a href="#debug-assert"><code>debug-assert</code></a></td></tr>
<tr><td>Rust</td><td>Propagate errors with <code>?</code></td><td><a href="#propagate-errors"><code>propagate-errors</code></a></td></tr>
<tr><td>Rust</td><td>Use <code>log</code> crate macros exclusively</td><td><a href="#log-crate-only"><code>log-crate-only</code></a></td></tr>
<tr><td>Rust</td><td>Choose appropriate log levels</td><td><a href="#log-levels"><code>log-levels</code></a></td></tr>
<tr><td>Rust</td><td>Use RAII for all resource acquisition and release</td><td><a href="#raii"><code>raii</code></a></td></tr>
<tr><td>Rust</td><td>Avoid O(n) algorithms on hot paths</td><td><a href="#no-linear-hot-paths"><code>no-linear-hot-paths</code></a></td></tr>
<tr><td>Rust</td><td>Minimize unnecessary copies and allocations</td><td><a href="#minimize-copies"><code>minimize-copies</code></a></td></tr>
<tr><td>Rust</td><td>No premature optimization without evidence</td><td><a href="#no-premature-optimization"><code>no-premature-optimization</code></a></td></tr>
<tr><td>Git</td><td>Write imperative, descriptive subject lines</td><td><a href="#imperative-subject"><code>imperative-subject</code></a></td></tr>
<tr><td>Git</td><td>One logical change per commit</td><td><a href="#atomic-commits"><code>atomic-commits</code></a></td></tr>
<tr><td>Git</td><td>Separate refactoring from features</td><td><a href="#refactor-then-feature"><code>refactor-then-feature</code></a></td></tr>
<tr><td>Git</td><td>Keep pull requests focused</td><td><a href="#focused-prs"><code>focused-prs</code></a></td></tr>
<tr><td>Testing</td><td>Add regression tests for every bug fix</td><td><a href="#add-regression-tests"><code>add-regression-tests</code></a></td></tr>
<tr><td>Testing</td><td>Test user-visible behavior, not internals</td><td><a href="#test-visible-behavior"><code>test-visible-behavior</code></a></td></tr>
<tr><td>Testing</td><td>Use assertion macros, not manual inspection</td><td><a href="#use-assertions"><code>use-assertions</code></a></td></tr>
<tr><td>Testing</td><td>Clean up resources after every test</td><td><a href="#test-cleanup"><code>test-cleanup</code></a></td></tr>
<tr><td>Assembly</td><td>Use the correct section directive</td><td><a href="#asm-section-directives"><code>asm-section-directives</code></a></td></tr>
<tr><td>Assembly</td><td>Place code-width directives after the section definition</td><td><a href="#asm-code-width"><code>asm-code-width</code></a></td></tr>
<tr><td>Assembly</td><td>Place attributes directly before the function</td><td><a href="#asm-function-attributes"><code>asm-function-attributes</code></a></td></tr>
<tr><td>Assembly</td><td>Add <code>.type</code> and <code>.size</code> for Rust-callable functions</td><td><a href="#asm-type-and-size"><code>asm-type-and-size</code></a></td></tr>
<tr><td>Assembly</td><td>Use unique label prefixes to avoid name clashes</td><td><a href="#asm-label-prefixes"><code>asm-label-prefixes</code></a></td></tr>
<tr><td>Assembly</td><td>Prefer <code>.balign</code> over <code>.align</code></td><td><a href="#asm-prefer-balign"><code>asm-prefer-balign</code></a></td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-guidelines-are-written"><a class="header" href="#how-guidelines-are-written">How Guidelines Are Written</a></h1>
<p>The guidelines in this collection reflect
a set of widely-recognized <strong>philosophy</strong> and <strong>principles</strong>
for writing high-quality software.
Three books have influenced the guidelines the most:</p>
<ol>
<li><a href="https://www.oreilly.com/library/view/the-art-of/9781449318482/"><em>The Art of Readable Code</em></a></li>
<li><a href="https://www.oreilly.com/library/view/clean-code-a/9780136083238/"><em>Clean Code</em></a></li>
<li><a href="https://stevemcconnell.com/books/"><em>Code Complete</em></a></li>
</ol>
<p>The guidelines are derived from <strong>code review experience</strong>,
where we point out code smells, observe anti-patterns, and fix recurring bugs.
By the time the initial version of these guidelines was formulated,
Asterinas had seen thousands of code reviews.
We collected the historical review comments
as a <a href="https://github.com/asterinas/pr-review-analysis">dataset</a>
and used it as both inspiration and evidence.</p>
<p>The remainder of this page moves from values to practice.
The <a href="#philosophy">Philosophy</a> section captures foundational beliefs
about what makes code understandable and maintainable.
The <a href="#principles">Principles</a> section turns those beliefs
into design-level rules that guide everyday decisions.
Finally, the <a href="#quality-criteria">Quality Criteria</a> section defines
how individual guidelines are written and accepted
into this collection.</p>
<h2 id="philosophy"><a class="header" href="#philosophy">Philosophy</a></h2>
<h3 id="minimize-time-to-understand"><a class="header" href="#minimize-time-to-understand">Minimize time to understand</a></h3>
<p>Code should be written to minimize the time
it would take someone else to fully understand it.
This is the fundamental theorem of readability
and the single most important measure
of code quality in this project.
‚ÄúSomeone else‚Äù includes your future self.</p>
<p>Code is read far more often than it is written.
If a technique makes code shorter
but harder to follow at a glance,
choose clarity over brevity.</p>
<h3 id="managing-complexity"><a class="header" href="#managing-complexity">Managing complexity is the primary technical imperative</a></h3>
<p>No one can hold an entire modern program in their head.
The purpose of every technique in software construction ‚Äî
decomposition, naming, encapsulation, abstraction ‚Äî
is to break complex problems into simple pieces
so that you can safely focus on one thing at a time.</p>
<h3 id="craftsmanship"><a class="header" href="#craftsmanship">Craftsmanship and care</a></h3>
<p>Clean code looks like it was written by someone who cares.
Professionalism means never knowingly leaving a mess.
The only way to go fast is to keep the code clean at all times.</p>
<h3 id="continuous-improvement"><a class="header" href="#continuous-improvement">Continuous improvement</a></h3>
<p>Leave code cleaner than you found it.
Small, steady improvements ‚Äî
renaming a variable, extracting a function,
eliminating duplication ‚Äî
prevent code from rotting over time.</p>
<h2 id="principles"><a class="header" href="#principles">Principles</a></h2>
<h3 id="single-responsibility"><a class="header" href="#single-responsibility">Single Responsibility</a></h3>
<p>Each module, type, or function
should have one, and only one, reason to change.
If you cannot describe what a unit does
without the words ‚Äúand,‚Äù ‚Äúor,‚Äù or ‚Äúbut,‚Äù
it has too many responsibilities.</p>
<h3 id="dry"><a class="header" href="#dry">Don‚Äôt Repeat Yourself (DRY)</a></h3>
<p>Every piece of knowledge
should have a single, unambiguous representation.
Duplication harms readability and maintainability.
When the same pattern appears three or more times,
eliminate the duplication (e.g., adding a helper function).</p>
<h3 id="information-hiding"><a class="header" href="#information-hiding">Information Hiding</a></h3>
<p>Hide design decisions behind well-defined interfaces.
A module‚Äôs public surface should contain
only what its consumers need.
Internal data structures, helper types,
and bookkeeping fields should remain private.</p>
<h3 id="open-closed"><a class="header" href="#open-closed">Open for Extension, Closed for Modification</a></h3>
<p>Stable modules and APIs should be
open to extension
but closed to breaking modification.
Prefer adding new behavior
through existing interfaces
(traits, enums, and pluggable components)
instead of repeatedly editing established call paths.
Do not introduce extension points preemptively;
add them when there is a concrete extension need.</p>
<h3 id="least-surprise"><a class="header" href="#least-surprise">Least Surprise</a></h3>
<p>Functions, types, and APIs should behave
as their names and signatures suggest.
When an obvious behavior is not implemented,
readers lose trust in the codebase
and must fall back on reading implementation details.</p>
<h3 id="coupling-cohesion"><a class="header" href="#coupling-cohesion">Loose Coupling, Strong Cohesion</a></h3>
<p>Connections between modules should be
small, visible, and flexible.
Within a module, every part should contribute
to a single, well-defined purpose.</p>
<h3 id="consistency"><a class="header" href="#consistency">Consistency</a></h3>
<p>Do similar things the same way throughout the codebase.
Consistency reduces surprise and cognitive load
even when neither approach is objectively superior.
When a convention already exists, follow it;
do not introduce a competing convention
without compelling justification.</p>
<h3 id="test-as-specification"><a class="header" href="#test-as-specification">Test as the Source of Confidence</a></h3>
<p>Tests exist to make change safe.
A comprehensive test suite should give developers confidence
that a passing run means the system works
and a failing run pinpoints what broke.
Every test must earn its place
by increasing that confidence.
A test that does not ‚Äî
flaky tests, tautological assertions,
tests coupled to implementation details ‚Äî
is worse than no test at all.</p>
<h3 id="rust-native"><a class="header" href="#rust-native">Rust-Native Approach</a></h3>
<p>Asterinas is inspired by Linux but is not a C port.
The language shapes how we think about problems:
where C code relies on conventions and manual discipline
(return-code checking, paired init/cleanup, header-file contracts),
Rust offers compiler-enforced, zero-cost abstractions
(the <code>?</code> operator, RAII, trait bounds).</p>
<p>Learn from Linux‚Äôs design, not its idioms.
The result should read like idiomatic Rust,
not like C written in Rust syntax.</p>
<h2 id="quality-criteria"><a class="header" href="#quality-criteria">Quality Criteria</a></h2>
<p>Every guideline carries a <strong>descriptive short name</strong> in kebab-case
(e.g., <code>explain-variables</code>, <code>lock-ordering</code>).
Short names are kept <strong>intact</strong> even as the guidelines evolve
and should be used when referencing guidelines in code reviews.</p>
<p>A guideline is accepted into this collection
when it satisfies all four quality criteria:</p>
<ol>
<li><strong>Concrete</strong> ‚Äî
Framed as an actionable item with an illustrating example when possible.</li>
<li><strong>Concise</strong> ‚Äî
Kept short; we do not want to intimidate readers.</li>
<li><strong>Grounded</strong> ‚Äî
Opinionated or non-obvious guidelines should include a ‚ÄúSee also‚Äù line
with supportive materials (literature, PR reviews, codebase examples).</li>
<li><strong>Relevant</strong> ‚Äî
Included only if it has codebase examples,
prevents a past bug,
or matches anti-patterns observed in code reviews.</li>
</ol>
<p>When present, the <strong>‚ÄúSee also‚Äù line</strong> lists sources in the order:
literature; PR reviews; codebase examples.
Not every guideline needs all three;
for strongly opinionated or non-obvious guidelines,
include the line by default.</p>
<p>Do not add a guideline whose only value
is mechanical enforcement already provided by automated tools
such as <a href="https://github.com/rust-lang/rustfmt">rustfmt</a> and <a href="https://github.com/rust-lang/rust-clippy">clippy</a>.
If a tool-enforced convention appears frequently in review
or needs project-specific rationale,
keep a short explanatory guideline and point to the tool configuration.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<p>Below is a sample guideline demonstrating these conventions:</p>
<pre><code class="language-md">### Introduce explaining variables (`explain-variables`) {#explain-variables}

Break down complex expressions
by assigning intermediate results to well-named variables.
An explaining variable turns an opaque expression
into self-documenting code:

```rust
// Good ‚Äî intent is clear
let is_page_aligned = addr % PAGE_SIZE == 0;
let is_within_range = addr &lt; max_addr;
debug_assert!(is_page_aligned &amp;&amp; is_within_range);

// Bad ‚Äî reader must parse the whole expression
debug_assert!(addr % PAGE_SIZE == 0 &amp;&amp; addr &lt; max_addr);
```

See also:
_The Art of Readable Code_, Chapter 8 "Breaking Down Giant Expressions";
PR [#2083](https://github.com/asterinas/asterinas/pull/2083#discussion_r2512772091)
and [#643](https://github.com/asterinas/asterinas/pull/643#discussion_r1497243812).
</code></pre>
<p>This example demonstrates:</p>
<ul>
<li>A stable short name (<code>explain-variables</code>) shown parenthetically and used as the heading anchor</li>
<li>A one-sentence actionable recommendation followed by a code example</li>
<li>A ‚ÄúSee also‚Äù line ordered as: literature, PR reviews, codebase examples</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="general-guidelines"><a class="header" href="#general-guidelines">General Guidelines</a></h1>
<h2 id="names"><a class="header" href="#names">Names</a></h2>
<h3 id="descriptive-names"><a class="header" href="#descriptive-names">Be descriptive (<code>descriptive-names</code>)</a></h3>
<p>Choose names that convey meaning at the point of use.
Avoid single-letter names and ambiguous abbreviations.
Prefer full words over cryptic shorthand
so that readers do not need surrounding context
to understand a variable‚Äôs purpose.
Prefer names that are as short as possible
while still being unambiguous at the point of use.</p>
<h3 id="accurate-names"><a class="header" href="#accurate-names">Be accurate (<code>accurate-names</code>)</a></h3>
<p>Avoid confusing names.
If a name can be misread
to imply the wrong meaning, behavior, or side effects,
it must be corrected immediately.</p>
<pre><code class="language-rust">// Good ‚Äî clearly a count
nr_deleted_watches: usize,
// Bad ‚Äî looks like a collection
// rather than a numeric counter
deleted_watches: usize</code></pre>
<p>Choose verbs that reflect the actual work being done.</p>
<pre><code class="language-rust">impl PciCommonDevice {
    // Good ‚Äî implies a MMIO read is involved
    pub fn read_command(&amp;self) -&gt; Command { /* .. */ }
    // Bad ‚Äî looks like a plain field access
    pub fn command(&amp;self) -&gt; Command { /* .. */ }
}</code></pre>
<pre><code class="language-rust">mod char_device {
    // Good ‚Äî implies an O(n) collection pass
    pub fn collect_all() -&gt; Vec&lt;Arc&lt;dyn Device&gt;&gt; { /* .. */ }
    // Bad ‚Äî sounds like an accessor returning a reference
    pub fn get_all() -&gt; Vec&lt;Arc&lt;dyn Device&gt;&gt; { /* .. */ }
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/1488#discussion_r1825441287">#1488</a>
and <a href="https://github.com/asterinas/asterinas/pull/2964#discussion_r2789739882">#2964</a>.</p>
<h3 id="encode-units"><a class="header" href="#encode-units">Encode units and important attributes in names (<code>encode-units</code>)</a></h3>
<p>When the type does not encode the unit,
the name must.
Kernel code deals with bytes, pages, frames,
nanoseconds, ticks, and sectors ‚Äî
ambiguous units are a source of real bugs.</p>
<pre><code class="language-text">// Good ‚Äî unit is unambiguous
timeout_ns
offset_bytes
size_pages
delay_ms

// Bad ‚Äî unit is ambiguous
timeout
offset
size
delay
</code></pre>
<p>Where the language‚Äôs type system can enforce units (e.g., newtypes),
prefer that.
Where it cannot, the name must carry the information.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2796#discussion_r2646889913">#2796</a>.</p>
<h3 id="bool-names"><a class="header" href="#bool-names">Use assertion-style boolean names (<code>bool-names</code>)</a></h3>
<p>Boolean variables and functions
should read as assertions of fact.
Use <code>is_</code>, <code>has_</code>, <code>can_</code>, <code>should_</code>, <code>was_</code>,
or <code>needs_</code> prefixes.
Never use negated names
(<code>is_not_empty</code>, <code>no_error</code>);
prefer the positive form
(<code>is_empty</code>, <code>ok</code> or <code>succeeded</code>).
A bare name like <code>found</code>, <code>done</code>, or <code>ready</code>
is acceptable when the context is unambiguous.</p>
<pre><code class="language-rust">// Good ‚Äî reads as an assertion
fn is_page_aligned(&amp;self) -&gt; bool { ... }
fn has_permission(&amp;self, perm: Permission) -&gt; bool { ... }
let can_read = mode.is_readable();

// Bad ‚Äî verb suggests an action, not a query
fn check_permission(&amp;self, perm: Permission) -&gt; bool { ... }
// Bad ‚Äî negated name
let is_not_empty = !buf.is_empty();</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/1488#discussion_r1841827039">#1488</a>.</p>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<h3 id="semantic-line-breaks"><a class="header" href="#semantic-line-breaks">Prefer semantic line breaks (<code>semantic-line-breaks</code>)</a></h3>
<p>For prose in Markdown and doc comments,
insert line breaks at semantic boundaries
so each line carries one coherent idea.
At minimum, break at sentence boundaries.
For longer sentences, also consider breaking at clause boundaries.</p>
<p>Semantic line breaks make diffs smaller,
reviews easier,
and merge conflicts less noisy.</p>
<p>As an exception,
RFC documents that are mostly read-only
can use regular paragraph wrapping.</p>
<p>See also:
<a href="https://sembr.org/">Semantic Line Breaks</a>.</p>
<h3 id="explain-why"><a class="header" href="#explain-why">Explain why, not what (<code>explain-why</code>)</a></h3>
<p>Comments should explain the intent behind the code,
not restate what the code does.
If a comment merely paraphrases the code,
it adds noise without insight.</p>
<p>If a comment is needed to explain what code does,
first try to rewrite the code.
Do not write good comments to compensate for bad code ‚Äî
rewrite it to be straightforward.</p>
<p>See also:
<em>The Art of Readable Code</em>, Chapter 6 ‚ÄúKnowing What to Comment‚Äù;
PR <a href="https://github.com/asterinas/asterinas/pull/2265#discussion_r2266220943">#2265</a>
and <a href="https://github.com/asterinas/asterinas/pull/2050#discussion_r2224106025">#2050</a>.</p>
<h3 id="design-decisions"><a class="header" href="#design-decisions">Document design decisions (<code>design-decisions</code>)</a></h3>
<p>When the code makes a non-obvious choice ‚Äî
a particular data structure, a locking strategy,
a deviation from Linux behavior ‚Äî
add a comment explaining the rationale
and any alternatives considered.
Design-decision comments (‚Äúdirector‚Äôs commentary‚Äù)
are the most valuable kind of comment.</p>
<pre><code class="language-rust">// We use a radix tree rather than a HashMap
// because lookups must be O(log n) worst-case
// for the page fault handler.
// A HashMap gives O(1) amortized
// but O(n) worst-case due to rehashing,
// which is unacceptable on the page fault path.</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2265#discussion_r2266220943">#2265</a>
and <a href="https://github.com/asterinas/asterinas/pull/2050#discussion_r2224106025">#2050</a>.</p>
<h3 id="cite-sources"><a class="header" href="#cite-sources">Cite specifications and algorithm sources (<code>cite-sources</code>)</a></h3>
<p>When implementing behavior defined by
an external specification or a non-trivial algorithm,
cite the source:
the relevant POSIX section, Linux man page,
hardware reference manual, or academic paper.</p>
<pre><code class="language-rust">/// Maximum number of bytes guaranteed to be written to a pipe atomically.
///
/// For more details, see the description of `PIPE_BUF` in
/// &lt;https://man7.org/linux/man-pages/man7/pipe.7.html&gt;.
const PIPE_BUF: usize = 4096;</code></pre>
<h2 id="layout"><a class="header" href="#layout">Layout</a></h2>
<h3 id="one-concept-per-file"><a class="header" href="#one-concept-per-file">One concept per file (<code>one-concept-per-file</code>)</a></h3>
<p>When a file grows long or contains multiple distinct concepts,
split it.
Each major data structure, each subsystem entry point,
each significant abstraction
deserves its own file.</p>
<h3 id="top-down-reading"><a class="header" href="#top-down-reading">Organize code for top-down reading (<code>top-down-reading</code>)</a></h3>
<p>A source file should read from top to bottom.
Start with high-level entry points and core flow.
Move implementation details downward
so readers can understand the big picture first
before diving into low-level helpers.</p>
<p>Within each visibility group (e.g., a module),
order methods so that callers appear before callees where possible,
enabling the file to be read top to bottom.
Place public methods before private helpers.</p>
<h3 id="logical-paragraphs"><a class="header" href="#logical-paragraphs">Group statements into logical paragraphs (<code>logical-paragraphs</code>)</a></h3>
<p>Within functions,
group related statements into logical paragraphs
separated by blank lines.
Each paragraph should represent one sub-step
of the function‚Äôs overall purpose.</p>
<p>For long functions,
add a one-line summary comment
at the start of each paragraph
when the paragraph intent is not obvious.</p>
<h2 id="formatting"><a class="header" href="#formatting">Formatting</a></h2>
<h3 id="error-message-format"><a class="header" href="#error-message-format">Format error messages consistently (<code>error-message-format</code>)</a></h3>
<p>Start with a lowercase letter
(unless the first word is a proper noun or identifier).
Be specific:
prefer ‚Äú<code>len</code> is too large‚Äù over ‚Äúthe argument is invalid‚Äù.</p>
<p>For system call errors,
follow the style and descriptions in Linux man pages.</p>
<h2 id="api-design"><a class="header" href="#api-design">API Design</a></h2>
<h3 id="familiar-conventions"><a class="header" href="#familiar-conventions">Stick to familiar conventions (<code>familiar-conventions</code>)</a></h3>
<p>Prefer names and API shapes
that users already know from Rust and Linux.
Do not invent new terms
for well-known operations.</p>
<pre><code class="language-rust">// Good ‚Äî follows common Rust naming conventions
pub fn len(&amp;self) -&gt; usize { ... }
pub fn as_ptr(&amp;self) -&gt; *const u8 { ... }

// Bad ‚Äî unfamiliar synonyms for common operations
pub fn length(&amp;self) -&gt; usize { ... }
pub fn to_pointer(&amp;self) -&gt; *const u8 { ... }</code></pre>
<p>See also:
<a href="#least-surprise">Least Surprise</a>.</p>
<h3 id="hide-impl-details"><a class="header" href="#hide-impl-details">Hide implementation details (<code>hide-impl-details</code>)</a></h3>
<p>Do not expose internal implementation details
through public APIs (including their documentation).
A module‚Äôs public surface
should contain only what its consumers need.</p>
<p>See also:
<a href="#narrow-visibility">Modules and Crates</a>
for Rust-specific visibility rules;
PR <a href="https://github.com/asterinas/asterinas/pull/2951#discussion_r2786925410">#2951</a>.</p>
<h3 id="validate-at-boundaries"><a class="header" href="#validate-at-boundaries">Validate at boundaries, trust internally (<code>validate-at-boundaries</code>)</a></h3>
<p>Designate certain interfaces as validation boundaries.
In Asterinas, syscall entry points
are the primary boundary:
all user-supplied data
(pointers, file descriptors, sizes, flags, strings)
must be validated at the syscall boundary.
Once validated, internal kernel functions
may trust these values without re-validation.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2806">#2806</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rust-guidelines"><a class="header" href="#rust-guidelines">Rust Guidelines</a></h1>
<p>Asterinas follows the
<a href="https://rust-lang.github.io/api-guidelines/">Rust API Guidelines</a>
and the project-specific conventions below.</p>
<ul>
<li><strong><a href="#naming">Naming</a></strong> ‚Äî
CamelCase/acronym style
and closure variable suffixes.</li>
<li><strong><a href="#language-items">Language Items</a></strong>
<ul>
<li><strong><a href="#variables-expressions-and-statements">Variables, Expressions, and Statements</a></strong> ‚Äî
Explaining variables,
block expressions,
and checked arithmetic.</li>
<li><strong><a href="#functions-and-methods">Functions and Methods</a></strong> ‚Äî
Nesting control,
function focus,
and boolean-argument avoidance.</li>
<li><strong><a href="#types-and-traits">Types and Traits</a></strong> ‚Äî
Type-level invariants,
enums for closed sets,
and field encapsulation.</li>
<li><strong><a href="#comments-and-documentation">Comments and Documentation</a></strong> ‚Äî
RFC 1574 summaries,
comment/doc style,
and module docs.</li>
<li><strong><a href="#unsafety">Unsafety</a></strong> ‚Äî
<code>// SAFETY:</code> justification,
<code># Safety</code> docs,
and module-boundary reasoning.</li>
<li><strong><a href="#modules-and-crates">Modules and Crates</a></strong> ‚Äî
Visibility control
and workspace dependencies.</li>
<li><strong><a href="#macros-and-attributes">Macros and Attributes</a></strong> ‚Äî
Narrow lint suppression,
<code>#[expect(dead_code)]</code> policy,
and macro restraint.</li>
</ul>
</li>
<li><strong><a href="#select-topics">Select Topics</a></strong>
<ul>
<li><strong><a href="#concurrency-and-races">Concurrency and Races</a></strong> ‚Äî
Lock ordering,
spinlock discipline,
atomics,
and critical sections.</li>
<li><strong><a href="#defensive-programming">Defensive Programming</a></strong> ‚Äî
Correct use of <code>debug_assert!</code>.</li>
<li><strong><a href="#error-handling">Error Handling</a></strong> ‚Äî
Error propagation with <code>?</code>.</li>
<li><strong><a href="#logging">Logging</a></strong> ‚Äî
Standard logging macros and log-level selection.</li>
<li><strong><a href="#memory-and-resource-management">Memory and Resource Management</a></strong> ‚Äî
RAII and cleanup by ownership.</li>
<li><strong><a href="#performance">Performance</a></strong> ‚Äî
Hot-path complexity,
copy/allocation control,
and evidence-based optimization.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="naming"><a class="header" href="#naming">Naming</a></h1>
<p>Asterinas enforces strict, Rust-idiomatic naming
across the entire codebase.
Names must be accurate, unabbreviated,
and follow
<a href="https://rust-lang.github.io/api-guidelines/naming.html">Rust API Guidelines on naming</a>.</p>
<h3 id="camel-case-acronyms"><a class="header" href="#camel-case-acronyms">Follow Rust CamelCase and acronym capitalization (<code>camel-case-acronyms</code>)</a></h3>
<p>Type names follow Rust‚Äôs CamelCase convention.
Acronyms are title-cased per the Rust API Guidelines:</p>
<pre><code class="language-rust">// Good
IoMemoryArea
PciDeviceLocation
Nvme
Tcp

// Bad
IOMemoryArea
PCIDeviceLocation
NVMe
TCP</code></pre>
<h3 id="closure-fn-suffix"><a class="header" href="#closure-fn-suffix">End closure variables with <code>_fn</code> (<code>closure-fn-suffix</code>)</a></h3>
<p>Variables holding closures or function pointers
must signal they are callable by ending with <code>_fn</code>.
Treating a closure variable
as if it were a data object misleads readers.</p>
<pre><code class="language-rust">// Good ‚Äî clearly a callable
let task_fn = self.func.take().unwrap();
let thread_fn = move || {
    let _ = oops::catch_panics_as_oops(task_fn);
    current_thread!().exit();
};

let expired_fn = move |_guard: TimerGuard| {
    ticks.fetch_add(1, Ordering::Relaxed);
    pollee.notify(IoEvents::IN);
};</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/395#discussion_r1402964415">#395</a>
and <a href="https://github.com/asterinas/asterinas/pull/783#discussion_r1593335375">#783</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="language-items"><a class="header" href="#language-items">Language Items</a></h1>
<p>This section covers conventions
for specific Rust language constructs.
Each page addresses one category
with actionable guidelines.</p>
<ul>
<li><strong><a href="#variables-expressions-and-statements">Variables, Expressions, and Statements</a></strong> ‚Äî
Explaining variables,
block expressions,
and checked arithmetic.</li>
<li><strong><a href="#functions-and-methods">Functions and Methods</a></strong> ‚Äî
Nesting control,
function focus,
and boolean-argument avoidance.</li>
<li><strong><a href="#types-and-traits">Types and Traits</a></strong> ‚Äî
Type-level invariants,
closed-set modeling,
and field encapsulation.</li>
<li><strong><a href="#comments-and-documentation">Comments and Documentation</a></strong> ‚Äî
Rustdoc conventions,
punctuation/readability,
and module docs.</li>
<li><strong><a href="#unsafety">Unsafety</a></strong> ‚Äî
<code>// SAFETY:</code> comments,
<code># Safety</code> sections,
and module-boundary audits.</li>
<li><strong><a href="#modules-and-crates">Modules and Crates</a></strong> ‚Äî
Visibility
and dependency policy.</li>
<li><strong><a href="#macros-and-attributes">Macros and Attributes</a></strong> ‚Äî
Lint suppression scope,
dead-code expectations,
and macro restraint.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="variables-expressions-and-statements"><a class="header" href="#variables-expressions-and-statements">Variables, Expressions, and Statements</a></h1>
<h3 id="explain-variables"><a class="header" href="#explain-variables">Introduce explaining variables (<code>explain-variables</code>)</a></h3>
<p>Break down complex expressions
by assigning intermediate results to well-named variables.
An explaining variable turns an opaque expression
into self-documenting code:</p>
<pre><code class="language-rust">// Good ‚Äî intent is clear
let is_page_aligned = addr % PAGE_SIZE == 0;
let is_within_range = addr &lt; max_addr;
debug_assert!(is_page_aligned &amp;&amp; is_within_range);

// Bad ‚Äî reader must parse the whole expression
debug_assert!(addr % PAGE_SIZE == 0 &amp;&amp; addr &lt; max_addr);</code></pre>
<p>See also:
<em>The Art of Readable Code</em>, Chapter 8 ‚ÄúBreaking Down Giant Expressions‚Äù;
PR <a href="https://github.com/asterinas/asterinas/pull/2083#discussion_r2512772091">#2083</a>
and <a href="https://github.com/asterinas/asterinas/pull/643#discussion_r1497243812">#643</a>.</p>
<h3 id="block-expressions"><a class="header" href="#block-expressions">Use block expressions to scope temporary state (<code>block-expressions</code>)</a></h3>
<p>Use block expressions
when temporary variables are only needed
to produce one final value.
This keeps temporary state local
and avoids leaking one-off names into outer scope.</p>
<pre><code class="language-rust">// Good ‚Äî intermediate values are scoped to the block
let socket_addr = {
    let bytes = read_bytes_from_user(addr, len as usize)?;
    parse_socket_addr(&amp;bytes)?
};
connect(socket_addr)?;

// Bad ‚Äî temporary variables leak into outer scope
let bytes = read_bytes_from_user(addr, len as usize)?;
let socket_addr = parse_socket_addr(&amp;bytes)?;
connect(socket_addr)?;</code></pre>
<h3 id="checked-arithmetic"><a class="header" href="#checked-arithmetic">Use checked or saturating arithmetic (<code>checked-arithmetic</code>)</a></h3>
<p>Use checked or saturating arithmetic
for operations that could overflow.
Prefer explicit overflow handling
over silent wrapping:</p>
<pre><code class="language-rust">// Good ‚Äî overflow is handled explicitly
let total = base.checked_add(offset)
    .ok_or(Error::new(Errno::EOVERFLOW))?;

// Good ‚Äî clamps instead of wrapping
let remaining = budget.saturating_sub(cost);

// Bad ‚Äî may silently wrap in release builds
let total = base + offset;</code></pre>
<p>If wraparound behavior is intentional,
use explicit <code>wrapping_*</code> or <code>overflowing_*</code> operations
and document why wrapping is correct.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="functions-and-methods"><a class="header" href="#functions-and-methods">Functions and Methods</a></h1>
<h3 id="minimize-nesting"><a class="header" href="#minimize-nesting">Minimize nesting (<code>minimize-nesting</code>)</a></h3>
<p>Minimize nesting depth.
Code nested more than three levels deep
should be reviewed for refactoring opportunities.
Each nesting level multiplies the reader‚Äôs cognitive load.</p>
<p>Techniques for flattening nesting:</p>
<ul>
<li>Early returns and guard clauses for error paths.</li>
<li><code>let...else</code> to collapse <code>if let</code> chains.</li>
<li>The <code>?</code> operator for error propagation.</li>
<li><code>continue</code> to skip loop iterations.</li>
<li>Extracting the nested body into a helper function.</li>
</ul>
<p>The normal/expected code path
should be the first visible path;
error and edge cases
should be handled and dismissed early.</p>
<pre><code class="language-rust">pub(crate) fn init() {
    let Some(framebuffer_arg) = boot_info().framebuffer_arg else {
        log::warn!("Framebuffer not found");
        return;
    };
    // ... main logic at the top level
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2877#discussion_r2685861741">#2877</a>.</p>
<h3 id="small-functions"><a class="header" href="#small-functions">Keep functions small and focused (<code>small-functions</code>)</a></h3>
<p>Each function should do one thing,
do it well, and do it only.
If you can extract another function from it
with a name that is not merely a restatement
of its implementation,
the original function is doing more than one thing.</p>
<p>Do not mix levels of abstraction.
For example, a syscall handler should read like a specification;
byte-level manipulation belongs in a helper.</p>
<pre><code class="language-rust">// Good ‚Äî each function operates at one level of abstraction
pub fn sys_connect(sockfd: i32, addr: Vaddr, len: u32) -&gt; Result&lt;()&gt; {
    let socket = get_socket(sockfd)?;
    let remote_addr = parse_socket_addr(addr, len)?;
    socket.connect(remote_addr)
}

// Bad ‚Äî mixes high-level logic with low-level details
pub fn sys_connect(sockfd: i32, addr: Vaddr, len: u32) -&gt; Result&lt;()&gt; {
    let fd_table = current_process().fd_table().lock();
    let file = fd_table.get(sockfd).ok_or(Errno::EBADF)?;
    let socket = file.downcast_ref::&lt;Socket&gt;().ok_or(Errno::ENOTSOCK)?;
    let bytes = read_bytes_from_user(addr, len as usize)?;
    let family = u16::from_ne_bytes([bytes[0], bytes[1]]);
    // ... 30 more lines of byte parsing ...
}</code></pre>
<p>See also:
<em>Clean Code</em>, Chapter 3 ‚ÄúFunctions‚Äù;
PR <a href="https://github.com/asterinas/asterinas/pull/639#discussion_r1524629393">#639</a>.</p>
<h3 id="no-bool-args"><a class="header" href="#no-bool-args">Avoid boolean arguments (<code>no-bool-args</code>)</a></h3>
<p>A boolean parameter that selects between
two behaviors signals the function does two things.
Split it into two functions
or use a typed enum.</p>
<pre><code class="language-rust">// Good ‚Äî two separate functions
fn read(&amp;self, buf: &amp;mut [u8]) -&gt; Result&lt;usize&gt; { ... }
fn read_nonblocking(&amp;self, buf: &amp;mut [u8]) -&gt; Result&lt;usize&gt; { ... }

// Good ‚Äî typed enum
enum ReadMode { Blocking, NonBlocking }
fn read(&amp;self, buf: &amp;mut [u8], mode: ReadMode) -&gt; Result&lt;usize&gt; { ... }

// Bad ‚Äî boolean argument
fn read(&amp;self, buf: &amp;mut [u8], blocking: bool) -&gt; Result&lt;usize&gt; { ... }</code></pre>
<p>See also:
<em>Clean Code</em>, Chapter 3 ‚ÄúFlag Arguments‚Äù.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="types-and-traits"><a class="header" href="#types-and-traits">Types and Traits</a></h1>
<h3 id="rust-type-invariants"><a class="header" href="#rust-type-invariants">Use types to enforce invariants (<code>rust-type-invariants</code>)</a></h3>
<p>Leverage the type system
to make illegal states <em>unrepresentable</em>.</p>
<p>Define newtypes to encode domain constraints.</p>
<pre><code class="language-rust">// Good ‚Äî a `Nice` value is guaranteed to be valid
pub struct Nice(NiceValue);
type NiceValue = RangedI8&lt;-20, 19&gt;;

// Bad ‚Äî `i8` admits invalid values for nice levels
pub type Nice = i8;</code></pre>
<p>Prefer enums over bare integers and boolean flags.</p>
<pre><code class="language-rust">// Good ‚Äî access mode is constrained by the enum
#[derive(Clone, Copy, Debug, PartialEq, Eq)]
pub enum AccessMode {
    O_RDONLY = 0,
    O_WRONLY = 1,
    O_RDWR = 2,
}

// Bad ‚Äî `u8` admits invalid values
pub type AccessMode = u8;</code></pre>
<p>Encode invariants in generic parameters where needed.</p>
<pre><code class="language-rust">impl IoMem&lt;Sensitive&gt; {
    // Good ‚Äî only unsafe code can write to sensitive MMIO
    pub unsafe fn write_u32(&amp;self, offset: usize, new_val: u32) { /* .. */ }
}

impl IoMem&lt;Insensitive&gt; {
    // Good ‚Äî safe code can write to insensitive MMIO
    pub fn write_u32(&amp;self, offset: usize, new_val: u32) { /* .. */ }
}

pub enum Sensitive {}
pub enum Insensitive {}</code></pre>
<p>Asterinas uses this pattern widely,
for example with newtypes such as <code>CpuId</code>
and <code>AlignedUsize&lt;const N: u16&gt;</code>.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2265#discussion_r2266214191">#2265</a>
and <a href="https://github.com/asterinas/asterinas/pull/2514">#2514</a>.</p>
<h3 id="enum-over-dyn"><a class="header" href="#enum-over-dyn">Prefer enum over trait objects for closed sets (<code>enum-over-dyn</code>)</a></h3>
<p>When the set of variants is known and closed,
an enum is often preferable to <code>Box&lt;dyn Trait&gt;</code>
for both performance and pattern-matching expressiveness.</p>
<pre><code class="language-rust">// Good ‚Äî closed set modeled as an enum
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum TermStatus {
    Exited(u8),
    Killed(SigNum),
}</code></pre>
<h3 id="getter-encapsulation"><a class="header" href="#getter-encapsulation">Encapsulate fields behind getters (<code>getter-encapsulation</code>)</a></h3>
<p>Do not make fields public
when a simple getter method would do.
A getter preserves naming flexibility
and leaves room for future invariants.</p>
<pre><code class="language-rust">// Good ‚Äî field is private, accessed via getter
pub struct Vma {
    perms: VmPerms,
}

impl Vma {
    pub fn perms(&amp;self) -&gt; VmPerms {
        self.perms
    }
}

// Bad ‚Äî public field exposes representation
pub struct Vma {
    pub perms: VmPerms,
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="comments-and-documentation"><a class="header" href="#comments-and-documentation">Comments and Documentation</a></h1>
<p>API documentation describes API meaning and usage
and is rendered by rustdoc.
Public APIs should be documented,
including crates, modules, structs, traits, functions, and macros.
The <code>#![warn(missing_docs)]</code> lint helps enforce this baseline.</p>
<p>Asterinas follows Rust community documentation conventions.
Two primary references are:</p>
<ol>
<li>The rustdoc book:
<a href="https://doc.rust-lang.org/rustdoc/how-to-write-documentation.html">How to write documentation</a></li>
<li>The Rust RFC book:
<a href="https://rust-lang.github.io/rfcs/1574-more-api-documentation-conventions.html#appendix-a-full-conventions-text">API Documentation Conventions</a></li>
</ol>
<h3 id="rfc1574-summary"><a class="header" href="#rfc1574-summary">Follow RFC 1574 summary line conventions (<code>rfc1574-summary</code>)</a></h3>
<p>The first line of a doc comment should be
third-person singular present indicative
(‚ÄúReturns‚Äù, ‚ÄúCreates‚Äù, ‚ÄúAcquires‚Äù),
concise, and one sentence.</p>
<pre><code class="language-rust">/// Returns the mapping's start address.
pub fn map_to_addr(&amp;self) -&gt; Vaddr {
    self.map_to_addr
}</code></pre>
<h3 id="comment-punctuation"><a class="header" href="#comment-punctuation">End sentence comments with punctuation (<code>comment-punctuation</code>)</a></h3>
<p>If a comment line is a full sentence,
end it with proper punctuation.
This improves readability in dense code
and avoids fragmented prose.</p>
<pre><code class="language-rust">// Good ‚Äî complete sentence with punctuation.
// SAFETY: The pointer is derived from a live allocation.

// Bad ‚Äî complete sentence without punctuation
// SAFETY: The pointer is derived from a live allocation</code></pre>
<h3 id="backtick-identifiers"><a class="header" href="#backtick-identifiers">Wrap identifiers in backticks (<code>backtick-identifiers</code>)</a></h3>
<p>Type names, method names,
and code identifiers in doc comments
should be wrapped in backticks for rustdoc rendering.
When referring to types,
prefer rustdoc links (<code>[TypeName]</code>) where possible.</p>
<pre><code class="language-rust">/// Acquires the [`SpinLock`] and returns a guard
/// that releases the lock on [`Drop`].
///
/// Callers must not call `acquire` while holding
/// a [`RwMutex`] to avoid deadlock.
pub fn acquire(&amp;self) -&gt; SpinLockGuard&lt;'_, T&gt; { ... }</code></pre>
<h3 id="no-impl-in-docs"><a class="header" href="#no-impl-in-docs">Do not disclose implementation details in doc comments (<code>no-impl-in-docs</code>)</a></h3>
<p>Doc comments should describe <em>what</em> the API does
and <em>how to use it</em>,
not <em>how it is implemented internally</em>.</p>
<pre><code class="language-rust">// Good ‚Äî behavior-oriented
/// Returns the number of active connections.

// Bad ‚Äî leaks implementation details
/// Returns the length of the internal `HashMap`
/// that tracks connections by socket address.</code></pre>
<h3 id="module-docs"><a class="header" href="#module-docs">Add module-level documentation for major components (<code>module-docs</code>)</a></h3>
<p>A module file that serves as
an important kernel component
(e.g., subsystem entry point, major data structure, driver)
should begin with a <code>//!</code> comment explaining:</p>
<ol>
<li>What the module does</li>
<li>The key types it exposes</li>
<li>How it relates to neighboring modules</li>
</ol>
<pre><code class="language-rust">//! Virtual memory area (VMA) management.
//!
//! This module defines [`VmMapping`] and associated types,
//! which represent contiguous regions of a process's virtual address space.
//! VMAs are managed by the [`Vmar`] tree in the parent module.</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="unsafety"><a class="header" href="#unsafety">Unsafety</a></h1>
<h3 id="justify-unsafe-use"><a class="header" href="#justify-unsafe-use">Justify every use of <code>unsafe</code> (<code>justify-unsafe-use</code>)</a></h3>
<p>Every <code>unsafe</code> block must have a preceding <code>// SAFETY:</code> comment
that justifies why the operation is sound.
For multi-condition invariants,
use a numbered list:</p>
<pre><code class="language-rust">// SAFETY:
// 1. We have exclusive access to both the current context
//    and the next context (see above).
// 2. The next context is valid (because it is either
//    correctly initialized or written by a previous
//    `context_switch`).
unsafe {
    context_switch(next_task_ctx_ptr, current_task_ctx_ptr);
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2958">#2958</a>
and <a href="https://github.com/asterinas/asterinas/pull/836">#836</a>.</p>
<h3 id="document-safety-conds"><a class="header" href="#document-safety-conds">Document safety conditions (<code>document-safety-conds</code>)</a></h3>
<p>All <code>unsafe</code> functions and traits
must include a <code># Safety</code> section in their doc comments
describing the conditions, properties, or invariants that callers must uphold.
State exactly what the caller must guarantee ‚Äî
not implementation details or side effects.</p>
<pre><code class="language-rust">/// A marker trait for guard types that enforce the atomic mode.
///
/// # Safety
///
/// The implementer must ensure that the atomic mode is maintained while
/// the guard type is alive.
pub unsafe trait InAtomicMode: core::fmt::Debug {}</code></pre>
<h3 id="deny-unsafe-kernel"><a class="header" href="#deny-unsafe-kernel">Deny unsafe code in <code>kernel/</code> (<code>deny-unsafe-kernel</code>)</a></h3>
<p>All crates under <code>kernel/</code> must deny unsafe:</p>
<pre><code class="language-rust">#![deny(unsafe_code)]</code></pre>
<p>Only OSTD (<code>ostd/</code>) crates may contain <code>unsafe</code> code.
If a kernel crate requires an unsafe operation,
the functionality should be provided as a safe API in OSTD.</p>
<h3 id="module-boundary-safety"><a class="header" href="#module-boundary-safety">Reason about safety at the module boundary (<code>module-boundary-safety</code>)</a></h3>
<p>The safety of an <code>unsafe</code> block
depends on ALL code that can access the same private state.
Encapsulate unsafe abstractions
in the smallest possible module
to minimize the ‚Äúaudit surface.‚Äù
Any code in the same module
that can modify relied-upon fields
is part of the safety argument.</p>
<pre><code class="language-rust">// Good ‚Äî small, focused module limits the audit surface
mod frame_allocator {
    /// Invariant: `next` is always a valid frame index.
    struct FrameAlloc {
        next: usize,
        // ...
    }

    impl FrameAlloc {
        pub fn alloc(&amp;mut self) -&gt; PhysAddr {
            // SAFETY: `next` is always valid (see invariant above).
            // Only code in this module can modify `next`.
            unsafe { self.alloc_frame_unchecked(self.next) }
        }
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="modules-and-crates"><a class="header" href="#modules-and-crates">Modules and Crates</a></h1>
<h3 id="narrow-visibility"><a class="header" href="#narrow-visibility">Default to the narrowest visibility (<code>narrow-visibility</code>)</a></h3>
<p>Start private,
then widen to <code>pub(super)</code>, <code>pub(crate)</code>, or <code>pub</code>
only when an actual external consumer requires it.</p>
<pre><code class="language-rust">// Good ‚Äî restricted to the parent module
pub(super) static I8042_CONTROLLER:
    Once&lt;SpinLock&lt;I8042Controller, LocalIrqDisabled&gt;&gt; = Once::new();

pub(super) fn init() -&gt; Result&lt;(), I8042ControllerError&gt; {
    // ...
}

// Bad ‚Äî unnecessarily wide
pub static I8042_CONTROLLER: ...</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2951">#2951</a>
and <a href="https://github.com/asterinas/asterinas/pull/2605#discussion_r2720506912">#2605</a>.</p>
<h3 id="workspace-deps"><a class="header" href="#workspace-deps">Use workspace dependencies (<code>workspace-deps</code>)</a></h3>
<p>Always declare shared dependencies
in the workspace <code>[workspace.dependencies]</code> table
and reference them with <code>.workspace = true</code>
in member crates.</p>
<pre><code class="language-toml"># In the workspace root Cargo.toml
[workspace.dependencies]
ostd = { version = "0.17.0", path = "ostd" }
bitflags = "2.6"

# In a member crate's Cargo.toml
[dependencies]
ostd.workspace = true
bitflags.workspace = true
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="macros-and-attributes"><a class="header" href="#macros-and-attributes">Macros and Attributes</a></h1>
<h3 id="narrow-lint-suppression"><a class="header" href="#narrow-lint-suppression">Suppress lints at the narrowest scope (<code>narrow-lint-suppression</code>)</a></h3>
<p>When suppressing lints,
the suppression should affect as little scope as possible.
This makes readers aware
of the exact places where the lint is generated
and makes it easier for subsequent committers
to maintain the suppression.</p>
<pre><code class="language-rust">// Good ‚Äî each method is individually marked
trait SomeTrait {
    #[expect(dead_code)]
    fn foo();

    #[expect(dead_code)]
    fn bar();

    fn baz();
}

// Bad ‚Äî the entire trait is suppressed
#[expect(dead_code)]
trait SomeTrait { ... }</code></pre>
<p>There is one exception:
if it is clear enough
that every member will trigger the lint,
it is reasonable to expect the lint at the type level.</p>
<pre><code class="language-rust">#[expect(non_camel_case_types)]
enum SomeEnum {
    FOO_ABC,
    BAR_DEF,
}</code></pre>
<p>See also:
<a href="https://rust-lang.github.io/rust-clippy/master/#allow_attributes">Clippy <code>allow_attributes</code></a>,
<a href="https://rust-lang.github.io/rust-clippy/master/#allow_attributes_without_reason">Clippy <code>allow_attributes_without_reason</code></a>,
and rustc <a href="https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html#unfulfilled-lint-expectations"><code>unfulfilled_lint_expectations</code></a>.</p>
<h3 id="expect-dead-code"><a class="header" href="#expect-dead-code">Use <code>#[expect(dead_code)]</code> with restraint (<code>expect-dead-code</code>)</a></h3>
<p>In general, dead code should be avoided because
<em>(i)</em> it introduces unnecessary maintenance overhead, and
<em>(ii)</em> its correctness can only be guaranteed
by manual and error-prone review.</p>
<p>Dead code is acceptable only when all of these hold:</p>
<ol>
<li>A <em>concrete case</em> will be implemented in the future
that turns the dead code into used code.</li>
<li>The semantics are <em>clear</em> enough,
even without the use case.</li>
<li>The dead code is <em>simple</em> enough
that both the committer and the reviewer
can be confident it is correct without testing.</li>
<li>It serves as a counterpart to existing non-dead code.</li>
</ol>
<p>For example, it is fine to add ABI constants
that are unused because the corresponding feature
is partially implemented.</p>
<p>See also:
<a href="https://doc.rust-lang.org/reference/attributes/diagnostics.html">Rust Reference: Diagnostic attributes</a>
and rustc <a href="https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html#unfulfilled-lint-expectations"><code>unfulfilled_lint_expectations</code></a>.</p>
<h3 id="macros-as-last-resort"><a class="header" href="#macros-as-last-resort">Prefer functions over macros (<code>macros-as-last-resort</code>)</a></h3>
<p>Prefer functions and generics over macros.
Macros are powerful
but harder to understand, debug, test, and format.
Reach for a macro only when
the type system or generics cannot express
what you need
(e.g., variadic arguments, compile-time code generation,
or DSL syntax).</p>
<pre><code class="language-rust">// Good ‚Äî a generic function covers all types
fn align_up&lt;T: Into&lt;usize&gt;&gt;(val: T, align: usize) -&gt; usize {
    let val = val.into();
    (val + align - 1) &amp; !(align - 1)
}

// Bad ‚Äî a macro where a function would suffice
macro_rules! align_up {
    ($val:expr, $align:expr) =&gt; {
        ($val + $align - 1) &amp; !($align - 1)
    };
}</code></pre>
<p>See also:
<em>The Rust Programming Language</em>, Chapter 20.5 ‚ÄúMacros‚Äù;
<a href="https://doc.rust-lang.org/rust-by-example/macros.html">Rust by Example: Macros</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="select-topics"><a class="header" href="#select-topics">Select Topics</a></h1>
<p>This section covers cross-cutting concerns
that span multiple language items.
Each page focuses on one topic
with actionable guidelines.</p>
<ul>
<li><strong><a href="#concurrency-and-races">Concurrency and Races</a></strong> ‚Äî
Lock ordering,
spinlock discipline,
atomic usage,
and critical sections.</li>
<li><strong><a href="#defensive-programming">Defensive Programming</a></strong> ‚Äî
Correct placement of <code>debug_assert!</code>.</li>
<li><strong><a href="#error-handling">Error Handling</a></strong> ‚Äî
Idiomatic error propagation.</li>
<li><strong><a href="#logging">Logging</a></strong> ‚Äî
<code>log</code>-crate usage and level selection.</li>
<li><strong><a href="#memory-and-resource-management">Memory and Resource Management</a></strong> ‚Äî
RAII-based cleanup and resource ownership.</li>
<li><strong><a href="#performance">Performance</a></strong> ‚Äî
Hot-path complexity,
copy/allocation control,
and measured optimization.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="concurrency-and-races"><a class="header" href="#concurrency-and-races">Concurrency and Races</a></h1>
<p>Concurrency code is reviewed with extreme rigor.
Lock ordering, atomic correctness, memory ordering,
and race condition analysis are all demanded explicitly.</p>
<h3 id="lock-ordering"><a class="header" href="#lock-ordering">Establish and enforce a consistent lock order (<code>lock-ordering</code>)</a></h3>
<p>Acquiring two locks in different orders
from different code paths
is a potential deadlock.
Hierarchical lock order must be established and documented.</p>
<pre><code class="language-rust">pub(super) fn set_control(
    self: Arc&lt;Self&gt;,
    process: &amp;Process,
) -&gt; Result&lt;()&gt; {
    // Lock order: group of process -&gt; session inner -&gt; job control
    let process_group_mut = process.process_group.lock();
    // ...
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2942">#2942</a>.</p>
<h3 id="no-io-under-spinlock"><a class="header" href="#no-io-under-spinlock">Never do I/O or blocking operations while holding a spinlock (<code>no-io-under-spinlock</code>)</a></h3>
<p>Holding a spinlock while performing I/O
or blocking operations is a deadlock hazard.
Use a sleeping mutex or restructure
to drop the lock first.</p>
<pre><code class="language-rust">// Good ‚Äî spinlock dropped before I/O
let data = {
    let guard = self.state.lock(); // state: SpinLock&lt;...&gt;
    guard.pending_data.clone()
};
self.device.write(&amp;data)?;

// Bad ‚Äî I/O while holding spinlock
let guard = self.state.lock(); // state: SpinLock&lt;...&gt;
self.device.write(&amp;guard.pending_data)?;</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/925">#925</a>.</p>
<h3 id="careful-atomics"><a class="header" href="#careful-atomics">Do not use atomics casually (<code>careful-atomics</code>)</a></h3>
<p>When multiple atomic fields
must be updated in concert, use a lock.
Only use atomics when a single value
is genuinely independent.</p>
<pre><code class="language-rust">// Good ‚Äî a lock protects correlated fields
struct Stats {
    inner: SpinLock&lt;StatsInner&gt;,
}
struct StatsInner {
    total_bytes: u64,
    total_packets: u64,
}

// Bad ‚Äî two atomics that must be consistent
// but can be observed in an inconsistent state
struct Stats {
    total_bytes: AtomicU64,
    total_packets: AtomicU64,
}</code></pre>
<h3 id="atomic-critical-sections"><a class="header" href="#atomic-critical-sections">Critical sections must not be split across lock boundaries (<code>atomic-critical-sections</code>)</a></h3>
<p>Operations that must be atomic
(check + conditional action)
must happen under the same lock acquisition.
Moving a comparison outside the critical region
is a correctness bug.</p>
<pre><code class="language-rust">// Good ‚Äî check and action under the same lock
let mut inner = self.inner.lock();
if inner.state == State::Ready {
    inner.state = State::Running;
    inner.start();
}

// Bad ‚Äî TOCTOU race: state can change
// between the check and the action
let is_ready = self.inner.lock().state == State::Ready;
if is_ready {
    self.inner.lock().state = State::Running;
    self.inner.lock().start();
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2277">#2277</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="defensive-programming"><a class="header" href="#defensive-programming">Defensive Programming</a></h1>
<p>Assertions verify invariants that must hold
for the program to be correct.
Choosing the right assertion type
balances safety against runtime cost.</p>
<h3 id="debug-assert"><a class="header" href="#debug-assert">Use <code>debug_assert</code> for correctness-only checks (<code>debug-assert</code>)</a></h3>
<p>Assertions verifying invariants
that should never fail in correct code
belong in <code>debug_assert!</code>, not <code>assert!</code>.
<code>debug_assert!</code> is compiled out in release builds,
so the check catches bugs during development
without costing anything in production.</p>
<pre><code class="language-rust">debug_assert!(self.align.is_multiple_of(PAGE_SIZE));
debug_assert!(self.align.is_power_of_two());</code></pre>
<p>See also:
<a href="https://doc.rust-lang.org/std/macro.debug_assert.html">std::debug_assert!</a>
and <a href="https://doc.rust-lang.org/reference/conditional-compilation.html#debug_assertions">Rust Reference: <code>debug_assertions</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h1>
<p>Rust‚Äôs error handling model ‚Äî <code>Result</code>, <code>?</code>, and typed errors ‚Äî
is central to writing reliable kernel code.</p>
<h3 id="propagate-errors"><a class="header" href="#propagate-errors">Propagate errors with <code>?</code> (<code>propagate-errors</code>)</a></h3>
<p>Use the <code>?</code> operator
to propagate errors idiomatically.
In kernel code,
<code>.unwrap()</code> is rejected
wherever failure is a legitimate possibility.</p>
<pre><code class="language-rust">// Good ‚Äî propagate with ?
let tsc_info = cpuid.get_tsc_info()?;
let frequency = tsc_info.nominal_frequency()?;

// Bad ‚Äî unwrap hides the failure path
let tsc_info = cpuid.get_tsc_info().unwrap();</code></pre>
<p>See also:
<em>The Rust Programming Language</em>, Chapter 9 ‚ÄúError Handling‚Äù
and <a href="https://doc.rust-lang.org/rust-by-example/std/result/question_mark.html">Rust by Example: unpacking options and defaults with <code>?</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<p>Consistent logging makes debugging tractable
across a large kernel codebase.</p>
<h3 id="log-crate-only"><a class="header" href="#log-crate-only">Use <code>log</code> crate macros exclusively (<code>log-crate-only</code>)</a></h3>
<p>The project standardizes on the
<a href="https://docs.rs/log"><code>log</code></a> crate‚Äôs macros:
<code>trace!</code>, <code>debug!</code>, <code>info!</code>, <code>warn!</code>, <code>error!</code>.
Custom output functions, <code>println!</code>,
and hand-rolled serial print macros
are not acceptable in production code.
Exception: code that runs before the logging subsystem
is initialized may use early-boot output helpers.</p>
<pre><code class="language-rust">// Good
log::info!("VirtIO block device initialized: {} sectors", num_sectors);

// Bad
println!("VirtIO block device initialized: {} sectors", num_sectors);</code></pre>
<h3 id="log-levels"><a class="header" href="#log-levels">Choose appropriate log levels (<code>log-levels</code>)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Level</th><th>Use for</th></tr>
</thead>
<tbody>
<tr><td><code>trace!</code></td><td>High-frequency events: every interrupt, every packet, every page fault.</td></tr>
<tr><td><code>debug!</code></td><td>Development diagnostics: state transitions, intermediate values.</td></tr>
<tr><td><code>info!</code></td><td>Rare, noteworthy events: subsystem initialization, configuration changes.</td></tr>
<tr><td><code>warn!</code></td><td>Recoverable problems: fallback paths taken, deprecated usage detected.</td></tr>
<tr><td><code>error!</code></td><td>Serious failures: resource exhaustion, invariant violations caught at runtime.</td></tr>
</tbody>
</table>
</div>
<p>A log statement that fires on every syscall
or every timer tick must use <code>trace!</code>, not <code>debug!</code>.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2260">#2260</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="memory-and-resource-management"><a class="header" href="#memory-and-resource-management">Memory and Resource Management</a></h1>
<p>Rust‚Äôs ownership model is the primary tool
for safe resource management in the kernel.</p>
<h3 id="raii"><a class="header" href="#raii">Use RAII for all resource acquisition and release (<code>raii</code>)</a></h3>
<p>Resources ‚Äî IRQ enable/disable state, port numbers,
file handles, DMA buffers, lock guards ‚Äî
must use the <code>Drop</code> trait for automatic cleanup.
Manual <code>enable()</code>/<code>disable()</code> call pairs are rejected.</p>
<pre><code class="language-rust">// Good ‚Äî RAII guard ensures IRQs are re-enabled
fn disable_local() -&gt; DisabledLocalIrqGuard { ... }

impl Drop for DisabledLocalIrqGuard {
    fn drop(&amp;mut self) {
        enable_local_irqs();
    }
}

// Bad ‚Äî caller can forget to re-enable
fn disable_local_irqs() { ... }
fn enable_local_irqs() { ... }</code></pre>
<p>Prefer lexical lifetimes
so the Rust compiler inserts <code>drop</code> automatically,
rather than calling <code>drop()</code> manually.
When the default drop order is incorrect,
use explicit <code>drop()</code> calls.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/164">#164</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="performance"><a class="header" href="#performance">Performance</a></h1>
<p>Performance on critical paths is taken very seriously.
Changes to hot paths must be benchmarked.
Unnecessary copies, allocations,
and O(n) algorithms are rejected.</p>
<h3 id="no-linear-hot-paths"><a class="header" href="#no-linear-hot-paths">Avoid O(n) algorithms on hot paths (<code>no-linear-hot-paths</code>)</a></h3>
<p>System call dispatch, scheduler enqueue,
and frequent query operations
must not introduce O(n) complexity
where n is a quantity that can be large
(number of processes, number of file descriptors, etc.).
Demand sub-linear alternatives.</p>
<pre><code class="language-rust">// Bad ‚Äî O(n) scan on every enqueue
fn select_cpu(&amp;self, cpus: &amp;[CpuState]) -&gt; CpuId {
    cpus.iter()
        .min_by_key(|c| c.load())
        .expect("at least one CPU")
        .id()
}

// Good ‚Äî maintain a priority queue
// so selection is O(log n)
fn select_cpu(&amp;self) -&gt; CpuId {
    self.cpu_heap.peek().expect("at least one CPU").id()
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/1790">#1790</a>.</p>
<h3 id="minimize-copies"><a class="header" href="#minimize-copies">Minimize unnecessary copies and allocations (<code>minimize-copies</code>)</a></h3>
<p>Extra data copies ‚Äî
serializing to a stack buffer before writing,
cloning an <code>Arc</code> when a <code>&amp;</code> reference suffices,
collecting into a <code>Vec</code> when an iterator would do ‚Äî
should be avoided.</p>
<pre><code class="language-rust">// Bad ‚Äî unnecessary Arc::clone
fn process(&amp;self, stream: Arc&lt;DmaStream&gt;) {
    let s = stream.clone();
    s.sync();
}

// Good ‚Äî borrow when ownership is not needed
fn process(&amp;self, stream: &amp;DmaStream) {
    stream.sync();
}</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2582">#2582</a>
and <a href="https://github.com/asterinas/asterinas/pull/2725">#2725</a>.</p>
<h3 id="no-premature-optimization"><a class="header" href="#no-premature-optimization">No premature optimization without evidence (<code>no-premature-optimization</code>)</a></h3>
<p>Performance optimizations
must be justified with data.
Introducing complexity
to solve a non-existent problem is rejected.
If you claim a change improves performance,
show the numbers.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="git-guidelines"><a class="header" href="#git-guidelines">Git Guidelines</a></h1>
<p>These guidelines cover commit hygiene and pull request conventions.
For the underlying philosophy, see
<a href="#how-guidelines-are-written">How Guidelines Are Written</a>.</p>
<h3 id="imperative-subject"><a class="header" href="#imperative-subject">Write imperative, descriptive subject lines (<code>imperative-subject</code>)</a></h3>
<p>Write commit messages in imperative mood
with the subject line at or below 72 characters.
Wrap identifiers in backticks.</p>
<p>Common prefixes used in the Asterinas commit log:</p>
<ul>
<li><code>Fix</code> ‚Äî correct a bug</li>
<li><code>Add</code> ‚Äî introduce new functionality</li>
<li><code>Remove</code> ‚Äî delete code or features</li>
<li><code>Refactor</code> ‚Äî restructure without changing behavior</li>
<li><code>Rename</code> ‚Äî change names of files, modules, or symbols</li>
<li><code>Implement</code> ‚Äî add a new subsystem or feature</li>
<li><code>Enable</code> ‚Äî turn on a previously disabled capability</li>
<li><code>Clean up</code> ‚Äî minor tidying without functional change</li>
<li><code>Bump</code> ‚Äî update a dependency version</li>
</ul>
<p>Examples:</p>
<pre><code>Fix deadlock in `Vmar::protect` when holding the page table lock

Add initial support for the io_uring subsystem

Refactor `TcpSocket` to separate connection state from I/O logic
</code></pre>
<p>If the commit requires further explanation,
add a blank line after the subject
followed by a body paragraph
describing the <em>why</em> behind the change.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2877">#2877</a>
and <a href="https://github.com/asterinas/asterinas/pull/2700">#2700</a>.</p>
<h3 id="atomic-commits"><a class="header" href="#atomic-commits">One logical change per commit (<code>atomic-commits</code>)</a></h3>
<p>Each commit should represent one logical change.
Do not mix unrelated changes in a single commit.
When fixing an issue discovered during review
on a local or private branch,
use <code>git rebase -i</code> to amend the commit
that introduced the issue
rather than appending a fixup commit at the end.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2791">#2791</a>
and <a href="https://github.com/asterinas/asterinas/pull/2260">#2260</a>.</p>
<h3 id="refactor-then-feature"><a class="header" href="#refactor-then-feature">Separate refactoring from features (<code>refactor-then-feature</code>)</a></h3>
<p>If a feature requires preparatory refactoring,
put the refactoring in its own commit(s)
before the feature commit.
This makes each commit easier to review and bisect.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2877">#2877</a>.</p>
<h3 id="focused-prs"><a class="header" href="#focused-prs">Keep pull requests focused (<code>focused-prs</code>)</a></h3>
<p>Keep pull requests focused on a single topic.
A PR that mixes a bug fix, a refactoring,
and a new feature is difficult to review.</p>
<p>Ensure that CI passes before requesting review.
If CI fails on an unrelated flake,
note it in the PR description.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="testing-guidelines"><a class="header" href="#testing-guidelines">Testing Guidelines</a></h1>
<p>This page covers language-agnostic testing conventions.
For Rust-specific assertion policy (<code>assert!</code> vs <code>debug_assert!</code>), see
<a href="#defensive-programming">Rust Guidelines ‚Äî Defensive Programming</a>.</p>
<h3 id="add-regression-tests"><a class="header" href="#add-regression-tests">Add regression tests for every bug fix (<code>add-regression-tests</code>)</a></h3>
<p>When a bug is fixed,
a test that would have caught the bug should accompany the fix.
Include a reference to the issue number
in a comment so future readers
can recover the original context.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2962">#2962</a>.</p>
<h3 id="test-visible-behavior"><a class="header" href="#test-visible-behavior">Test user-visible behavior, not internals (<code>test-visible-behavior</code>)</a></h3>
<p>Tests should validate observable, user-facing outcomes.
Prefer testing through public APIs
rather than exposing internal constants in test code.</p>
<p>Name tests after the behavior or specification concept being verified,
not after internal implementation details.
Using kernel-internal names in user-space regression tests
creates unnecessary coupling.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2926">#2926</a>.</p>
<h3 id="use-assertions"><a class="header" href="#use-assertions">Use assertion macros, not manual inspection (<code>use-assertions</code>)</a></h3>
<p>Use language- or framework-provided assertion helpers
instead of printing values and manually inspecting output.
Assertions provide clear failure messages
and make tests self-checking.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2877">#2877</a>
and <a href="https://github.com/asterinas/asterinas/pull/2926">#2926</a>.</p>
<h3 id="test-cleanup"><a class="header" href="#test-cleanup">Clean up resources after every test (<code>test-cleanup</code>)</a></h3>
<p>Always clean up resources after a test:
close file descriptors, unlink temporary files,
and call <code>waitpid</code> on child processes.
Leftover resources can cause flaky failures
in subsequent tests.</p>
<pre><code class="language-c">// Good ‚Äî cleanup after use
int fd = open("/tmp/test_file", O_CREAT | O_RDWR, 0644);
// ... test logic ...
close(fd);
unlink("/tmp/test_file");
</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2926">#2926</a>
and <a href="https://github.com/asterinas/asterinas/pull/2969">#2969</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="assembly-guidelines"><a class="header" href="#assembly-guidelines">Assembly Guidelines</a></h1>
<p>These guidelines apply to assembly code
in module-level <code>global_asm!</code> blocks and standalone <code>.S</code> files.
For the underlying philosophy, see
<a href="#how-guidelines-are-written">How Guidelines Are Written</a>.</p>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<h3 id="asm-section-directives"><a class="header" href="#asm-section-directives">Use the correct section directive (<code>asm-section-directives</code>)</a></h3>
<p>For built-in sections, use the short directive (e.g., <code>.text</code>).
For custom sections,
use the <code>.section</code> directive with flags and type
(e.g., <code>.section ".bsp_boot", "awx", @progbits</code>).</p>
<p>A blank line should follow each section definition
to visually separate it from the code that follows.</p>
<pre><code class="language-asm">.section ".bsp_boot.stack", "aw", @nobits

boot_stack_bottom:
    .balign 4096
    .skip 0x40000  # 256 KiB
boot_stack_top:
</code></pre>
<h3 id="asm-code-width"><a class="header" href="#asm-code-width">Place code-width directives after the section definition (<code>asm-code-width</code>)</a></h3>
<p>In x86-64, if an executable section contains only 64-bit code,
place the <code>.code64</code> directive directly after the section definition.
The same applies to <code>.code32</code> for 32-bit code.
In mixed sections, treat <code>.code64</code> and <code>.code32</code>
as function attributes (see below).</p>
<pre><code class="language-asm">.text
.code64

.global foo
foo:
    mov rax, 1
    ret
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="asm-function-attributes"><a class="header" href="#asm-function-attributes">Place attributes directly before the function (<code>asm-function-attributes</code>)</a></h3>
<p>Function attributes (<code>.global</code>, <code>.balign</code>, <code>.type</code>)
should be placed directly before the function label
and should not be indented.
Prefer <code>.global</code> over <code>.globl</code> for clarity.</p>
<pre><code class="language-asm">.balign 4
.global foo
foo:
    mov rax, 1
    ret
</code></pre>
<h3 id="asm-type-and-size"><a class="header" href="#asm-type-and-size">Add <code>.type</code> and <code>.size</code> for Rust-callable functions (<code>asm-type-and-size</code>)</a></h3>
<p>Functions that can be called from Rust code
should include the <code>.type</code> and <code>.size</code> directives.
This gives debuggers a better understanding of the function.</p>
<pre><code class="language-asm">.global bar
.type bar, @function
bar:
    mov rax, 2
    ret
.size bar, .-bar
</code></pre>
<p>This does not apply to boot entry points,
exception trampolines, or interrupt trampolines ‚Äî
they may not fit the typical definition of ‚Äúfunction‚Äù
and their sizes may be ill-defined.</p>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2320">#2320</a>.</p>
<h3 id="asm-label-prefixes"><a class="header" href="#asm-label-prefixes">Use unique label prefixes to avoid name clashes (<code>asm-label-prefixes</code>)</a></h3>
<p>A Rust crate is a single translation unit,
so <code>global_asm!</code> labels in different modules
within the same crate share the same global namespace.
Add custom prefixes to labels to avoid name clashes
(e.g., <code>bsp_</code> for BSP boot code, <code>ap_</code> for AP boot code).</p>
<pre><code class="language-asm"># Good ‚Äî prefixed to avoid clashes
bsp_boot_stack_top:
ap_boot_stack_top:

# Bad ‚Äî generic names risk duplication
boot_stack_top:
</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2571">#2571</a>
and <a href="https://github.com/asterinas/asterinas/pull/2573">#2573</a>.</p>
<h3 id="asm-prefer-balign"><a class="header" href="#asm-prefer-balign">Prefer <code>.balign</code> over <code>.align</code> (<code>asm-prefer-balign</code>)</a></h3>
<p>The <code>.align</code> directive‚Äôs behavior varies across architectures ‚Äî
on some it specifies a byte count,
on others a power of two.
Use <code>.balign</code> for unambiguous byte-count alignment.</p>
<pre><code class="language-asm"># Good ‚Äî unambiguous
.balign 4096

# Bad ‚Äî architecture-dependent meaning
.align 12
</code></pre>
<p>See also:
PR <a href="https://github.com/asterinas/asterinas/pull/2368">#2368</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="boterinas"><a class="header" href="#boterinas">Boterinas</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p><code>@boterinas</code> is a general-purpose bot designed for a wide variety of tasks in Asterinas. It streamlines maintenance tasks to enhance workflow efficiency.</p>
<p>Commands are issued by writing comments that start with the text <code>@boterinas</code>. The available commands depend on which repository you are using. The main Asterinas repository contains a <code>triagebot.toml</code> file where you can see which features are enabled.</p>
<p>Commands for GitHub issues or pull requests should be issued by writing <code>@boterinas</code> followed by the command anywhere in the comment. Note that <code>@boterinas</code> will ignore commands in Markdown code blocks, inline code spans, or blockquotes. You can enter multiple <code>@boterinas</code> commands in a single comment.</p>
<p>For example, you can claim an issue and add a label in the same comment.</p>
<pre><code class="language-markdown">@boterinas claim
@boterinas label C-enhancement
</code></pre>
<p>Additionally, <code>@boterinas</code> allows for editing comments. If you don‚Äôt change the text of a command, the edit will be ignored. However, if you modify an existing command or add new ones, those commands will be processed.</p>
<p>Below, you‚Äôll find a comprehensive guide on how to use <code>@boterinas</code> effectively.</p>
<h2 id="commands-and-usage"><a class="header" href="#commands-and-usage">Commands and Usage</a></h2>
<h3 id="workflow-management"><a class="header" href="#workflow-management">Workflow Management</a></h3>
<ul>
<li><strong><code>@boterinas rerun</code></strong><br>Restarts the workflow of the current pull request if it has failed unexpectedly. Only the author of the pull request can use this command.</li>
</ul>
<h3 id="issue-and-pull-request-management"><a class="header" href="#issue-and-pull-request-management">Issue and Pull Request Management</a></h3>
<ul>
<li>
<p><strong><code>@boterinas claim</code></strong><br>Assigns the issue or pull request to yourself.</p>
</li>
<li>
<p><strong><code>@boterinas release-assignment</code></strong><br>Removes the current assignee from an issue or pull request. This command can only be executed by the current assignee or a team member.</p>
</li>
<li>
<p><strong><code>@boterinas assign @user</code></strong><br>Assigns a specific user to the issue or pull request. Only team members have permission to assign other users.</p>
</li>
</ul>
<h3 id="label-management"><a class="header" href="#label-management">Label Management</a></h3>
<ul>
<li>
<p><strong><code>@boterinas label &lt;label&gt;</code></strong><br>Adds a label to the issue or pull request.<br><em>Example:</em> <code>@boterinas label C-enhancement C-rfc</code></p>
</li>
<li>
<p><strong><code>@boterinas label -&lt;label&gt;</code></strong><br>Removes a label from the issue or pull request.<br><em>Example:</em> <code>@boterinas label -C-enhancement -C-bug</code></p>
</li>
</ul>
<h3 id="status-indicators"><a class="header" href="#status-indicators">Status Indicators</a></h3>
<ul>
<li>
<p><strong><code>@boterinas author</code></strong><br>Indicates that a pull request is waiting on the author. It assigns the <code>S-waiting-on-author</code> label and removes both <code>S-waiting-on-review</code> and <code>S-blocked</code>, if present.</p>
</li>
<li>
<p><strong><code>@boterinas blocked</code></strong><br>Marks a pull request as blocked on something.</p>
</li>
<li>
<p><strong><code>@boterinas ready</code></strong><br>Indicates that a pull request is ready for review. This command can also be invoked with the aliases <code>@boterinas review</code> or <code>@boterinas reviewer</code>.</p>
</li>
</ul>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<ul>
<li>Only team members can assign users or remove assignments.</li>
<li>Labels are crucial for organizing issues and pull requests, so ensure they are used consistently and accurately.</li>
<li>For any issues or questions regarding <code>@boterinas</code>, please reach out to the team for support.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="version-bump"><a class="header" href="#version-bump">Version Bump</a></h1>
<h2 id="version-numbers"><a class="header" href="#version-numbers">Version Numbers</a></h2>
<p>Currently, Asterinas regularly releases two main artifacts
for the Rust OS developer community:
the <a href="https://crates.io/crates/cargo-osdk">OSDK</a> and <a href="https://crates.io/crates/ostd">OSTD</a>.
To support development with these tools,
we also publish companion Docker images on DockerHub,
(i.e., <a href="https://hub.docker.com/r/asterinas/osdk"><code>asterinas/osdk</code></a>).
While the Asterinas kernel is not yet ready for public binary release,
its development Docker images
(i.e., <a href="https://hub.docker.com/r/asterinas/asterinas"><code>asterinas/asterinas</code></a>)
are released regularly.</p>
<p>All released crates for OSDK and OSTD share the same version number,
which is stored in the <code>VERSION</code> file at the project root.
The current content of this file is shown below.</p>
<pre><code>0.17.0
</code></pre>
<p>Similarly,
the Docker images‚Äô version number is stored in the <code>DOCKER_IMAGE_VERSION</code> file,
as shown below.</p>
<pre><code>0.17.0-20260227
</code></pre>
<p>We use a custom format for Docker image versions: <code>MAJOR.MINOR.PATCH-DATE</code>.
The <code>MAJOR.MINOR.PATCH</code> component aligns with the target version of published crates,
while the <code>DATE</code> component allows us to introduce non-breaking updates to the Docker images
without publishing a new crate version.
Normally,
the version in <code>VERSION</code> and the version in <code>DOCKER_IMAGE_VERSION</code>
(ignoring the <code>DATE</code> part) are identical,
except during the version bump process.</p>
<h2 id="how-to-bump-versions"><a class="header" href="#how-to-bump-versions">How to Bump Versions</a></h2>
<p>We recommend a three-commit procedure to bump versions:</p>
<ol>
<li><strong>Commit 1 ‚ÄúBump the Docker image version‚Äù</strong> triggers the generation of a new Docker image.</li>
<li><strong>Commit 2 ‚ÄúSwitch to a new Docker image‚Äù</strong> makes the codebase use the new Docker image.</li>
<li><strong>Commit 3 ‚ÄúBump the project version‚Äù</strong> triggers the release of new crates.</li>
</ol>
<p>Depending on your exact purpose,
you may complete the version bump process with at most three commits within two PRs.</p>
<ul>
<li><strong>To make non-breaking changes to the Docker images</strong>,
submit Commit 1 in a PR, then Commit 2 in another.</li>
<li><strong>To make breaking changes to the Docker images and the crates‚Äô APIs</strong>,
submit Commit 1 in a PR, then Commit 2 and 3 in another.</li>
</ul>
<p>Across the three commits,
you will be assisted with a convenient utility script, <code>tools/bump_version.sh</code>,</p>
<h3 id="commit-1-bump-the-docker-image-version"><a class="header" href="#commit-1-bump-the-docker-image-version">Commit 1: ‚ÄúBump the Docker image version‚Äù</a></h3>
<p>After updating the Docker image content,
increment the Docker image version using the following command:</p>
<pre><code>./bump_version.sh --docker_version_file [major | minor | patch | date]
</code></pre>
<p>The second argument specifies which part of the Docker image version to increment.
Use <code>date</code> for non-breaking Docker image changes.
If the changes affect the crates intended to publish,
select <code>major</code>, <code>minor</code>, or <code>patch</code> in line with semantic versioning.</p>
<p>This command updates the <code>DOCKER_IMAGE_VERSION</code> file.
Submit these changes as a pull request.
Once merged, the CI will automatically trigger the creation of new Docker images.</p>
<h3 id="commit-2-switch-to-a-new-docker-image"><a class="header" href="#commit-2-switch-to-a-new-docker-image">Commit 2: ‚ÄúSwitch to a new Docker image‚Äù</a></h3>
<p>Creating new Docker images can be time-consuming.
Once the images have been pushed to DockerHub,
write a follow-up commit to
update all Docker image version references across the codebase.</p>
<pre><code>./bump_version.sh --docker_version_refs
</code></pre>
<p>If your purpose is to publish non-breaking changes to the Docker images,
then submit this commit in a PR and then your job is finished.
Otherwise, go on with Commit 3.</p>
<h3 id="commit-3-bump-the-project-version"><a class="header" href="#commit-3-bump-the-project-version">Commit 3: ‚ÄúBump the project version‚Äù</a></h3>
<p>In this commit,
synchronize the version number in <code>VERSION</code> with
that in <code>DOCKER_IMAGE_VERSION</code> by running:</p>
<pre><code>./bump_version.sh --version_file
</code></pre>
<p>This command also updates all version numbers
in the <code>Cargo.toml</code> files of all crates scheduled for release.
Pack these changes into a third commit and
submit the last two commits in a single PR.
After the PR is merged into the <code>main</code> branch,
the CI will automatically publish the new crate versions.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-overview"><a class="header" href="#rfc-overview">RFC Overview</a></h1>
<p>The Asterinas RFC process is intended to provide a consistent, transparent, structured path for the community to make ‚Äúbig‚Äù decisions. For example, the RFC process can be used to evolve the project roadmap and the system architecture.</p>
<p>For more details, see the <a href="#rfc-0001-rfc-process">RFC-0001 RFC process</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0001-rfc-process"><a class="header" href="#rfc-0001-rfc-process">RFC-0001: RFC process</a></h1>
<ul>
<li>Status: Implemented</li>
<li>Pull request: https://github.com/asterinas/asterinas/pull/2365/</li>
<li>Date submitted: 2025-08-24</li>
<li>Date approved: 2025-09-05</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>The ‚ÄúRFC‚Äù (request for comments) process is intended to provide a consistent, transparent, structured path for the community to make ‚Äúbig‚Äù decisions. For example, the RFC process can be used to evolve the project roadmap and the system architecture.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>As the Asterinas project grows in scale and community size, an informal decision-making process becomes insufficient. A formalized process is crucial for maintaining the quality and coherence of the project. Several highly successful open-source projects have demonstrated the value of such a process, including Rust (<a href="https://rust-lang.github.io/rfcs/introduction.html">RFCs</a>), Fuchsia (<a href="https://fuchsia.dev/fuchsia-src/contribute/governance/rfcs">RFCs</a>), Python (<a href="https://peps.python.org/">Python Enhancement Proposals</a> or PEPs), and Kubernetes (<a href="https://www.kubernetes.dev/resources/keps/">Kubernetes Enhancement Proposals</a> or KEPs).</p>
<p>Adopting a formal RFC process will:</p>
<ul>
<li><strong>Enhance decision quality</strong>: By requiring a detailed proposal and public discussion, we can ensure that decisions are well-reasoned, technically sound, and consider a wide range of perspectives.</li>
<li><strong>Foster Consensus</strong>: The process provides a clear framework for the community to come together, discuss differing viewpoints, and arrive at a consensus on important issues.</li>
<li><strong>Create design records</strong>: Approved RFCs will serve as a historical archive, documenting the design choices made and the reasoning behind them. This is invaluable for new contributors and for future reference.</li>
</ul>
<p>By introducing this process, we aim to support the healthy and sustainable growth of the Asterinas project.</p>
<h2 id="design"><a class="header" href="#design">Design</a></h2>
<h3 id="when-to-follow-the-rfc-process"><a class="header" href="#when-to-follow-the-rfc-process">When to follow the RFC process</a></h3>
<p>The RFC process should be used for any ‚Äúsubstantial‚Äù change to Asterinas. Examples of changes that <strong>require</strong> an RFC include:</p>
<ul>
<li>Launching new top-level sub-projects of a similar significance to OSTD and OSDK.</li>
<li>Defining or significantly altering the project roadmap and goals.</li>
<li>Establishing or changing project-wide norms, such as this RFC process itself or coding style guides.</li>
<li>Proposing significant architectural designs, such as the framekernel architecture or safe policy injection.</li>
<li>Introducing changes that affect user-space programs, such as adding a non-Linux system call or feature.</li>
</ul>
<p>Examples of changes that <strong>do not</strong> require an RFC include:</p>
<ul>
<li>Proposing a design whose impact is confined to a single sub-project or module. If the design is significant or non-trivial, submit a design proposal on Github Issues for discussion.</li>
<li>Adding well-understood features with established patterns, such as a standard Linux system call or a device driver.</li>
<li>Refactoring existing code, fixing bugs, or improving performance.</li>
</ul>
<p>When in doubt, it is best to consult with the project maintainers using the methods described in the next section.</p>
<h3 id="how-the-rfc-process-works"><a class="header" href="#how-the-rfc-process-works">How the RFC process works</a></h3>
<p>The RFC process consists of several distinct stages:</p>
<h4 id="the-socialization-stage"><a class="header" href="#the-socialization-stage">The Socialization Stage</a></h4>
<p>Before investing the time to write a full RFC, it is highly recommended to socialize the core idea with the community. This helps gauge interest, gather early feedback, and refine the proposal. Good venues for this include:</p>
<ul>
<li>Starting a discussion on the project‚Äôs <a href="https://github.com/asterinas/asterinas/discussions">GitHub Discussions page</a>.</li>
<li>Posting a ‚ÄúPre-RFC‚Äù document to solicit more detailed feedback.</li>
<li>Talking to key contributors, code owners, or maintainers directly.</li>
</ul>
<p>Having support from at least a few other community members is a strong signal that the idea is ready for a formal RFC. Additionally, having a proof-of-concept implementation or identifying individuals committed to the implementation can strengthen the proposal.</p>
<h4 id="the-draft-stage"><a class="header" href="#the-draft-stage">The Draft Stage</a></h4>
<p>Once you are ready to proceed, create a formal RFC document.</p>
<ol>
<li>Fork the <code>asterinas/asterinas</code> repository.</li>
<li>In <a href="https://github.com/asterinas/asterinas/tree/main/book/src/rfcs">the <code>rfcs</code> directory</a>, copy <code>rfc-template.md</code> and rename it to <code>0000-your-rfc-title.md</code>. The <code>0000</code> is a placeholder for the RFC number, which will be assigned later.</li>
<li>Fill out the template with your proposal. The template provides a solid structure, but feel free to adapt it to best suit your proposal.</li>
</ol>
<h4 id="the-iteration-stage"><a class="header" href="#the-iteration-stage">The Iteration Stage</a></h4>
<p>Submit your RFC draft as a pull request to the Asterinas repository. Once the PR is opened, the formal review process begins:</p>
<ul>
<li>A project maintainer will be assigned as the <strong>facilitator</strong> for the RFC. The facilitator‚Äôs role is to guide the discussion, ensure it remains productive, and ultimately determine when consensus has been reached.</li>
<li>All members of the community are encouraged to review the proposal and provide constructive feedback through comments on the pull request.</li>
<li>The RFC author is responsible for engaging with the feedback, addressing concerns, and updating the RFC text to reflect the evolving consensus.</li>
</ul>
<h4 id="the-voting-stage"><a class="header" href="#the-voting-stage">The Voting Stage</a></h4>
<p>When the discussion has converged and the major points of feedback have been addressed, the author can request that the facilitator initiate a final vote.</p>
<ul>
<li>The vote is open to all project maintainers and code owners of top-level sub-projects. See the <a href="https://github.com/asterinas/asterinas/blob/main/CODEOWNERS"><code>CODEOWNERS</code></a> file for details.</li>
<li>Voters can express either ‚Äúapproval‚Äù or ‚Äúrejection.‚Äù</li>
<li>The final decision will be based on a <a href="https://en.wikipedia.org/wiki/Rough_consensus">rough consensus</a> as determined by the facilitator. This means that while unanimous agreement is not required, any major objections must be addressed.</li>
</ul>
<p>If the final decision is approval:</p>
<ol>
<li>The facilitator will assign an unique RFC number.</li>
<li>The author will update the RFC‚Äôs file name with the assigned RFC number. The author should also update the metadata fields of the RFC.</li>
<li>The facilitator will merge the pull request.</li>
</ol>
<h4 id="the-maintenance-stage"><a class="header" href="#the-maintenance-stage">The Maintenance Stage</a></h4>
<p>Once an RFC is approved, the proposed changes are ready for implementation. When the corresponding work is completed and merged, the RFC‚Äôs status is updated from ‚Äúapproved‚Äù to ‚Äúimplemented.‚Äù</p>
<p>Approved RFCs are considered immutable historical records of design decisions. As such, only minor corrective edits like fixing typos or broken links are allowed.</p>
<p>Significant changes or amendments to an existing RFC must be proposed through an entirely new RFC. This new proposal can also be used to formally deprecate a previous RFC, in which case the original‚Äôs status will be updated to ‚Äúdeprecated.‚Äù</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>All RFCs submitted to the Asterinas project are licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. This license is more permissive than <a href="https://www.mozilla.org/en-US/MPL/">the MPL license</a> used for the Asterinas code.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p>Introducing a formal RFC process can increase the overhead for making changes to the project. The process is intentionally deliberate, which may slow down the pace of development for major features. There is also a risk that the process could become overly bureaucratic if not managed carefully. For contributors, the effort required to write a high-quality RFC and see it through the review process can be significant.</p>
<h2 id="prior-art-and-references"><a class="header" href="#prior-art-and-references">Prior Art and References</a></h2>
<p>The Asterinas RFC process is heavily inspired by the well-established processes of the following two open-source projects:</p>
<ul>
<li><a href="https://rust-lang.github.io/rfcs/0002-rfc-process.html">Rust RFC Process</a>: The overall structure and philosophy are closely modeled on Rust‚Äôs RFC process.</li>
<li><a href="https://fuchsia.dev/fuchsia-src/contribute/governance/rfcs/rfc_process">Fuchsia RFC Process</a>: We have drawn on the Fuchsia process for its clear definition of roles and its emphasis on transparent decision-making.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0002-asterinas-nixos"><a class="header" href="#rfc-0002-asterinas-nixos">RFC-0002: Asterinas NixOS</a></h1>
<ul>
<li>Status: Approved</li>
<li>Pull request: https://github.com/asterinas/asterinas/pull/2584</li>
<li>Date submitted: 2025-11-14</li>
<li>Date approved: 2025-12-01</li>
</ul>
<h2 id="summary-1"><a class="header" href="#summary-1">Summary</a></h2>
<p>This RFC formally proposes the establishment of an Asterinas distribution as a new, top-level sub-project of Asterinas. We intend for this distribution to leverage <a href="https://nixos.org/">NixOS</a> due to its unparalleled customizability and rich package ecosystem. Accordingly, we propose naming this new sub-project <strong>Asterinas NixOS (AsterNixOS)</strong>.</p>
<h2 id="motivations"><a class="header" href="#motivations">Motivations</a></h2>
<h3 id="what-is-a-distro"><a class="header" href="#what-is-a-distro">What is a ‚Äúdistro‚Äù?</a></h3>
<p>In the context of operating systems (OSes), a ‚Äúdistribution‚Äù (or ‚Äúdistro‚Äù) typically refers to a complete OS built around a kernel, complemented by userspace tools, libraries, and applications managed via a package management system. A Linux distro, for example, combines the Linux kernel with a rich userspace. Similarly, an Asterinas distro will pair the Asterinas kernel with a comprehensive userspace environment. For the purpose of this discussion, ‚Äúdistro‚Äù will refer broadly to either a Linux or Asterinas-based distro.</p>
<h3 id="short-term-strategic-advantages"><a class="header" href="#short-term-strategic-advantages">Short-term strategic advantages</a></h3>
<p>Achieving a Minimum Viable Product (MVP) milestone is crucial for Asterinas‚Äôs maturation. Reaching MVP means that Asterinas is ready for evaluation by early adopters, who expect a seamless experience comparable to mainstream OSes. This includes easy application installation and out-of-the-box functionality. Simply providing a kernel is insufficient; we must deliver a user-friendly experience, which necessitates a full-fledged distro complete with an intuitive package manager.</p>
<p>Furthermore, direct control over an Asterinas distro offers a pragmatic approach to addressing Linux compatibility challenges. While Asterinas is committed to a high degree of Linux compatibility, achieving perfect parity in the near term is impractical. A dedicated distro allows us to configure or patch specific packages to circumvent reliance on advanced or bleeding-edge Linux features that do not have high priority in Asterinas. This significantly reduces pressure on Asterinas kernel developers to implement complex features prematurely, enabling a more focused and stable development roadmap.</p>
<p>Beyond external users, Asterinas developers themselves will greatly benefit from a dedicated distro. Testing complex applications with intricate dependencies is a significant hurdle. While ‚ÄúHello World‚Äù or even medium-sized projects like Nginx or Redis can be manually built and integrated into a disk image, this approach does not scale for complex applications such as Spark, PyTorch, or Chromium. Identifying, understanding, and building every dependency for such projects would divert critical kernel development resources. A distro, by its very nature, abstracts this complexity through its package manager, streamlining the testing and development workflow for all Asterinas developers.</p>
<h3 id="long-term-ecosystem-vision"><a class="header" href="#long-term-ecosystem-vision">Long-term ecosystem vision</a></h3>
<p>Looking ahead, we envision a thriving ecosystem of Asterinas distros. This initial, kernel-developer-maintained distro will serve as a vital reference implementation, fostering the creation of diverse Asterinas-based distros. While the Linux world boasts numerous distros, Asterinas-specific distros will be essential for two primary reasons:</p>
<p>Firstly, Asterinas prioritizes Linux compatibility at the external ABI level, not the internal kernel module interface. This means Asterinas cannot load Linux kernel modules (<code>.ko</code> files). An Asterinas distro will ensure that all system programs exclusively load Asterinas kernel modules.</p>
<p>Secondly, Asterinas will eventually provide features and value propositions that Linux simply does not have‚Äîfor example, new system calls, file systems, and device drivers. These benefits only become real when applications can detect and leverage them.</p>
<p>An Asterinas distro is the natural vehicle for this. It can ship new packages written specifically for Asterinas and carry patches to existing packages to make them ‚ÄúAsterinas-aware‚Äù, ensuring that userspace can meaningfully take advantage of the kernel‚Äôs unique capabilities.</p>
<p>In essence, establishing Asterinas distros is paramount for Asterinas‚Äôs long-term success and differentiation. This RFC lays the groundwork for that future by proposing our foundational distro.</p>
<h2 id="design-1"><a class="header" href="#design-1">Design</a></h2>
<h3 id="why-nixos-as-the-base-distro"><a class="header" href="#why-nixos-as-the-base-distro">Why NixOS as the base distro?</a></h3>
<p>Building the first Asterinas distro from scratch would be an immense undertaking, diverting focus from core kernel development. Therefore, basing it on an existing Linux distro is the most rational path forward. This leads to the crucial question: which Linux distro should serve as our foundation?</p>
<p>The landscape of Linux distros is vast, featuring prominent names such as <a href="https://archlinux.org/">Arch</a>, <a href="https://www.centos.org/">CentOS</a>, <a href="https://www.debian.org/">Debian</a>, and <a href="https://www.gentoo.org/">Gentoo</a>. While theoretically, any of these could serve, we have identified <a href="https://nixos.org/">NixOS</a> as a particularly attractive and uniquely suited option.</p>
<p>In most distros, package recipes are centered around shell scripts (e.g., <a href="https://man.archlinux.org/man/PKGBUILD.5#EXAMPLE"><code>PKGBUILD</code></a> in Arch Linux or the <a href="https://www.debian.org/doc/manuals/maint-guide/dreq.en.html#rules"><code>rules</code></a> file in a Debian package). NixOS, however, utilizes a purpose-built, purely functional language called <a href="https://nixos-and-flakes.thiscute.world/the-nix-language/">Nix</a>, which offers unparalleled expressiveness and flexibility for defining package recipes.</p>
<p>A core requirement for our base distro is the ability to easily tweak existing package recipes to work around Asterinas‚Äôs limitations or customize the new distro‚Äôs look or behavior. The Nix language excels in this regard.</p>
<p>For instance, consider overriding specific attributes of an existing Nix package, such as <code>xfdesktop</code>, with minimal code:</p>
<pre><code class="language-nix">{ pkgs }:
{
  xfdesktop = pkgs.xfce.xfdesktop.overrideAttrs (oldAttrs: {
    version = "4.16.0";
    patches = (oldAttrs.patches or []) ++ [
      ./patches/xfdesktop4/0001-Fix-not-using-consistent-monitor-identifiers.patch
    ];
  });
}
</code></pre>
<p>This Nix file creates a customized <code>xfdesktop</code> package without requiring intrusive modifications to its original recipe. This capability, known as <a href="https://nixos.org/guides/nix-pills/14-override-design-pattern.html">the override design pattern</a> in Nix, is uniquely feasible due to Nix‚Äôs first-class functions and lazy evaluation.</p>
<p>Another powerful example of NixOS‚Äôs flexibility is how easily we can create an Asterinas distro ISO installer by customizing an existing <a href="https://nixos.org/download/#nixos-iso">NixOS installer ISO</a>. Consider the following <code>iso-image.nix</code> file:</p>
<pre><code class="language-nix">{ lib, pkgs, ... }:
let
  asterinas_kernel = builtins.path { path = "asterinas_bin"; };
  auto_install_script = pkgs.replaceVarsWith {
    src = "./auto_install.sh";
    isExecutable = true;
    replacements = {
      shell = "${pkgs.bash}/bin/sh";
      inherit asterinas_kernel;
    };
  };
  configuration = {
    imports = [
      "${pkgs.path}/nixos/modules/installer/cd-dvd/installation-cd-minimal.nix"
      "${pkgs.path}/nixos/modules/installer/cd-dvd/channel.nix"
    ];

    services.getty.autologinUser = lib.mkForce "root";
    environment.loginShellInit = "${auto_install_script}";
  };
in (pkgs.nixos configuration).config.system.build.isoImage
</code></pre>
<p>This file defines a new installer ISO that differs from the original in two key ways. First, it ships with the Asterinas kernel (<code>asterinas_kernel</code>). Second, instead of dropping the user into an interactive shell, the ISO‚Äôs init process immediately runs an automatic installation script (<code>auto_install.sh</code>).</p>
<p>A notable NixOS feature relevant to our design is <code>/etc/nixos/configuration.nix</code>, the <a href="https://nixos.org/manual/nixos/stable/#sec-configuration-file">primary configuration file</a> that determines <em>all</em> system-wide states of a NixOS installation, including the kernel, installed software, and configuration. A minimal <code>configuration.nix</code> for our distro might look like this:</p>
<pre><code class="language-nix">{ config, pkgs, lib, ... }:
{
  # Do not edit the following system configuration for Asterinas NixOS
  nixpkgs.overlays = [ (import ./asterinas.nix) ];

  # Edit this list to add or remove installed software
  environment.systemPackages = with pkgs; [
    gcc
    python33
    vim
  ];
}
</code></pre>
<p>Here, the sample <code>configuration.nix</code> uses a NixOS feature called <a href="https://wiki.nixos.org/wiki/Overlays">overlays</a> to customize and extend Nixpkgs without modifying its upstream source. Overlays apply globally within the configuration, so our Asterinas-specific changes to vanilla NixOS can be expressed cleanly as reusable overlays rather than as ad-hoc patches scattered throughout the system.</p>
<p>A further significant advantage of NixOS is the portability of <a href="https://nixos.org/download/#nix-install-linux">Nix</a>, its package manager (and the Nix language it uses), across various Linux distros and even macOS.</p>
<p>Unlike most package managers, which are tightly coupled to their parent distros (e.g., <code>pacman</code> for Arch, <code>dpkg</code> for Debian, <code>rpm</code> for Red Hat-based systems), Nix operates independently. Nix packages are installed in the <code>/nix/store</code> directory, ensuring they do not conflict with native packages. This portability is invaluable for debugging: if a package in our NixOS-based distro encounters an issue, we can replicate the exact same package environment on any Linux development machine, greatly simplifying troubleshooting.</p>
<h3 id="the-new-top-level-sub-project"><a class="header" href="#the-new-top-level-sub-project">The New Top-Level Sub-Project</a></h3>
<p>Given these compelling rationales, we propose the creation of a new top-level sub-project named <em>Asterinas NixOS (AsterNixOS)</em>. This sub-project will reside in a new <code>distro/</code> directory at the project root.</p>
<p>Initially, AsterNixOS will share version numbers with the Asterinas kernel, emphasizing its early development stage and close coupling. Every kernel release will be accompanied by a compatible distro release. In the long term, once both the kernel and the distro achieve maturity and stability, AsterNixOS will adopt its own independent versioning scheme, likely following a ‚ÄúYY.MM‚Äù format (e.g., 25.12).</p>
<h2 id="drawbacks-alternatives-and-unknowns"><a class="header" href="#drawbacks-alternatives-and-unknowns">Drawbacks, Alternatives, and Unknowns</a></h2>
<h3 id="drawbacks-1"><a class="header" href="#drawbacks-1">Drawbacks</a></h3>
<ul>
<li><strong>Learning curve for Nix/NixOS:</strong> This is arguably the most significant hurdle. While exceptionally powerful, the Nix ecosystem, including the Nix language and its functional paradigm, presents a steeper learning curve compared to conventional package managers and build systems. This could pose an initial barrier for new contributors and existing Asterinas developers unfamiliar with Nix. Investing in clear documentation and onboarding resources will be critical.</li>
<li><strong>Maintenance overhead of Nixpkgs overlay:</strong> While the override pattern offers flexibility, maintaining a dedicated overlay for Asterinas-specific patches and configurations within the vast <code>nixpkgs</code> repository will still require continuous effort. Keeping pace with upstream <code>nixpkgs</code> changes, resolving potential conflicts, and ensuring compatibility will be an ongoing challenge requiring dedicated resources.</li>
</ul>
<h3 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h3>
<ul>
<li><strong>Embedded Linux distros:</strong> <a href="https://buildroot.org/">Buildroot</a> and <a href="https://www.yoctoproject.org/">Yocto</a> are established and highly capable tools for building embedded Linux distros, offering extensive customization for toolchains and root filesystems from scratch.
<ul>
<li><strong>Why NixOS is superior:</strong> While powerful for embedded use cases, Buildroot and Yocto are less oriented toward a general-purpose desktop/server distro, which is our primary initial target. Furthermore, their configuration languages are generally less expressive and composable than the Nix language, limiting the flexibility we seek for deep customization and elegant overriding.</li>
</ul>
</li>
<li><strong>Direct port of Debian/Arch/etc.:</strong> This approach would involve directly modifying the build systems of a more traditional distro like Debian or Arch to target Asterinas.
<ul>
<li><strong>Why NixOS is superior:</strong> As elaborated, traditional packaging systems are less flexible for the granular, targeted patching and configuration required when adapting to a new kernel. More critically, their package managers (e.g., <code>dpkg</code>, <code>pacman</code>, <code>rpm</code>) are inherently tied to their parent distros, making cross-distro development and debugging significantly more complex. The Nix package manager‚Äôs portability offers a clear advantage here.</li>
</ul>
</li>
</ul>
<h2 id="prior-art-and-references-1"><a class="header" href="#prior-art-and-references-1">Prior Art and References</a></h2>
<p>The NixOS project itself serves as the most prominent piece of prior art, demonstrating the viability and advantages of a purely functional approach to OS configuration and package management. Its design principles, particularly around atomic upgrades, rollbacks, and reproducible builds, have been thoroughly proven since its inception in 2003. Other projects, like <a href="https://guix.gnu.org/">GNU Guix</a>, also follow a similar functional package management paradigm.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0000-your-short-descriptive-title"><a class="header" href="#rfc-0000-your-short-descriptive-title">RFC-0000: Your short, descriptive title</a></h1>
<ul>
<li>Status: Draft</li>
<li>Pull request: (link to PR)</li>
<li>Date submitted: YYYY-MM-DD</li>
<li>Date approved: YYYY-MM-DD</li>
</ul>
<h2 id="summary-2"><a class="header" href="#summary-2">Summary</a></h2>
<p>Provide a concise, one-paragraph summary of the proposed change. This should explain the core idea at a high level, making it understandable to someone without deep context.</p>
<h2 id="motivation-1"><a class="header" href="#motivation-1">Motivation</a></h2>
<p>Explain the ‚Äúwhy‚Äù behind this RFC. What problem does this solve? What is the user or developer story that justifies this change? Why is this change important for the Asterinas project <em>now</em>? This section should clearly articulate the benefits and convince readers of the proposal‚Äôs necessity.</p>
<h2 id="design-2"><a class="header" href="#design-2">Design</a></h2>
<p>This is the heart of the RFC. Describe the proposed design in sufficient detail for a technical review. Explain how it works, how it interacts with other parts of the system, and any new APIs or concepts being introduced. Use code snippets, diagrams, and bullet points where they add clarity.</p>
<h2 id="drawbacks-alternatives-and-unknown"><a class="header" href="#drawbacks-alternatives-and-unknown">Drawbacks, Alternatives, and Unknown</a></h2>
<ul>
<li><strong>Drawbacks:</strong> What are the negative consequences of this proposal? What compromises are being made?</li>
<li><strong>Alternatives:</strong> What other designs or solutions were considered? Why was this specific design chosen over them? What is the impact of <em>not</em> doing this?</li>
<li><strong>Unresolved Questions:</strong> What parts of the design are still to be determined (TBD)? What questions will need to be answered during the implementation phase?</li>
</ul>
<h2 id="prior-art-and-references-2"><a class="header" href="#prior-art-and-references-2">Prior Art and References</a></h2>
<p>Include links to relevant work</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
